(self.webpackChunkvk=self.webpackChunkvk||[]).push([[43639],{890803:(e,t,i)=>{"use strict";function o(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6 12A6 6 0 1 0 6 0a6 6 0 0 0 0 12z" fill="#99a2ad"/><path clip-rule="evenodd" d="M8.78 3.97c.3.3.3.77 0 1.06L5.53 8.28c-.3.3-.77.3-1.06 0L3.22 7.03a.75.75 0 0 1 1.06-1.06l.72.72 2.72-2.72c.3-.3.77-.3 1.06 0z" fill="#fff" fill-rule="evenodd"/></svg>',name:"check_circle_fill_12"}}i.d(t,{getIcon12CheckCircleFill:()=>o})},728638:(e,t,i)=>{"use strict";function o(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="m7.22 3.38.01-.03a4.15 4.15 0 0 1 .17-.48c.36-.82.95-1.29 1.86-1.36l.16-.01h1.21c1.05.03 1.74.6 2.1 1.7l.05.18.05.16c.01.07.03.14.06.2l.05.14.03.02.06-.02.11-.04.14-.06a5.36 5.36 0 0 1 .17-.08l.03-.01a4.23 4.23 0 0 1 .43-.15c.93-.27 1.68-.08 2.32.61l.1.13.72.88c.63.83.61 1.72 0 2.68l-.12.16-.1.14-.12.18-.06.1-.03.05v.02l.08.05.11.06.13.08c1.21.61 1.71 1.42 1.52 2.54l-.03.16-.22.92c-.13.59-.24.87-.67 1.25a2.13 2.13 0 0 1-1.05.52h-.01a3.92 3.92 0 0 1-.44.06l-.2.02H15.63l-.16.01-.16.02.01.13.01.08.03.15c.07.32.1.62.1.9a2.04 2.04 0 0 1-1.13 1.87l-.15.08-1.02.5c-.9.4-1.72.23-2.48-.47a3.93 3.93 0 0 1-.15-.14l-.13-.14-.11-.13a2.94 2.94 0 0 0-.15-.17l-.09-.08-.04-.04-.08.08-.09.1-.1.1c-.83.99-1.7 1.34-2.77.93l-.15-.06-.91-.45-.28-.13a1.78 1.78 0 0 1-.87-.92 2.15 2.15 0 0 1-.2-1.01v-.02c0-.19.02-.39.06-.6l.04-.2.04-.2.01-.15-.1-.02-.12-.01h-.15a4.14 4.14 0 0 1-.86-.1h-.01a2.05 2.05 0 0 1-1.61-1.53l-.05-.16-.25-1.1c-.2-1.03.2-1.82 1.19-2.41l.17-.1.15-.08.19-.1.13-.1v-.01l-.05-.1-.07-.1-.09-.13a5.2 5.2 0 0 1-.29-.42c-.54-.9-.53-1.72.05-2.52l.1-.14.72-.87c.68-.8 1.56-.96 2.64-.56l.18.08.16.07a2.9 2.9 0 0 0 .19.08l.12.04.03-.02.03-.07.04-.12.04-.15.04-.16Zm4.24.84.01.04.05.14a1.5 1.5 0 0 0 .75.83l.03.01a1.5 1.5 0 0 0 1.13.08l.06-.02a1.47 1.47 0 0 0 .07-.02l.12-.04.06-.03.13-.06.04-.01a2.7 2.7 0 0 1 .41-.16c.27-.08.41-.06.47-.04.06.01.16.05.32.22l.07.09.69.84c.13.18.15.29.15.35 0 .09-.03.27-.23.58l-.08.12-.08.1a4.4 4.4 0 0 0-.18.27l-.02.02-.06.1v.01l-.01.02-.03.05a1.5 1.5 0 0 0-.18 1.06v.01a1.5 1.5 0 0 0 .65.96l.08.05.05.04.1.06.07.03.13.08.04.01c.45.24.62.43.67.52.04.06.09.16.04.42l-.02.12-.2.89c-.07.28-.1.35-.11.37h-.01a.97.97 0 0 1-.1.11.65.65 0 0 1-.36.16 2.36 2.36 0 0 1-.25.04h-.16l-.13.01h-.08a4.55 4.55 0 0 0-.28.02l-.15.02a1.5 1.5 0 0 0-1.32 1.63l.01.12v.07l.02.09.01.06.03.15v.05c.06.23.07.42.07.55 0 .2-.04.3-.07.35a.72.72 0 0 1-.28.24l-.1.05-.98.47c-.2.1-.32.09-.38.07-.08-.01-.23-.06-.46-.28a2.38 2.38 0 0 1-.08-.07l-.1-.1-.09-.11a4.39 4.39 0 0 0-.21-.24l-.02-.01-.08-.09a1.43 1.43 0 0 0-.04-.03l-.04-.04a1.5 1.5 0 0 0-2.05.01l-.08.08a1.43 1.43 0 0 0-.04.04l-.1.1a1.53 1.53 0 0 0-.04.04l-.1.12-.03.03c-.31.37-.53.5-.64.53-.08.03-.19.05-.42-.03l-.1-.04-.86-.42-.24-.12a1.19 1.19 0 0 1-.13-.08v-.01a1.08 1.08 0 0 1-.09-.15.67.67 0 0 1-.06-.34l.04-.36.04-.18a4.38 4.38 0 0 0 .06-.35l.01-.15a1.5 1.5 0 0 0-.43-1.22 1.5 1.5 0 0 0-.86-.43h-.1a1.4 1.4 0 0 0-.06-.02h-.13a1.54 1.54 0 0 0-.06-.01h-.19a2.66 2.66 0 0 1-.55-.07c-.22-.05-.3-.11-.35-.15a.7.7 0 0 1-.17-.32L3.26 12l-.24-1.05c-.04-.22 0-.33.02-.38.04-.08.15-.23.46-.42l.13-.08.12-.06a4.43 4.43 0 0 0 .31-.18l.14-.09a1.5 1.5 0 0 0 .65-.94v-.02a1.5 1.5 0 0 0-.17-1.07l-.05-.09a1.49 1.49 0 0 0-.04-.06l-.07-.11a1.5 1.5 0 0 0-.04-.06l-.09-.12a1.52 1.52 0 0 0-.02-.03c-.31-.4-.37-.65-.38-.76 0-.06 0-.18.15-.4L4.2 6l.68-.83c.16-.18.27-.21.33-.23.1-.02.28-.03.63.1l.13.06.13.05a4.42 4.42 0 0 0 .31.13l.12.04a1.5 1.5 0 0 0 1.14-.05l.03-.02a1.5 1.5 0 0 0 .76-.82l.03-.08.02-.07.04-.12.02-.06.04-.14.01-.04.03-.12.12-.32c.1-.23.19-.32.24-.36.04-.03.13-.09.34-.1l.1-.01h1.14c.24.01.34.07.39.11.07.06.2.2.3.54l.05.14.03.13.1.3ZM10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Zm0 1.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" clip-rule="evenodd"/></svg>',name:"gear_outline_20"}}i.d(t,{getIcon20GearOutline:()=>o})},290686:(e,t,i)=>{"use strict";function o(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="gift_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="gift_outline_20__Icons-20/gift_outline_20"><g id="gift_outline_20__gift_outline_20"><path d="M0 0h20v20H0z"/><path d="M14.85 2.31c1.02 1.03 1.23 2.88-.26 4.19h.91a3 3 0 0 1 3 3v.5c0 .82-.1 1.15-.27 1.48a1.88 1.88 0 0 1-1.23.94v1.61c0 1.56-.16 2.13-.47 2.7-.3.57-.75 1.02-1.32 1.32l-.2.1c-.48.23-1.04.35-2.23.37h-5.3c-1.55 0-2.12-.16-2.69-.47a3.18 3.18 0 0 1-1.32-1.32l-.1-.2A5.12 5.12 0 0 1 3 14.3V12.4a1.88 1.88 0 0 1-1.23-.93c-.16-.3-.25-.6-.27-1.3V9.5a3 3 0 0 1 3-3h.91c-1.49-1.31-1.28-3.16-.26-4.19C6.37 1.1 8.74 1.04 10 3.57c1.26-2.53 3.63-2.47 4.85-1.26ZM9.25 12.5H4.5v1.76l.01.4c.02.6.08.92.2 1.2l.08.16c.17.31.4.54.7.71l.17.08c.33.14.72.2 1.6.2h1.99V12.5Zm6.25 0h-4.75v4.52h2l.4-.01c.6-.02.91-.08 1.19-.2l.16-.08c.31-.17.54-.4.71-.7.19-.36.27-.7.29-1.56V12.5ZM9.16 8H4.5C3.67 8 3 8.67 3 9.5v.87c.02.23.04.31.09.4.03.06.08.1.14.14.11.06.22.08.63.09h5.39V8h-.09Zm6.34 0h-4.76v3h5.4c.4 0 .52-.03.63-.09.06-.03.1-.08.14-.14.06-.12.09-.25.09-.78V9.5c0-.83-.67-1.5-1.5-1.5ZM9.22 6.16c-.43-3.1-1.96-3.83-3-2.79C5.16 4.42 5.9 5.95 9 6.38l.26.04Zm1.56 0-.03.19.01.06.24-.03c3.1-.43 3.83-1.96 2.79-3-1.05-1.05-2.58-.32-3.01 2.78Z" id="gift_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"gift_outline_20"}}i.d(t,{getIcon20GiftOutline:()=>o})},187567:(e,t,i)=>{"use strict";function o(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.88 18.12a1.25 1.25 0 0 1-1.76 1.76l-7-7a1.25 1.25 0 0 1 0-1.76l7-7a1.25 1.25 0 0 1 1.76 1.76L9.77 12z" fill="currentColor"/></svg>',name:"chevron_left_24"}}i.d(t,{getIcon24ChevronLeft:()=>o})},276299:(e,t,i)=>{"use strict";function o(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.23 12 8.12 5.88a1.25 1.25 0 1 1 1.76-1.76l7 7c.5.48.5 1.28 0 1.76l-7 7a1.25 1.25 0 0 1-1.76-1.76z" fill="currentColor"/></svg>',name:"chevron_right_24"}}i.d(t,{getIcon24ChevronRight:()=>o})},28556:(e,t,i)=>{"use strict";function o(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M14.46 10.3a2.39 2.39 0 0 1 2.76.31c.35.3.38.8.06 1.13a.88.88 0 0 1-1.19.06l-.08-.07c-.26-.18-.48-.16-.75-.02a.97.97 0 0 0-.15.09l-.08.06a.88.88 0 0 1-1.11-.12.77.77 0 0 1 .06-1.13c.1-.09.26-.2.48-.3zM8.5 9.55a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3zM13.45 14c.55 0 1 .45.9 1-.02.13-.05.26-.09.34a2.44 2.44 0 0 1-3.2 1.32 2.45 2.45 0 0 1-1.32-1.32c-.04-.08-.07-.2-.1-.35-.1-.54.36-.99.91-.99zM9.1 3.8a.9.9 0 0 0 0-1.8zM2 9.1a.9.9 0 0 0 1.8 0z"/><path clip-rule="evenodd" d="M2 9.1A7.1 7.1 0 0 1 9.1 2v1.8a5.3 5.3 0 0 0-5.3 5.3z" fill-rule="evenodd"/><path d="M9.1 20.2a.9.9 0 1 1 0 1.8zM2 14.9a.9.9 0 0 1 1.8 0z"/><path clip-rule="evenodd" d="M2 14.9A7.1 7.1 0 0 0 9.1 22v-1.8a5.3 5.3 0 0 1-5.3-5.3z" fill-rule="evenodd"/><path d="M14.9 3.8a.9.9 0 1 1 0-1.8zM22 9.1a.9.9 0 1 1-1.8 0z"/><path clip-rule="evenodd" d="M22 9.1A7.1 7.1 0 0 0 14.9 2v1.8a5.3 5.3 0 0 1 5.3 5.3z" fill-rule="evenodd"/><path d="M14.9 20.2a.9.9 0 1 0 0 1.8zm7.1-5.3a.9.9 0 0 0-1.8 0z"/><path clip-rule="evenodd" d="M22 14.9a7.1 7.1 0 0 1-7.1 7.1v-1.8a5.3 5.3 0 0 0 5.3-5.3z" fill-rule="evenodd"/></g></svg>',name:"vmoji_outline_24"}}i.d(t,{getIcon24VmojiOutline:()=>o})},802215:(e,t,i)=>{"use strict";i.d(t,{StickersAnimation:()=>n});i(241539),i(788674),i(339714);var o=i(961540),r=(0,i(19331).partConfigEnabled)("rlottie")&&!(0,o.isMvk)(),n=function(){var e,t,i,o,s=!1,a=!1,c={},l={},_={},d={},m={};function u(e,t){var i=r&&!t,o=h(e),n=1;if(o){hide(geByClass1("sticker_img",e)),addClass(e,"animation_play"),o.play();var s=attr(e,"data-loop-count");if(s=parseInt(s),isNaN(s)&&(s=3),-1!==s){var a,c,l=i?null==o||null==(a=o.listeners)?void 0:a.loopComplete:null==o||null==(c=o._cbs)?void 0:c.loopComplete;(!l||0===(null==l?void 0:l.length))&&o.addEventListener("loopComplete",(function t(){n++;var r=!0;s>=n&&(r=!1),r&&(f(e,!1),o.removeEventListener("loopComplete",t),o[i?"pause":"stop"]())}))}}}function v(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function f(e,t){m[v(e)]=t}function h(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var i=_[t];return i||!1}function p(e,t,s){var a=r&&!t;if(!m[v(e)]){f(e,!0);var d=h(e);if(d)"function"==typeof s&&s(d);else{var u=attr(e,"data-uniq-id"),p=attr(e,"data-uid");if(!a||!hasClass(e,"animation_play")){var k=attr(e,"data-animation-path"),w=attr(e,"data-sticker-id"),E=!1,S=a?l[w]:c[w];if(w&&(E=(S||k)&&g(e)),E){var b=attr(e,"data-animation-class")||"",T=a?{elements:[e],loop:!0,autoplay:!0,name:p,group:"sticker",className:`svg_sticker_animation ${b}`}:{container:e,renderer:"svg",loop:!0,autoplay:!1,name:u,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:`svg_sticker_animation ${b}`}};S?T.animationData=S:T[a?"animationUrl":"path"]=k;var C=geByClass1("svg_sticker_animation",e);if(C&&re(C),d=(a?o:i).loadAnimation(T),!c[w]||a)return d instanceof Promise||(d.addEventListener("data_failed",(()=>{})),d=Promise.resolve(d)),void d.then((i=>{var o=a?"firstFrame":"data_ready";i.addEventListener(o,(()=>{var e=i.animationData;a?l[w]=e:c[w]=e,_[u]=i,"function"==typeof s&&s(i)})),a&&i.addEventListener("destroy",(()=>{n.stopAnimation(e,t)}))})).catch((()=>null))}"function"==typeof s&&(_[u]=d,s(d))}}}}function k(e){return t(r&&!e).then((e=>{if(Array.isArray(e)){var t=e[0],r=e[1];o=t,i=r}else i=e;return i}))}return{init(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),i=geByClass1("sticker_animation",t);n.loadAndPlaySticker(i)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(`.msg_id_${e} .sticker_animation`);n.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var i="_msg"+e;t&&(i="msg_id_"+e);var o=geByClass1("sticker_animation",geByClass1(i));n.loadAndPlayStickerWithTimer(o,500)},loadAutoplayAnimationStickers:function(e){if(i){if(e){if(a)return;a=!0}if(!s){s=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){p(t,!1,(function(){u(t,!1)}))})),s=!1}}else k().then((()=>{n.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e,t){e&&(i?requestAnimationFrame((()=>{p(e,t,(function(){u(e,t)}))})):k(t).then((()=>{n.loadAndPlaySticker(e,t)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!d[e]){t||(t=1e3);var i=ge(e);hasClass(i,"sticker_animation_disabled_timer")||(d[e]=setTimeout((function(){!i&&(i=ge(e),hasClass(i,"sticker_animation_disabled_timer"))||(n.loadAndPlaySticker(i),clearTimeout(d[e]),d[e]=!1)}),t))}},reloadStickers:function(){_={}},touchStartSticker:function(t){t.addEventListener("contextmenu",n.preventContextMenu,!1),e=setTimeout((function(){n.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()},stopAnimation(e,t){var i=r&&!t,o=h(e);if(o&&o[i?"pause":"stop"](),i){var n=attr(e,"data-uniq-id");removeClass(e,"animation_play"),show(geByClass1("sticker_img",e)),f(e,!1),delete _[n]}}};function g(e){var t=e.getBoundingClientRect().top,i=e.getBoundingClientRect().bottom;return t<window.innerHeight&&i>=0&&isVisible(e)}}()},970929:(e,t,i)=>{"use strict";i.d(t,{default:()=>h});i(66992),i(821249),i(319601),i(569720),i(324603),i(339714),i(327852),i(115306),i(333948);var o=i(19331),r=i(625488),n=i(324816),s=i(40906),a=i(726271),c=Object.entries(n.EMOJI_HINTS).map((e=>{var t=e[0],i=e[1],o=(i[0],i[1]);return[new RegExp(`(\\s|^)(${(0,s.escapeRE)(o)}${o.endsWith(")")||o.endsWith("(")?"+":""})([\\s\\.,]|$)`,"gi"),t]})),l={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};a.browser.mac?l["\\"]="ё":l["`"]="ё";var _=new RegExp(`[${(0,s.escapeRE)(Object.keys(l).join(""))}]`,"gi"),d=e=>e.replace(_,(e=>l[e])),m=Object.entries(l).reduce(((e,t)=>{var i=t[0];return e[t[1]]=i,e})),u=new RegExp(`[${(0,s.escapeRE)(Object.keys(m).join(""))}]`,"gi"),v=e=>e.replace(u,(e=>m[e])),f=-184940019;const h=class{constructor(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}setConfig(e){Object.assign(this.config,e)}getQueries(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var i=t();i&&(e=e.replace(i,""))}e=e.toLowerCase(),e=(e=c.reduce(((e,t)=>{var i=t[0],o=t[1];return e.replace(i,((e,t,i,n)=>(t||"")+(0,r.emojiByteHexToSymbol)(o)+(n||"")))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var o=[e=(0,r.emojiRemoveSkinToneModifiers)(e)],n=0,s=[...o];n<s.length;n++){var a=s[n];o.push(d(a)),o.push(v(a))}for(var l=0,_=[...o];l<_.length;l++){var m=_[l];o.push(m.replace(/ё/g,"е")),o.push(m.replace(/е/g,"ё"))}for(var u=0,f=[...o];u<f.length;u++){var h=f[u];o.push(h.replace(/[.!?]+$/,""))}return Object.keys(o.reduce(((e,t)=>(e[t]=1,e)),{}))}isBotLinkEnabled(){return(0,o.partConfigEnabled)("stickers_bot_link")&&this.config.peerId!==f}getBotLinkUrl(){return this.config.mvk?`/mail?act=show&peer=${f}`:`/im?sel=${f}`}getBotLinkImageUrl(e,t){return void 0===t&&(t="light"),`/images/stickers_suggestions_bot_${t}_${e}.png`}getBotLinkClickStatName(){return"stickers_suggestions_bot_link"}getBotLinkClickStatKeys(){return[]}isMoneyTransferEnabled(){return(0,o.partConfigEnabled)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())}isMoneySendEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)}isMoneyRequestEnabled(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)}}},104958:(e,t,i)=>{"use strict";i.d(t,{Emoji:()=>_e});i(57327),i(491038),i(226699),i(682772),i(66992),i(821249),i(747042),i(702707),i(140561),i(651532),i(319601),i(569720),i(241539),i(426833),i(788674),i(117727),i(324603),i(339714),i(470189),i(327852),i(132023),i(804723),i(115306),i(323123),i(454747),i(333948);var o=i(324816),r=i(726271),n=i(787481),s=i(479957),a=i(66433),c=i(100416),l=i(486125),_=i(635676),d=i(803834),m=i(49535),u=i(625488),v=i(898884),f=i(408270),h=i(857748),p=i(19331),k=i(695724),g=i(315544),w=i(11122),E=i(970929),S=i(494422),b=i(376270),T=i(386409),C=i(146143),j=i(376852),y=i(786067),I=i(40906),O=i(483295),P=i(826338),R=i(157771),M=i(124041),A=i(749091),B=i(922377),L=i(310835),D=i(751595),x=i(870264),H=i(399321),N=i(665820),K=i(348230),W=i(890803),V=i(276299),U=i(187567),F=i(28556),$=i(511417),z=i(453262),q=i(575867),Y=i(728638),G=i(290686),J=i(451620),X=i(99392),Z=i(211314),Q=i(345435),ee=i(730304),te=i(543836),ie=i(723355),oe=i(791849),re=i(927140),ne=i(101178);function se(){return se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},se.apply(this,arguments)}function ae(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return ce(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function le(){return(0,p.partConfigEnabled)("stickers_web_new_ui")}var _e={opts:{},raw:{},last:0,shownId:!1,hasNewStickers:!1,preventMouseOver:!1,stickerPacksToLoad:[],ttShift:45,favoriteAvailable:!1,favoriteRemindOn:!1,favoriteRemindOff:!1,favoriteLimit:20,favoriteLimitNoticed:!1,isStickersPreloading:!1,stickerSizes:{},stickers:{},TAB_EMOJI:0,TAB_RECENT_STICKERS:-1,TAB_FAVORITE_STICKERS:-2,TAB_NEW_CONVO_STICKERS:-3,TAB_VMOJI:-4,CLICK_DELAY:500,SORTED_EMOJI_SECTIONS_CODES:[-1,1,3,8,2,4,5,6,7,9],CACHED_HEIGHT_PROP:"_emojiHeight",CACHED_WIDTH_PROP:"_emojiWidth",BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY:150,SHOW_TT_TIMEOUT:100,HIDE_TT_TIMEOUT:300,SHOWN_TT_CLS:"emoji_tt_shown",STICKER_REFERRERS:{RECENT:"recent",FAVORITE:"favourite",NEW_CONVO:"new_convo",KEYBOARD:"keyboard",STORY_KEYBOARD:"story_keyboard"},SHOW_STICKER_PACK_VIEWS_DELAY:32,STICKER_PACK_VIEW_MARGIN_TOP:3,STICKERS_IN_RAW:4,STICKER_SIDE_SIZE:70,STICKER_PACK_HEADER_HEIGHT:30,FAV_ICON_TT_MIN_HEIGHT:35,SUGGESTION_WORD_MAX_LENGTH:256,logHintsDelay:0,tabDefaultId:0,stickersKeywordsExpire:36e5*(6+2*Math.random()),PACK_FIELD_ID:0,PACK_FIELD_IS_ACTIVE:1,PACK_FIELD_COUNT:6,STICKER_FIELD_IMAGES:6,STICKER_FIELD_IS_FAVORITE:4,STICKER_PACKS_CONTAINER_CLASS:"sticker_pack_views_container",init:function(e,t){var i=_e.last;_e.tabDefaultId=_e.TAB_RECENT_STICKERS,t.txt=e,t.id=i,t.fieldWrap=(0,g.gpeByClass)("_emoji_field_wrap",e),t.emojiWrap=(0,g.domByClass)(t.fieldWrap,"_emoji_wrap"),t.emojiBtn=(0,g.domByClass)(t.emojiWrap,"_emoji_btn"),t.emojiWrap&&(0,g.data)(t.emojiWrap,"optId",i),e.emojiId=i,t.lastLoadedEmojiCategoriesIdxes={},t.preventDoubleClick=(0,I.vkNow)(),t.suggestions=new E.default(t.suggestionsConfig),t.packViews=new Map,t.activePackViews=new Map,t.packViewsTotalHeight=0,t.renderedPackViews=new Map,t.packsToShow=new Set,t.packsToHide=new Set;var o=(0,k.isRetina)()?128:64;if(_e.stickerSizes[o]=!0,(0,ie.isNewStickerPicker)()&&((0,p.partConfigEnabled)("dynamic_import_new_sticker_picker_module")?(0,oe.initNewStickerPicker)():window.stManager.add([window.jsc("web/sticker_picker.js")])),t.forceTxt)t.editable=0,(0,c.placeholderInit)(e);else{if(t.editable=1,setTimeout((function(){(0,c.placeholderInit)(e,{editable:1,editableFocus:_e.editableFocus,global:t.global}),t.shouldFocus&&_e.editableFocus(e,!1,!0)}),0),r.browser.mozilla)try{document.execCommand("enableObjectResizing",!1,!1),cur.destroy.push((function(){document.execCommand("enableObjectResizing",!1,!0)}))}catch(e){}(0,m.addEvent)(window,"mousemove",_e.preventMouseOverHandle),(0,m.addEvent)(e,r.browser.opera&&!r.browser.chrome?"click":"mousedown",(function(o){if(o.target&&"IMG"==o.target.tagName&&_e.getCode(o.target))return _e.editableFocus(e,o.target,o.offsetX>8),(0,m.cancelEvent)(o);_e.shown&&!(0,ie.isNewStickerPicker)()&&_e.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0)})),t.noLineBreaks&&(0,m.addEvent)(e,"blur",(function(t){e.textContent||e.innerText||(0,k.each)((0,g.geByTag)("br",e),(function(e,t){(0,g.re)(t)}))})),(0,m.addEvent)(e,"keypress keydown keyup input paste",(function(o){if(o.canceled)return!1;if("keydown"===o.type){t.onChange&&(_e.raw[i]=e.innerHTML);var n=t.ctrlSend?t.ctrlSend():t.noEnterSend,s=o.ctrlKey||r.browser.mac&&o.metaKey;if((0,ie.isNewStickerPicker)()&&window.StickerPickerViewer.isShown){var a=o.keyCode===m.KEY.ENTER&&!n,c=o.shiftKey,l=a&&!c&&!s;if(a&&s)return t.onSend&&t.onSend(),(0,m.cancelEvent)(o);if(l)return}if(o.keyCode==m.KEY.RETURN||10==o.keyCode){if(t.forceEnterSend&&t.onSend)return t.onSend(),(0,m.cancelEvent)(o);var _=cur.ctrl_submit&&!t.noCtrlSend;if((_||n)&&s||!_&&!o.shiftKey&&!s){if(!_e.emojiEnter(i,o)||!_e.stickerHintMove(o)||(0,re.isHintsOfMentionsOpen)(e))return!1;if(!n||s)return(0,ie.isNewStickerPicker)()||_e.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0),t.onSend&&t.onSend(),(0,m.cancelEvent)(o)}if(t.noLineBreaks)return(0,m.cancelEvent)(o)}if(o.ctrlKey&&o.keyCode==m.KEY.RETURN){var d=this.value;if(t.editable)_e.insertHTML("<div><br/></div>");else{if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){var u=this.selectionStart;this.value=d.slice(0,u)+"\n"+d.slice(this.selectionEnd),this.selectionStart=this.selectionEnd=u+1}else if(document.selection&&document.selection.createRange){this.focus();var v=document.selection.createRange();v.text="\r\n",v.collapse(!1),r.browser.opera&&!r.browser.chrome&&(v.moveEnd("character",0),v.moveStart("character",0)),v.select()}e.autosize.update(),setTimeout((function(){e.autosize.update()}),0)}return!1}var f=(0,b.hasAccessibilityMode)()&&(0,p.partConfigEnabled)("emoji_tooltip_a11y_mode");if(o.keyCode===m.KEY.TAB&&!s&&!f){var h,w,E=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt));if(E&&(0,g.isVisible)(E)){var S=(0,g.geByClass1)("over",E);if(S?_e.stickerHintKeyOut(i,S):_e.stickerHintKeyOver(i,(0,g.geByClass1)("emoji_sticker_item",E)),!_e.shown)return(0,m.cancelEvent)(o)}if((0,re.isHintsOfMentionsOpen)(e))return(0,m.cancelEvent)(o);var T=null==(h=t.txt)||null==(w=h.parentNode)?void 0:w.querySelector(".emoji_smile");return(0,ie.isNewStickerPicker)()?_e.shown?(_e.editableFocus(e,!1,!0,!1,!0),_e.hide()):_e.show(T):_e.shown?(_e.editableFocus(e,!1,!0,!1,!0),_e.ttClick(i,T,!0)):_e.ttClick(i,T,!1,!0,void 0,!0),(0,m.cancelEvent)(o)}if(o.keyCode==m.KEY.ESC){var C=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt)),j=!1;if(C&&(0,g.isVisible)(C)&&(_e.stickerHintKeyOut(i,(0,g.geByClass1)("emoji_sticker_item",C)),_e.stickersHintsHide(C,t,100),j=!0),_e.shown&&(_e.editableFocus(e,!1,!0,!1,!0),ie.isNewStickerPicker?_e.hide():_e.ttClick(i,(0,g.geByClass1)("emoji_smile",t.controlsCont),!0),j=!0),j)return(0,m.cancelEvent)(o);if(t.onEsc)return t.onEsc(o)}}return"paste"===o.type?(_e.onEditablePaste(e,t,i,o),t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),_e.checkStickersKeywords(i,t)):"keyup"===o.type?(!t.noLineBreaks||e.textContent||e.innerText||(0,k.each)((0,g.geByTag)("br",e),(function(e,t){(0,g.re)(t)})),t.checkEditable&&t.checkEditable(i,e),_e.checkStickersKeywords(i,t),t.onChange&&(_e.raw[i]!=e.innerHTML&&_e.onChange(t),delete _e.raw[i])):"keydown"!==o.type&&"input"!==o.type||(t.checkEditable&&setTimeout((()=>t.checkEditable(i,e)),0),_e.checkStickersKeywords(i,t)),t.onKeyAction&&t.onKeyAction(o),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate(o),!0}))}return window.Notifier&&Notifier.addRecvClbk("emoji",0,_e.lcRecv,!0),(0,Q.initStickersKeywords)(),_e.initPromotedStickerUrls(),_e.checkNewStickers(t),_e.opts[_e.last]=t,_e.last++},setSuggestionsConfig:function(e,t){_e.opts[e].suggestions.setConfig(t)},onChange:function(e){(0,I.isFunction)(e.onChange)&&setTimeout(e.onChange,0)},preventMouseOverHandle:function(){_e.preventMouseOver=!1},lcRecv:function(e){if("updateTabs"===e.act)_e.updateTabs(e.newStickers,e.keywords)},correctCaret:function(e){var t=e?(0,S.getCaretBoundingRect)(e).bottom:0;(t<0||t>e.offsetHeight)&&(e.scrollTop+=t-e.offsetHeight)},insertWithBr:function(e,t){if(t){var i=t.replace(/\n/g,"<br/>"),o=(0,g.ce)("div",{innerHTML:i});_e.cleanCont(o),_e.insertHTML(o.innerHTML)}},insertWithoutNL:function(e,t){if(t){var i=t.replace(/\n/g,""),o=(0,g.ce)("div",{innerHTML:i});_e.cleanCont(o),_e.insertHTML(o.innerHTML)}},focusTrick:function(e,t,i,o,r){r||(r=e);var n=(0,g.ce)("TEXTAREA",{className:"emoji_tmp_textarea"});e.parentNode.appendChild(n),n.focus(),setTimeout((function(){var s=r.scrollTop;(0,g.re)(n),e.focus(),r.scrollTop=s,_e.setRange(o),t((0,k.clean)((0,g.val)(n))),i(e)}),0)},finalizeInsert:function(e){_e.cleanCont(e),setTimeout((()=>_e.correctCaret(e)),10)},getClipboard:function(e){return e.clipboardData?(0,k.clean)(e.clipboardData.getData("text")):!!window.clipboardData&&(0,k.clean)(window.clipboardData.getData("Text"))},processImagePaste:function(e,t,i,o){if((0,p.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,P.isMarusiaPeer)(_e.selectPeer()))o();else if(null!=e.clipboardData){var r=function(){var r=e.clipboardData;function n(e){if(!e.match(/^webkit\-fake\-url\:\/\//)){var r=new Image;return r.crossOrigin="anonymous",r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r,0,0,e.width,e.height),e.toBlob((function(e){!function(e){var o,r;if(e.name=e.filename="upload_"+(new Date).toISOString()+"_"+(0,I.irand)(0,100)+".png",(0,g.hasClass)(t,"_im_text")){if(i.uploadActions)return void i.uploadActions.paste([e])}else o="post_field"==t.id?cur.wallAddMedia:(r=(0,g.data)(t,"composer"))&&r.addMedia;o&&(0,I.isFunction)(i.initUploadForImagePasteCallback)&&i.initUploadForImagePasteCallback(t,o,e)}(e)}),"image/png"),o(!0)},r.src=e}}if(r.items){var s=!1,a=r.types;if((0,p.partConfigEnabled)("emoji_disable_new_html_processing")||a.includes("Files")||a.includes("text/plain"))for(var c=0,l=r.items.length;c<l;c++){var _=r.items[c];if(_.type.match(/^image\//)&&"file"===_.kind){var d=new FileReader;d.onload=function(e){return n(e.target.result)},d.readAsDataURL(_.getAsFile()),s=!0}else if("text/plain"===_.type)return{v:o()}}else if(r.types.includes("text/html")){var m=(0,g.se)(`<div>${r.getData("text/html")}</div>`).querySelectorAll("img");s=m.length>0,m.forEach((e=>{n(e.src)}))}return{v:s}}if(-1!==Array.prototype.indexOf.call(r.types,"text/plain"))return{v:o()};!function(e){for(var i=Math.floor(1e3*Math.random()),r=(0,g.geByTag)("img",t),n=0,s=r.length;n<s;n++)r[n]["_before_paste_"+i]=!0;setTimeout((function(){for(var r=(0,g.geByTag)("img",t),n=!1,s=0,a=r.length;s<a;s++){var c=r[s];c["_before_paste_"+i]||(e(c.src),(0,g.re)(c),n=!0)}n||o()}),1)}((function(e){return n(e)}))}();if("object"==typeof r)return r.v}else o()},detectInvalidClipboardData(e){if(!e.clipboardData)return!1;var t=e.clipboardData.types;if(t.includes("text/html")){if(t.includes("Files"))return!0;var i=e.clipboardData.getData("text/html");return i&&i.match(/<iframe/i)}return!1},onEditablePaste:function(e,t,i,o,r){var n=!1;"true"===e.getAttribute("contenteditable")&&(n=_e.getRange());var s=this.getClipboard(o),a=s&&n&&!r;this.detectInvalidClipboardData(o)&&(0,m.cancelEvent)(o),(this.processImagePaste(o,e,t,function(i){i||(a?(t.noLineBreaks?this.insertWithoutNL(n,s):this.insertWithBr(n,s),setTimeout(this.finalizeInsert.bind(this,e),0)):n&&this.focusTrick(e,t.noLineBreaks?()=>this.insertWithoutNL(n):()=>this.insertWithBr(n),this.finalizeInsert.bind(this,e),n))}.bind(this))||a)&&(0,m.cancelEvent)(o),_e.onChange(t)},cleanCont:function(e){for(var t=e.firstChild;t;){var i=t.nextSibling;switch(t.nodeType){case 1:if("tmp_paste_cont"==t.id)break;if("DIV"==t.tagName||"P"==t.tagName||"SPAN"==t.tagName)t.setAttribute("style",""),t.className="",t.id="",_e.cleanCont(t);else if("IMG"==t.tagName)_e.getCode(t)||(0,g.re)(t);else if("BR"!=t.tagName){var r=_e.editableVal(t,{saveEmoji:!0}),n=(0,g.cf)((0,k.clean)(r).replace(/\n/g,"<br/>"));t.parentNode.replaceChild(n,t)}break;case 3:var s=(0,k.clean)(t.textContent||t.innerText),a=(0,o.emojiRegex)();s&&s.match(a)&&(s=s.replace(a,v.emojiReplace),t.parentNode.replaceChild((0,g.cf)(s),t))}t=i}},focus:function(e,t,i){void 0===i&&(i=!1),_e.editableFocus(e,!1,!0);var o=i||e.parentNode;if(t){var r=(0,g.getXY)(o)[1],n=(0,d.scrollGetY)(),s=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:boxLayerBG.offsetHeight,a=(0,g.getSize)(o)[1];n+s<r+a?(0,d.scrollToY)(r-s+a+60,100):n>r&&(0,d.scrollToY)(r-60,100)}},destroy:function(e){var t=_e.opts[e];t&&(t.txt&&t.txt.blur(),e===_e.shownId&&(_e.shownId=!1,_e.shown=!1),delete _e.opts[e])},editableFocus:function(e,t,i,o,n){if(!e||n&&document.activeElement===e)return!1;if((e=(0,g.ge)(e)).focus(),e.phonfocus&&e.phonfocus(),void 0!==window.getSelection&&void 0!==document.createRange){var s=window.getSelection();if(!r.browser.opera||r.browser.chrome||i){var a=document.createRange();t?a.selectNode(t):a.selectNodeContents(e),r.browser.mozilla&&e.innerHTML.endsWith("<br>")&&e.removeChild(e.lastChild),o||a.collapse(!i),(s=window.getSelection()).removeAllRanges(),s.addRange(a)}else s.collapse(t||e,0)}else if(void 0!==document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(t||e),c.collapse(!i),c.select()}},getRange:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},setRange:function(e){if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},val:function(e,t){if(void 0===t)return _e.editableVal(e);t=(t=(0,v.emojiToHTML)(t,!0)).replace(/ $/,"&nbsp;"),e.setValue?(e.setValue(t),e.phonblur&&e.phonblur()):e.innerHTML=t,_e.updateStickersHints();var i=(0,g.data)(e,"composer");return i&&window.Composer&&setTimeout((()=>Composer.updateAutoComplete(i))),!0},editableVal:function(e,t){if(!e)return"";if("TEXTAREA"==e.tagName)return(0,g.val)(e);for(var i,o=e.firstChild,r="",n=new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$");o;){switch(o.nodeType){case 3:r+=i=o.data.replace(/^\n|\n$/g," ").replace(/[\n\xa0]/g," ").replace(/[ ]+/g," ");break;case 1:if(i=_e.editableVal(o),o.tagName&&o.tagName.match(n)&&i){"\n"!=i.substr(-1)&&(i+="\n");for(var s=o.previousSibling;s&&3==s.nodeType&&""==(0,k.trim)(s.nodeValue);)s=s.previousSibling;!s||s.tagName&&(s.tagName.match(n)||"BR"==s.tagName)||(i="\n"+i)}else if("IMG"==o.tagName){var a=_e.getCode(o);a&&(t&&t.saveEmoji?i+=_e.getEmojiHTML(a):i+=_e.codeToChr(a))}else"BR"==o.tagName&&(i+="\n");r+=i}o=o.nextSibling}return r},cssEmoji:o.EMOJI_HINTS,getEmojiHTML:v.getEmojiHTML,codeToChr:u.emojiByteHexToSymbol,checkEditable:function(e,t,i){var o=t.scrollHeight,n=_e.opts[e];if(!n)return!1;n.scPaddings||(n.scPaddings=(0,k.intval)((0,g.getStyle)(t,"paddingTop"))+(0,k.intval)((0,g.getStyle)(t,"paddingBottom"))),o-=n.scPaddings;var s=n.tt;if(o>i.height+(r.browser.mozilla&&n.isChat?0:5)){if(!n.isSized){(0,g.setStyle)(t,{height:i.height+"px",overflowY:"auto"});var a=(0,g.geByClass1)("emoji_smile",n.controlsCont),c=(0,g.geByClass1)("emoji_smile_icon_promo",n.controlsCont),l=(0,g.ge)("im_upload"),_=(0,T.sbWidth)();n.ttWrap&&(_+=(0,g.getSize)(n.ttWrap)[0]-((0,g.getXY)(n.emojiBtn)[0]-(0,g.getXY)(n.ttWrap)[0])),(0,g.setStyle)(a,vk.rtl?{left:1+_}:{right:1+_}),c&&(0,g.setStyle)(c,vk.rtl?{left:2+_}:{right:2+_}),l&&(0,g.setStyle)(l.parentNode,vk.rtl?{left:1+_}:{right:1+_}),s&&(0,g.setStyle)(s,vk.rtl?{left:(n.ttDiff||31)+_}:{right:(n.ttDiff||31)+_}),n.isSized=!0}}else if(n.isSized){(0,g.setStyle)(t,{height:"auto",overflowY:"hidden"});var d=(0,g.geByClass1)("emoji_smile",n.controlsCont),m=(0,g.geByClass1)("emoji_smile_icon_promo",n.controlsCont),u=(0,g.ge)("im_upload");(0,g.setStyle)(d,vk.rtl?{left:1}:{right:1}),m&&(0,g.setStyle)(m,vk.rtl?{left:2}:{right:2}),u&&(0,g.setStyle)(u.parentNode,vk.rtl?{left:1}:{right:1}),s&&(0,g.setStyle)(s,vk.rtl?{left:n.ttDiff||31}:{right:n.ttDiff||31}),n.isSized=!1}n.onResize&&n.onResize()},stickersHintsShow:function(e,t,i){((0,g.isVisible)(e)||(0,_.fadeIn)(e,i),t.stickerEventsInited)||((e&&(0,g.geByClass1)("_sticker_hints_inner",e)).addEventListener("wheel",_e.onWheelStickersHints),(0,m.addEvent)(document,"keydown",_e.stickerHintMove),t.onHintsMouseDown=function(){t.hintsClicked=!0,setTimeout((function(){delete t.hintsClicked}),0)},(0,m.addEvent)(e,"mousedown",t.onHintsMouseDown),t.txt&&(t.onTxtFocus&&((0,m.removeEvent)(t.txt,"focus",t.onTxtFocus),delete t.onTxtFocus),t.onTxtBlur=function(o){if(t.hintsClicked)return(0,m.cancelEvent)(o),!0;_e.stickersHintsHide(e,t,i)},(0,m.addEvent)(t.txt,"blur",t.onTxtBlur)),t.stickerEventsInited=!0);(0,ie.isNewStickerPicker)()?(0,ee.moveStickersHintsToStickerPicker)(t.id,!1):_e.checkStickersHintsSize(e,t)},stickersHintsHide:function(e,t,i){((0,_.fadeOut)(e,i),(0,m.removeEvent)(document,"keydown",_e.stickerHintMove),t.onHintsMouseDown&&(0,m.removeEvent)(e,"mousedown",_e.onHintsMouseDown),t.onHintsWheel)&&(e&&(0,g.geByClass1)("_sticker_hints_inner",e)).removeEventListener("wheel",_e.onWheelStickersHints);t.txt&&(t.onTxtBlur&&((0,m.removeEvent)(t.txt,"blur",t.onTxtBlur),delete t.onTxtBlur),t.onTxtFocus&&(0,m.removeEvent)(t.txt,"focus",t.onTxtFocus),t.onTxtFocus=function(){var e=t.txt&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(t.txt));e&&!(0,g.isVisible)(e)&&(delete t.stickerHintsString,_e.checkStickersKeywords(t.id,t,!1))},(0,m.addEvent)(t.txt,"focus",t.onTxtFocus)),delete t.stickerEventsInited,delete _e.shownHintId,_e.sendHintsLog()},stickerHintOver:function(e){_e.stickerHintOut(e),(0,g.addClass)(e,"over")},stickerHintOut:function(e){(0,k.each)((0,g.geByClass)("over",(0,g.domPN)(e)),(function(){(0,g.removeClass)(this,"over")}))},stickerHintClick:function(e,t,i,o){var r=_e.opts[e]||{},n=r.txt,s=n&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(n)),a="suggestion_"+_e.stickerSuggestionQuery;"stories"===r.ref&&(a="story_suggestion_"+_e.stickerSuggestionQuery);var c=!1;return t<0&&(0,p.partConfigEnabled)("stickers_can_send_unpurchased_stickers")&&(t=-t,c=!0),t<0?_e.previewSticker(!1,o,{stickerId:-t,sticker_referrer:a}):((0,g.val)(n,""),_e.stickerClick(e,t,null,a,c),r.checkEditable&&r.checkEditable(e,n)),_e.stickersHintsHide(s,r,0),!1},stickerHintKeyOver:function(e,t){_e.stickerHintOver(t),_e.shownHintId=e},stickerHintKeyOut:function(e,t){_e.stickerHintOut(t),delete _e.shownHintId},stickerHintMove:function(e){var t=_e.shownHintId;if(void 0===t)return!0;var i=_e.opts[t],o=i&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(i.txt));if(o&&(0,g.isVisible)(o)){var r=(0,g.geByClass1)("over",o)||(0,g.geByClass1)("emoji_sticker_item",o);switch(e.keyCode){case m.KEY.LEFT:return(r=(0,g.domPS)(r))&&(_e.stickerHintOver(r),_e.checkStickersHintsScroll(r)),(0,m.cancelEvent)(e),!1;case m.KEY.RIGHT:return(r=(0,g.domNS)(r))&&(_e.stickerHintOver(r),_e.checkStickersHintsScroll(r)),(0,m.cancelEvent)(e),!1;case m.KEY.ENTER:return r.click(),(0,m.cancelEvent)(e),!1}}return!0},checkStickersHintsSize:function(e,t,i){i&&((0,g.addClass)(e,"StickersHints__marginTransition"),(0,g.removeClassDelayed)(e,"StickersHints__marginTransition")),(0,g.setStyle)(e,{marginLeft:0});var o=(0,g.getXY)(e),r=(0,g.getSize)(e),n=_e.getEmojiTtXY(t.tt);t.tt&&n&&n[0]&&o[0]+r[0]+10>n[0]&&o[1]+r[1]>n[1]&&(0,g.setStyle)(e,{marginLeft:n[0]-o[0]-r[0]-10}),(0,g.domFC)(e)||_e.stickersHintsHide(e,t,0)},getEmojiTtXY:function(e){return e&&(0,g.hasClass)(e,_e.SHOWN_TT_CLS)?(0,g.getXY)(e):[0,0]},hintachCache:{},hintachNotFoundStickers:{},checkHintach:function(e,t,i){if((0,p.partConfigEnabled)("hintach"))return _e.hintachCache[e]?requestAnimationFrame((()=>_e.renderHintach(e,t,i,_e.hintachCache[e]))):void ajax.post("/hintach",{query:e},{onDone:o=>{_e.hintachCache[e]=o,_e.renderHintach(e,t,i,_e.hintachCache[e])}})},onHintachItemClick:function(e){var t=e.currentTarget.dataset.hint,i=parseInt(e.currentTarget.parentNode.dataset.opt);if(t&&!isNaN(i)){var o=_e.opts[i]||{},r=o.txt,n=r&&(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(r)),s=(0,h.parseAttachmentId)(t);return s&&o.onHintachSend&&((0,g.val)(r,""),o.onHintachSend(s.type,s.rawId),o.checkEditable&&o.checkEditable(i,r),_e.stickersHintsHide(n,o,0)),!1}},renderHintach:function(e,t,i,o){var r=t.txt,n=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(r)),s=(0,I.isArray)(o.photos)&&o.photos.length||(0,I.isArray)(o.docs)&&o.docs.length;if(e&&t.stickerHintsString&&s){var a=n&&(0,g.geByClass1)("_sticker_hints_inner",n);if(!a||t.noStickers)return!1;_e.clearHintsLog(),_e.hintachNotFoundStickers[e]&&(a.innerHTML="");var c=a.querySelector(".Hintach");c||(c=a.appendChild((0,g.ce)("div",{className:"Hintach"}))),c.setAttribute("data-opt",t.id),c.innerHTML="";var l=64*window.devicePixelRatio,_=64*window.devicePixelRatio;(o.photos||[]).forEach((e=>{var t=(0,h.getPhotoSize)(e.sizes,l,_);if(t){var i=t[0],o=t[1],r=t[2],n=(0,h.prepareImageBounds)(o,r),s=n[0],a=n[1],d=(0,g.ce)("div",{className:"Hintach__item Hintach__item--photo"});d.setAttribute("data-hint","photo"+e.id),d.appendChild((0,g.ce)("div",{className:"Hintach__itemThumb"},{width:s,height:a,backgroundImage:`url(${i})`})),d.onclick=_e.onHintachItemClick,c.appendChild(d)}})),(o.docs||[]).forEach((e=>{if(e.preview&&(e.preview.video||e.preview.graffiti)){var t=e.preview.video||e.preview.graffiti,i=t[0],o=t[1],r=t[2],n=(0,h.prepareImageBounds)(o,r),s=n[0],a=n[1],l=(0,g.ce)("div",{className:"Hintach__item Hintach__item--doc"});l.setAttribute("data-hint","doc"+e.id);var _=l.appendChild((0,g.ce)(e.preview.video?"video":"img",{className:"Hintach__itemPreview",src:i},{width:s,height:a}));e.preview.video&&(l.appendChild((0,g.ce)("div",{className:"Hintach__itemType",innerHTML:"GIF"})),_.autoplay=!0,_.loop=!0),l.onclick=_e.onHintachItemClick,c.appendChild(l)}})),c.childElementCount>0&&(_e.stickersHintsShow(n,t,100),a.scrollLeft=0,_e.checkStickersHintsScroll(n,a.scrollLeft))}},onMoneyTransferSuggestionClick:function(e,t,i){var o=_e.opts[e],r=o.txt.parentNode.querySelector("._sticker_hints");if(_e.stickersHintsHide(r,o,0),"send"===t&&o.suggestions.isMoneySendEnabled()||"request"===t&&o.suggestions.isMoneyRequestEnabled()){var n=o.suggestions.config,a=n.fromId,c=n.peer;w.default.onClick(a,c,t,i,{onSendStart:()=>{o.clearText&&o.clearText()}});var l=_e.moneyTransferTextMatch&&_e.moneyTransferTextMatch.input||"";(0,s.statlogsValueEvent)("stickers_money_transfer_suggestions","select",[t],l)}},renderMoneyTransferSuggestions:function(e,t){var i=_e.opts[e],o=(0,k.isRetina)()?128:64,r={};return i.suggestions.isMoneyRequestEnabled()?r.request=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="request"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'request', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/request/${o}.png" />\n      </a>`:r.request="",i.suggestions.isMoneySendEnabled()?r.send=`<a\n        class="emoji_sticker_item"\n        data-money-transfer-type="send"\n        onclick="Emoji.onMoneyTransferSuggestionClick(${e}, 'send', ${t.amount||0});">\n        <img class="emoji_sticker_image" src="/images/money/send/${o}.png" />\n      </a>`:r.send="",t.request?r.request+r.send:r.send+r.request},checkStickersKeywords:function(e,t,i){if(t.noStickers||!window.stickersKeywords||!window.stickersKeywordsData||!window.stickersKeywordsData.length)return!1;var o=i?0:100,r=t.txt,n=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(r)),s=function(i,o){if(_e.stickers[_e.TAB_RECENT_STICKERS]){var r=_e.sortStickersHints(window.stickersKeywords[i]),s=_e.stickers[_e.TAB_RECENT_STICKERS].promoted,a="";o&&(a+=_e.renderMoneyTransferSuggestions(e,o)),(0,k.each)(r,(function(){a+=_e.render.stickerHintRs(e,this,s[this])})),null==t.onStickersSuggestion||t.onStickersSuggestion(r),t.suggestions.isBotLinkEnabled()&&(a+=_e.renderSuggestionsBotLink(e)),_e.showStickersHints(n,t,a)}},a=function(){var a=t.suggestions.getQueries(_e.val(r));if(a.length){var c=a[0],l=t.suggestions.isMoneyTransferEnabled()&&w.default.match(c,1);if(l&&(a=[w.default.DEFAULT_QUERY]),_e.moneyTransferTextMatch=l,!n&&!(n=_e.initStickersHints(r)))return!1;if(c!=t.stickerHintsString){var _=a.find((e=>e&&window.stickersKeywords[e]&&window.stickersKeywords[e].length||l));if(_e.stickerSuggestionQuery=_,_)if(_e.stickers[_e.TAB_RECENT_STICKERS])s(_,l);else{var d=t.onRecentEmojiUpdate;t.onRecentEmojiUpdate=function(e){d&&d(),e&&(d?t.onRecentEmojiUpdate=d:delete t.onRecentEmojiUpdate,s(_,l))},_e.emojiLoadMore(e)}else _e.hintachNotFoundStickers[c]=!0,_e.stickersHintsHide(n,t,o);!l&&c&&c.length<20&&t.onHintachSend&&(clearTimeout(t.hintachCheckTimeout),t.hintachCheckTimeout=setTimeout((()=>{_e.checkHintach(c,t,i)}),160)),t.stickerHintsString=c}}};i?a():(clearTimeout(t.stickerHintTT),t.stickerHintTT=setTimeout(a,n&&(0,g.isVisible)(n)?0:200))},showStickersHints:function(e,t,i){var o=e&&(0,g.geByClass1)("_sticker_hints_inner",e);if(!o||t.noStickers)return!1;_e.clearHintsLog(),(0,g.val)(o,i),_e.stickersHintsShow(e,t,100),o.scrollLeft=0,_e.checkStickersHintsScroll(e,o.scrollLeft)},checkStickersHintsScroll:function(e,t){var i=(0,g.domClosest)("_sticker_hints",e),o=i&&(0,g.geByClass1)("_sticker_hints_inner",i),r=i&&(0,g.geByClass1)("_sticker_left",i),n=i&&(0,g.geByClass1)("_sticker_right",i);if(!o)return!1;var a=(0,g.getSize)(r)[0],c=(0,g.getSize)(n)[0];if((0,g.hasClass)(e,"emoji_sticker_item")){var l=e.offsetLeft-8-a,_=e.offsetLeft+(0,g.getSize)(e)[1]+2+c-o.clientWidth;o.scrollLeft>l&&(o.scrollLeft=l),o.scrollLeft<_&&(o.scrollLeft=_),t=o.scrollLeft}var d=t>0,m=t+o.clientWidth<o.scrollWidth;(0,g.toggle)(r,d),(0,g.toggleClass)(i,"sticker_hints_left_pad",d),(0,g.toggle)(n,m),(0,g.toggleClass)(i,"sticker_hints_right_pad",m),t=void 0===t?o.scrollLeft:t;var u=o.querySelectorAll(".emoji_sticker_item"),v=d?a+8:0,f=m?c+2:0,h=Array.from(u).filter((e=>e.offsetLeft-v>=t&&e.offsetLeft+e.offsetWidth+f-o.clientWidth<=t));_e.logHints(h.map((e=>(0,k.intval)(e.getAttribute("data-sticker-id")))).filter((e=>e)));var p=h.map((e=>e.getAttribute("data-money-transfer-type"))).filter((e=>e));if(p.length){var w=_e.moneyTransferTextMatch&&_e.moneyTransferTextMatch.input||"";(0,s.statlogsValueEvent)("stickers_money_transfer_suggestions","show",p,w)}},logHints:function(e){_e.logHintsTimeout&&clearTimeout(_e.logHintsTimeout),_e.logHintsTimeout=setTimeout((()=>{_e.hintsLogBuffer=e.reduce(((e,t)=>(e[t]=1,e)),_e.hintsLogBuffer||{})}),_e.logHintsDelay)},clearHintsLog:function(){_e.logHintsTimeout&&clearTimeout(_e.logHintsTimeout),_e.hintsLogBuffer={}},sendHintsLog:function(){var e=_e.hintsLogBuffer&&Object.keys(_e.hintsLogBuffer),t=window.cur&&window.cur.emojiHintsSendLogHash;e&&e.length&&t&&ajax.post("stickers.php",{act:"log_hints",sticker_ids:e,hash:t}),_e.clearHintsLog()},scrollStickersHints:function(e,t,i){var o=(0,g.domClosest)("_sticker_hints",e),r=o&&(0,g.geByClass1)("_sticker_hints_inner",o),n=o&&(0,g.geByClass1)("_sticker_left",o),s=o&&(0,g.geByClass1)("_sticker_right",o);if(!r)return!1;var a=r.scrollLeft+t*(r.clientWidth-2*(0,g.getSize)(e)[0]),c=(0,g.geByClass)("emoji_sticker_item",r);(0,k.each)(c,(function(e,i){return t>0&&i.offsetLeft-8-(0,g.getSize)(n)[0]>a?(a=c[e-1]&&c[e-1].offsetLeft-8-(0,g.getSize)(n)[0]||a,!1):t<0&&i.offsetLeft+(0,g.getSize)(i)[1]+2+(0,g.getSize)(s)[0]-r.clientWidth>a?(a=i.offsetLeft+(0,g.getSize)(i)[1]+2+(0,g.getSize)(s)[0]-r.clientWidth||a,!1):void 0})),a=Math.max(0,Math.min(r.scrollWidth-r.clientWidth,a)),(0,_.animate)(r,{scrollLeft:a},{duration:Math.abs(r.scrollLeft-a)+50,transition:_.Fx.Transitions.easeOutCubic}),_e.checkStickersHintsScroll(r,a)},onWheelStickersHints:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget;t.scrollLeft+=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX,_e.checkStickersHintsScroll(t,t.scrollLeft)},sortStickersHints:function(e){var t=[];_e.stickers[-1]&&(t=_e.stickers[-1].stickers);var i={},o=[];return(0,k.each)(t,(function(){(0,k.inArray)(this[0],e)&&!i[this[0]]&&(o.push(this[0]),i[this[0]]=1)})),(0,k.each)(e,(function(){i[this]||o.push(this)})),o},initStickersHints:function(e){return!!e&&(0,g.domPN)(e).insertBefore((0,g.se)(`<div class="_sticker_hints sticker_hints_tt">\n      <div class="sticker_hints_arrow sticker_left _sticker_left" onmousedown="Emoji.scrollStickersHints(this, -1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,U.getIcon24ChevronLeft)().icon}\n      </div>\n      <div class="_sticker_hints_inner sticker_hints_inner"></div>\n      <div class="sticker_hints_arrow sticker_right _sticker_right" onmousedown="Emoji.scrollStickersHints(this, 1, event);cancelEvent(event);" onclick="cancelEvent(event);">\n        ${(0,V.getIcon24ChevronRight)().icon}\n      </div>\n    </div>`),e)},updateStickersHints:function(e){_e.opts&&(0,k.each)(_e.opts,(function(t,i){e&&delete i.stickerHintsString,_e.checkStickersKeywords(t,i,!0)}))},renderSuggestionsBotLink(e){var t=_e.opts[e].suggestions,i=(0,k.isRetina)()?128:64,o=$.colorScheme.isDarkScheme()?"dark":"light";return`<a\n    class="emoji_sticker_item"\n    href="${t.getBotLinkUrl()}"\n    onClick="Emoji.onSuggestionsBotLinkClick(event, ${e});"\n    target="_blank">\n    <img class="emoji_sticker_image" src="${t.getBotLinkImageUrl(i,o)}" />\n  </a>`},onSuggestionsBotLinkClick(e,t){e.stopPropagation();var i=_e.opts[t].suggestions;(0,s.statlogsValueEvent)(i.getBotLinkClickStatName(),0,...i.getBotLinkClickStatKeys())},initPromotedStickerUrls:function(){if(!window.promotedStickerUrls){var e=ls.get("promoted_stickers_urls");if(e&&e.time&&e.time>(0,I.vkNow)()-_e.stickersKeywordsExpire)window.promotedStickerUrls=e.stickerUrls;else{ajax.post("al_im.php",{act:"get_promoted_stickers"},{onDone:function(e){ls.set("promoted_stickers_urls",{time:(0,I.vkNow)(),stickerUrls:e}),window.promotedStickerUrls=e}})}}},emojiEnter:function(e,t){var i=_e.opts[e],o=(i.ctrlSend?i.ctrlSend():i.noEnterSend)||cur.ctrl_submit&&!i.noCtrlSend;if(i.emojiFocused&&i.emojiOvered&&i.openedByTabKey&&(o?!(t.ctrlKey||r.browser.mac&&t.metaKey):!t.shiftKey)){if(0===i.curTab){var n=(0,g.geByTag1)("img",i.emojiOvered)||(0,g.geByTag1)("i",i.emojiOvered);_e.addEmoji(e,_e.getCode(n),i.emojiOvered)}return(0,m.cancelEvent)(t)}return!0},insertHTML:function(e){if(r.browser.msie&&parseInt(r.browser.version)<12)if(document.selection){var t=document.selection.createRange();t.pasteHTML&&t.pasteHTML(e)}else{var i=document.getSelection().getRangeAt(0),o=document.createElement("span");i.surroundContents(o),o.innerHTML=e,i.collapse(!1)}else e&&document.execCommand("insertHTML",!1,e)},addEmoji:function(e,t){if(!1===e||!1===t)return!1;var i=_e.opts[e];if(i){if(!((0,I.vkNow)()-i.ttShowT<_e.CLICK_DELAY)){if(i.editable){var o=_e.getEmojiHTML(t,_e.codeToChr(t),!0),n=i.txt,s=!!window.getSelection&&window.getSelection(),c=!1;if(s&&s.rangeCount){var l=s.getRangeAt(0);c=l.commonAncestorContainer?l.commonAncestorContainer:l.parentElement?l.parentElement():l.item(0)}for(var _=c;_&&_!=n;)_=_.parentNode;var d=n.lastChild||{};r.browser.mozilla&&"BR"==d.tagName&&!d.previousSibling&&(0,g.re)(n.lastChild),_||_e.editableFocus(n,!1,!0),_e.insertHTML(o);var m=(0,g.geByClass)("emoji",n);for(var u in m.push.apply(m,(0,g.geByClass)("emoji_css",n)),m)if(m.hasOwnProperty(u)){var v=m[u].previousSibling;if(v&&3==v.nodeType&&v.textContent&&32==v.textContent.charCodeAt(0)){var f=v.previousSibling;f&&3==f.nodeType&&f.textContent&&160==f.textContent.charCodeAt(f.textContent.length-1)&&(0,g.re)(v)}}n.check&&n.check(),setTimeout((()=>_e.correctCaret(n)),5),_e.onChange(i);var h=(0,g.data)(n,"composer");h&&window.Composer&&Composer.updateAutoComplete(h)}else{var p,k,w,E=i.txt,S=E.value;p=r.browser.iphone||r.browser.ipad?_e.codeToChr(t):_e.cssEmoji[t][1]+" ",null!=E.selectionStart&&null!=E.selectionEnd?(k=E.selectionEnd,E.value=S.slice(0,E.selectionStart)+p+S.slice(k),E.selectionStart=E.selectionEnd=k+p.length):void 0!==document.selection&&void 0!==document.selection.createRange&&(E.focus(),(w=document.selection.createRange()).text=p,w.select())}i.checkEditable&&i.checkEditable(e,i.txt),_e.checkStickersKeywords(e,i),i.saveDraft&&i.saveDraft(),i.onEmojiAdded&&i.onEmojiAdded(),_e.incrRecentEmojiRate(e,t)}}else(0,a.logError)(new Error(`addEmoji got no opts by optId: ${e}, Emoji.opts === ${JSON.stringify(_e.opts)}`))},showShadow:function(){return!(r.browser.msie&&r.browser.version<10)},scrollTabsTo(e,t,i){void 0===i&&(i=!1);var o=_e.opts[e];if(o.tt){var r=o.tt.querySelector(".emoji_tabs_wrap"),n=r.querySelector(".emoji_tabs_cont"),s=n.getBoundingClientRect().width-r.getBoundingClientRect().width,a=Math.max(0,Math.min(t,s));r.parentNode.classList.toggle("emoji_tabs--scrollable-left",a>0),r.parentNode.classList.toggle("emoji_tabs--scrollable-right",a<s),n.classList.toggle("emoji_tabs_cont--no-transition",i),n.style.setProperty("--scroll-left",-a+"px"),o.tabsScrollLeft=a,_e.vmojiTooltipCheckVisibilityByScroll(a,o.tt,e)}},scrollTabsBy(e,t,i){void 0===i&&(i=!1);var o=_e.opts[e].tabsScrollLeft,r=void 0===o?0:o;_e.scrollTabsTo(e,r+t,i)},throwTabsScroll(e){_e.scrollTabsBy(e,0,!0)},scrollTabsLeft(e){_e.destroyVmojiOnboardingTooltip(),_e.scrollTabsBy(e,-170)},scrollTabsRight(e){_e.scrollTabsBy(e,170)},tabsWheel:function(e,t){(0,m.cancelEvent)(e);var i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;_e.scrollTabsBy(t,i,!0)},scrollToTab:function(e,t){var i=_e.opts[t].tt.querySelector(`.emoji_tab_${e}`);if(i){var o=i.getBoundingClientRect(),r=i.closest(".emoji_tabs_cont").getBoundingClientRect(),n=i.closest(".emoji_tabs_wrap").getBoundingClientRect(),s=o.left-r.left-(n.width-o.width)/2;_e.scrollTabsTo(t,s),_e.selectTab(t,e,i)}},selectTab:function(e,t,i){var o,r=_e.opts[e];if(void 0===i&&(i=(0,g.geByClass1)("emoji_tab_"+t,r.tt)),void 0!==i){var n=i.closest(".emoji_tabs");null==(o=n.querySelector(".emoji_tab_sel"))||o.classList.remove("emoji_tab_sel"),i.classList.add("emoji_tab_sel"),r.curTab=t,cur.stickersTab=t,ls.set("stickers_tab",t);var s=i.closest(".emoji_tabs_group");s&&(s.classList.add("emoji_tabs_group--expanded"),s.style.setProperty("--width",s.scrollWidth+"px")),n.querySelectorAll(".emoji_tabs_group").forEach((e=>{e!==s&&e.classList.remove("emoji_tabs_group--expanded")}))}},show:function(e,t){(0,ie.isNewStickerPicker)()?_e.showNewPicker(e):_e.showOldPicker(e,t)},showNewPicker:function(e){var t=(0,g.data)(e.parentNode,"optId");if(void 0!==t&&window.StickerPickerViewer){var i=_e.opts[t];if(i){var o=i.noStickers,r=i.pickerHeight,n=i.pickerPosition;Object.assign(window.StickerPickerViewer,{onlyEmoji:o,optId:t,pickerHeight:r,pickerPosition:n}),window.StickerPickerViewer.show(e),_e.shown=!0}}},showOldPicker:function(e,t){var i=(0,g.data)(e.parentNode,"optId");void 0!==i&&_e.ttShow(i,e,t)},hide:function(e,t,i){(0,ie.isNewStickerPicker)()?_e.hideNewPicker():_e.hideOldPicker(e,t,i)},hideNewPicker:function(){var e;null==(e=window.StickerPickerViewer)||e.hide(),_e.shown=!1},hideOldPicker:function(e,t,i){var o=(0,g.data)(e.parentNode,"optId");void 0!==o&&_e.ttHide(o,e,t,i)},ttShow:function(e,t,i){var o=_e.opts[e];clearTimeout(o.ctt),clearTimeout(o.stt),o.scrolling&&(o.afterScrollFn=!1),o.ttShown||(t?o.obj=t:t=o.obj,o.stt=setTimeout((function(){_e.ttClick(e,t,!1,!0,i)}),_e.SHOW_TT_TIMEOUT))},ttHide:function(e,t,i,o){var r=_e.opts[e];if(clearTimeout(r.stt),r.ttShown)if(r.scrolling)r.afterScrollFn=()=>_e.ttHide(e,t,i,o);else{t=t||r.obj||(0,g.geByClass1)("emoji_smile",r.controlsCont);var n=function(){_e.ttClick(e,t,!0,!1,i)};o?n():(clearTimeout(r.ctt),r.ctt=setTimeout(n,_e.HIDE_TT_TIMEOUT))}},isVmojiStubIconVisibile(e){var t=e.querySelector(".emoji_tabs_wrap"),i=e.querySelector(".emoji_tab--vmoji-stub");if(i&&t){var o=t.getBoundingClientRect(),r=i.getBoundingClientRect();return o.x<r.x}},destroyVmojiOnboardingTooltip(){_e.vmojiOnboardingTooltipTimer&&(clearTimeout(_e.vmojiOnboardingTooltipTimer),_e.vmojiOnboardingTooltipTimer=null),_e.vmojiOnboardingTooltip&&(_e.vmojiOnboardingTooltip.destroy&&_e.vmojiOnboardingTooltip.destroy(),_e.vmojiOnboardingTooltip=null);var e=document.querySelector(".emoji_tab--vmoji-stub");e&&e.removeEventListener("click",_e.vmojiOnboardingToltipSendHideRequest)},buildVmojiOnboardingTooltip(e,t){var i;if(!(_e.vmojiOnboardingTooltipWasDone||_e.vmojiOnboardingTooltipTimer||(null==(i=_e.vmojiOnboardingTooltip)?void 0:i._isShown))){var o=_e.stickers[_e.TAB_VMOJI]&&_e.stickers[_e.TAB_VMOJI].vmoji_tooltip_info;if(e&&o){var r=e.querySelector(".emoji_tab--vmoji-stub");r&&(_e.vmojiOnboardingTooltipTimer=setTimeout((()=>{var i;_e.vmojiOnboardingTooltipTimer=null,_e.vmojiOnboardingTooltip=new X.default(r,{content:o.content,autoShow:!1,width:"auto",forceSide:"top",appendTo:e,withCloseButton:!0,autoAdjustToViewport:!1,noAutoHideOnWindowClick:!0,cls:"EmojiTab__onboardingTooltip",delay:0,onClick:function(e){e.stopPropagation(),_e.vmojiOnboardingToltipSendHideRequest(),_e.tabSwitch(_e.TAB_VMOJI,_e.TAB_VMOJI,t)}}),_e.vmojiOnboardingTooltip.show&&_e.vmojiOnboardingTooltip.show(),r.addEventListener("click",_e.vmojiOnboardingToltipSendHideRequest,!0),null==(i=window.cur.destroy)||i.push(_e.destroyVmojiOnboardingTooltip)}),500))}}},vmojiTooltipCheckVisibilityByScroll(e,t,i){0===e?_e.buildVmojiOnboardingTooltip(t,i):_e.destroyVmojiOnboardingTooltip()},vmojiOnboardingToltipSendHideRequest(){var e=_e.stickers[_e.TAB_VMOJI]&&_e.stickers[_e.TAB_VMOJI].vmoji_tooltip_info;if(e&&!_e.vmojiOnboardingTooltipWasDone){var t=e.vmojiOnboardingHintHash,i=e.vmojiOnboardingHintId;window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t,hint_id:i}),_e.vmojiOnboardingTooltipWasDone=!0,_e.destroyVmojiOnboardingTooltip()}},ttClick:function(e,t,i,o,r,n){window.stManager.add(["emoji.css"],(()=>{_e.buildOldPicker(e,t,i,o,r,n)}))},buildOldPicker:function(e,t,i,o,n,s){var a=_e.opts[e];if(a&&!(i&&!_e.shown||o&&_e.shown)&&(t||(t=_e.shown||(0,g.ge)(-3==cur.peer?"imw_smile":"im_smile")))){t.tt&&t.tt.destroy&&t.tt.destroy(),!a.tt&&a.sharedTT&&a.sharedTT.emojiTT&&(a.tt=a.sharedTT.emojiTT,a.emojiScroll=a.sharedTT.emojiScroll,a.allEmojiId=a.sharedTT.emojiAllId);var c,l=a.tt;if(!l){var _=_e.getPrevTab(a.noStickers);a.curTab=cur.stickersTab=_,_==_e.TAB_EMOJI||a.noStickers||(_e.stickers[_e.TAB_RECENT_STICKERS]=ls.get("recent_stickers"));var d='<div class="emoji_tabs_l_s" onmousedown="Emoji.scrollTabsLeft('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event)"><div class="emoji_sprite emoji_tabs_l_sc"></div><div class="emoji_sprite emoji_tabs_l_si"></div></div><div class="emoji_tabs_r_s" onmousedown="Emoji.scrollTabsRight('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"><div class="emoji_sprite emoji_tabs_r_sc"></div><div class="emoji_sprite emoji_tabs_r_si"></div></div>';d+=_e.getTabsCode([[0,1]],e),d+='<span class="emoji_tabs_wrap"><span id="emoji_tabs_cont_'+e+'" class="emoji_tabs_cont">',a.noStickers||!1===window.emojiStickers||void 0===window.emojiStickers||(d+=_e.getTabsCode(window.emojiStickers,e));var u="",v='onmousedown="Emoji.showStickersStore('+e+'); return cancelEvent(event);" onclick="return cancelEvent(event);"',f="showTooltip(this, {text: '"+(0,y.getLang)("global_store_stickers")+"', shift: [4,6,6], showdt: 0, black: 1});";a.rPointer?v+=" onmouseover=\"addClass(this.parentNode.parentNode.parentNode, 'emoji_shop_over');"+f+'" onmouseout="removeClass(this.parentNode.parentNode.parentNode, \'emoji_shop_over\');"':v+=' onmouseover="'+f+'"',d+="</span></span>",a.noStickers||(d+='<a class="emoji_shop" '+v+'><div class="emoji_sprite emoji_shop_icon">'+(_e.hasNewStickers?'<div class="emoji_shop_icon_badge">'+Math.abs(_e.hasNewStickers)+"</div>":"")+"</div></a>"),_e.showShadow()||(u+=" emoji_no_opacity"),a.noStickers&&(u+=" emoji_no_tabs"),l=(0,g.ce)("div",{id:"emoji_block_"+e,className:"emoji_tt_wrap tt_down"+u,innerHTML:'<div class="emoji_block_cont"><div class="emoji_block_rel"><div class="emoji_list_cont"><div class="emoji_cats_title_helper"></div><div class="emoji_list"><div class="emoji_scroll emoji_scroll_smiles"></div><div class="emoji_scroll emoji_scroll_stickers"></div></div></div></div><div class="emoji_tabs">'+d+"</div></div>",onmouseenter:function(t){(0,g.hasClass)(l,"emoji_animated")||_e.ttShow(e,!1,t)},onmouseleave:function(t){(0,g.hasClass)(l,"emoji_animated")||_e.ttHide(e,!1,t)}}),a.tt=l,_e.reappendEmoji(e,l),_e.emojiOver(e,(0,g.geByClass1)("emoji_scroll_smiles",l).firstChild),(0,k.each)(["emoji_tabs_l_s","emoji_tabs_r_s","emoji_tabs_wrap"],(function(){(0,m.addEvent)((0,g.geByClass1)(this,a.tt),"DOMMouseScroll wheel",(function(t){_e.tabsWheel(t,e)}))})),a.sharedTT&&(a.sharedTT.emojiTT=l),_e.throwTabsScroll(e)}if(!1!==_e.shownId&&_e.shownId!=e&&_e.ttClick(_e.shownId,(0,g.geByClass1)("emoji_smile",_e.opts[_e.shownId].controlsCont),!0),_e.preventMouseOver=!1,a.emojiExpanded||_e.emojiUIScroll(e,l),_e.shown)_e.hideTt(l),(c=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(a.txt)))&&(0,g.isVisible)(c)&&_e.checkStickersHintsSize(c,a,!0),_e.shown=!1,_e.shownId=!1,a.ttShown=!1,a.emojiFocused=!1,a.emojiOvered=!1,cur.onMouseClick=!1,(0,m.removeEvent)(document,"keydown",_e.emojiMove),(0,g.removeClass)(t,"emoji_smile_on"),a.onHide&&a.onHide(),_e.destroyVmojiOnboardingTooltip();else{if(!(0,g.getXY)(a.emojiBtn)[0]||!(0,g.getXY)(a.emojiBtn)[1])return;a.openedByTabKey=!!s,_e.showTt(l),_e.buildVmojiOnboardingTooltip(l,e),_e.repositionEmoji(e,t,l),(c=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(a.txt)))&&(0,g.isVisible)(c)&&_e.checkStickersHintsSize(c,a,!0),_e.shownId=e,_e.shown=t,cur.emojiList=(0,g.geByClass1)("emoji_list",l),a.ttShown=!0,a.ttShowT=(0,I.vkNow)(),a.emojiFocused=!0,(0,m.removeEvent)(document,"keydown",_e.emojiMove),setTimeout((function(){cur.onMouseClick=function(t){for(var i=t.target;i;){if("im_texts"==i.id||(0,g.hasClass)(i,"emoji_tt_wrap")||(0,g.hasClass)(i,"imw_emoji_wrap"))return!1;i=i.parentNode}_e.ttClick(e,!1,!0)},(0,m.addEvent)(document,"keydown",_e.emojiMove)}),0),(0,g.addClass)(t,"emoji_smile_on"),a.emojiScroll&&a.emojiExpanded&&(a.emojiScroll.update(),r.browser.msie&&0===a.curTab&&a.emojiOvered&&_e.scrollToListEl(e,a.emojiOvered)),a.currentPeerId=void 0,window.emojiStickers&&_e.resetStickerPackViews(e),_e.tabSwitch(a.curTab,a.curTab,e,!1,!0),a.onRecentEmojiUpdate&&a.onRecentEmojiUpdate(!0),a.onShow&&a.onShow(),a.tt.classList.toggle("emoji_tt_can_gift",!("im"===cur.module&&cur.gid))}return _e.hideStickersStoreNotification(),_e.noNewStickers=!0,a.noStickersStore?(0,g.addClass)((0,g.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"):(0,g.removeClass)((0,g.geByClass1)("emoji_tabs","emoji_block_"+e),"emoji_tabs_no_store"),(0,m.cancelEvent)(n)}},getPrevTab:e=>e?_e.TAB_EMOJI:ls.get("stickers_tab")||_e.TAB_EMOJI,curEmojiKeys:{},curEmojiRecent:{},loadingPeerInfo:{},getPeerId:()=>cur.peer,getPeerInfo(e){if(this.loadingPeerInfo[e])return this.loadingPeerInfo[e];if(!R.Ranges.isUserId(e))return Promise.resolve(null);var t=new Promise(((t,i)=>ajax.post("stickers.php",{act:"get_peer_info",peer_id:e},{onDone:i=>{this.loadingPeerInfo[e]=null,t(i)},onFail(){this.onDone(null)}})));return this.loadingPeerInfo[e]=t,t},emojiLoadMore:function(e,t,i){void 0===t&&(t={});var o=_e.opts[e];o.emojiMoreSt||(o.emojiMoreSt=1,_e.emojiFetchMore(t).then((t=>{var r=t.stickers,n=t.recentEmoji;_e.updateEmojiList(r,n,e,o),(0,I.isFunction)(i)&&i()}),(e=>{console.error("Emoji.emojiLoadMore error ",e),o.emojiMoreSt=0})),_e.curEmojiRecent&&o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate())},emojiFetchMore(e){void 0===e&&(e={}),e.act="get_emoji_list",_e.stickerPacksToLoad&&(e.sticker_packs_to_load=_e.stickerPacksToLoad.join(",")),_e.hasNewStickers<0&&(e.new_shown=1);var t=Object.assign(e.sizes||{},_e.stickerSizes);return e.sizes=t&&Object.keys(t).join(","),new Promise(((t,i)=>{ajax.post("al_im.php",e,{onDone:function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];t(i)},onFail:function(e){return i(e),!0}})})).then((e=>{var i=e[0],o=e[1],r=e[2],n=e[3],s=e[4],a=e[5];if(_e.buildStickersIndex(i),void 0!==i[_e.TAB_FAVORITE_STICKERS]){var c=i[_e.TAB_FAVORITE_STICKERS];_e.tabDefaultId=_e.TAB_FAVORITE_STICKERS,_e.favoriteAvailable=!0,_e.favoriteRemindOn=!!c.remind_on,_e.favoriteRemindOff=!!c.remind_off,_e.favoriteLimit=c.limit,_e.favoriteLimitNoticed=c.limit_noticed,_e.sendHintsLogHash=s,w.default.setIntroViewed(a)}n&&(0,k.extend)(cur.lang,n),Object.assign(_e.stickerSizes,t);var l=[];return void 0!==Object.values(i).find((e=>e.vmoji_character_id))&&l.push(window.jsc("web/vmoji.js")),r&&l.push(window.jsc("web/stickers.js")),window.stManager.add(l).then((()=>({stickers:i,recentEmoji:o})))}))},emojiPreloadMore(e,t){_e.isStickersPreloading||(_e.isStickersPreloading=!0,_e.emojiFetchMore(e).then((e=>{var i=e.stickers,o=e.recentEmoji;_e.stickers=i,_e.stickers[_e.TAB_RECENT_STICKERS]&&ls.set("recent_stickers",_e.stickers[_e.TAB_RECENT_STICKERS]);var r=_e.emojiGetRecentFromStorage();r?_e.curEmojiRecent=_e.filterEmoji(r):_e.emojiOldRecentPrepare(o),t&&t()}),(e=>{console.error("Emoji.emojiPreloadMore error ",e)})).finally((()=>{_e.isStickersPreloading=!1})))},buildStickersIndex:function(e){var t={};if(e)for(var i in e)if(e.hasOwnProperty(i)&&i>0&&e[i].stickers)for(var o=e[i].stickers,r=o.length;r--;){var n=o[r];t[n[0]]={sticker:n,packId:i}}_e.stickersById=t},updateEmojiList:function(e,t,i,o){_e.stickers=e,o.emojiMoreSt=0,_e.stickers[-1]&&(ls.set("recent_stickers",_e.stickers[-1]),_e.updateRecentEmoji(i)),o.allEmojiId=0,o.sharedTT&&(o.sharedTT.emojiAllId=0),_e.onStickersLoad&&(o.afterLoad=1),_e.onStickersLoad&&window.emojiStickers&&(_e.onStickersLoad(),_e.onStickersLoad=!1);var r=_e.emojiGetRecentFromStorage();r?_e.curEmojiRecent=_e.filterEmoji(r):(_e.emojiOldRecentPrepare(t,i),_e.updateEmojiCont(i)),_e.updateRecentEmoji(i),o.onRecentEmojiUpdate&&o.onRecentEmojiUpdate(!0)},filterEmoji:function(e){var t=Object.keys(e);e:for(var i in f.EMOJI_SECTIONS_CODES)if(f.EMOJI_SECTIONS_CODES.hasOwnProperty(i))for(var o in f.EMOJI_SECTIONS_CODES[i])if(f.EMOJI_SECTIONS_CODES[i].hasOwnProperty(o)){var r=f.EMOJI_SECTIONS_CODES[i][o],n=t.indexOf(r);if(-1!=n&&(t.splice(n,1),0==t.length))break e}var s={};for(var a in e)e.hasOwnProperty(a)&&-1==t.indexOf(a)&&(s[a]=e[a]);return t.length>0&&_e.setRecentEmojiList(s),s},emojiGetRecentFromStorage:function(){try{return JSON.parse(localStorage.getItem("emoji_recent_list"))}catch(e){return!1}},emojiOldRecentPrepare:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],r=void 0,n=void 0;(0,I.isString)(o)?(r=1,n=o):(r=o,n=i),t[n]=r}_e.setRecentEmojiList(_e.filterEmoji(t))},getRecentEmojiSorted:function(){var e=[];for(var t in _e.curEmojiRecent)if(_e.curEmojiRecent.hasOwnProperty(t)){var i=_e.curEmojiRecent[t];e.push([t,i])}e.sort((function(e,t){return t[1]-e[1]}));var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(e[r][0]);return o.slice(0,20)},incrRecentEmojiRate:function(e,t){_e.emojiRecentRateTime||(_e.emojiRecentRateTime=Date.now()/1e3-6);var i=Date.now()/1e3-_e.emojiRecentRateTime;if(i>=6){var o=Math.min(100,Math.floor(i/6));for(var r in _e.curEmojiRecent)if(_e.curEmojiRecent.hasOwnProperty(r)){if(r==t)continue;_e.curEmojiRecent[r]*=Math.pow(.998076,o)}_e.emojiRecentRateTime+=6*o}_e.curEmojiRecent[t]||(_e.curEmojiRecent[t]=0),_e.curEmojiRecent[t]+=1;var n=_e.getRecentEmojiSorted();f.EMOJI_SECTIONS_CODES[-1]=n,n.length>=20&&-1==n.indexOf(t)&&(n.splice(-1),n.push(t));var s={};for(var a in n)if(n.hasOwnProperty(a)){var c=n[a];s[c]=_e.curEmojiRecent[c]}_e.setRecentEmojiList(s),window.Notifier&&Notifier.lcSend("recent_emoji_set",s)},setRecentEmojiList:function(e){localStorage.setItem("emoji_recent_list",JSON.stringify(e)),_e.curEmojiRecent=e},updateEmojiCont:function(e){var t=_e.opts[e];t&&0==t.curTab&&((0,g.val)((0,g.geByClass1)("emoji_scroll_smiles",t.tt),_e.getInitEmojiContent(e)),_e.updateEmojiCatTitle(e))},ttEmojiList:function(e,t){var i="",o=_e.emojiGetRecentFromStorage();o&&_e.setRecentEmojiList(o),f.EMOJI_SECTIONS_CODES[-1]=_e.getRecentEmojiSorted();var r=t||_e.SORTED_EMOJI_SECTIONS_CODES;for(var n in r)if(r.hasOwnProperty(n)){var s=r[n];i+=_e.getEmojiCategoryHtml(e,s)}return i},getInitEmojiContent:function(e){_e.setEmojiLastAddedCategoryIdx(e,1);return _e.ttEmojiList(e,[-1,1])},getEmojiCategoryHtml:function(e,t){var i="",o=f.EMOJI_SECTIONS_CODES[t];if(!o.length)return i;var r='<div class="emoji_cat_title_helper" data-id="'+t+'" id="emoji_recent_list'+e+"_"+t+'"><div class="emoji_cat_title">'+_e.getEmojiCategoryText(t)+"</div></div>";return i+=r+=_e.emojiGetCatCont(e,o)},getEmojiCategoryText:function(e){switch(-1===e?"recent":parseInt(e,10)){case"recent":return(0,y.getLang)("global_emoji_cat_recent");case 1:return(0,y.getLang)("global_emoji_cat_1");case 2:return(0,y.getLang)("global_emoji_cat_2");case 3:return(0,y.getLang)("global_emoji_cat_3");case 4:return(0,y.getLang)("global_emoji_cat_4");case 5:return(0,y.getLang)("global_emoji_cat_5");case 6:return(0,y.getLang)("global_emoji_cat_6");case 7:return(0,y.getLang)("global_emoji_cat_7");case 8:return(0,y.getLang)("global_emoji_cat_8");case 9:return(0,y.getLang)("global_emoji_cat_9")}},getEmojiLastAddedCategoryIdx:function(e){return _e.opts[e].lastLoadedEmojiCategoriesIdxes[e]},setEmojiLastAddedCategoryIdx:function(e,t){_e.opts[e].lastLoadedEmojiCategoriesIdxes[e]=t},addNextEmojiCategoty:function(e){var t=_e.opts[e],i=t.tt,o=_e.getEmojiLastAddedCategoryIdx(e);if(!t.emojiCategoryAdding&&!t.allEmojiLoaded)if(t.emojiCategoryAdding=!0,o){var r=(0,g.geByClass1)("emoji_scroll_smiles",i);if(o++,_e.SORTED_EMOJI_SECTIONS_CODES.length>o){var s=_e.SORTED_EMOJI_SECTIONS_CODES[o];r.insertAdjacentHTML("beforeEnd",_e.getEmojiCategoryHtml(e,s)),_e.setEmojiLastAddedCategoryIdx(e,o),t.emojiScroll.update()}else t.allEmojiLoaded=!0;t.emojiCategoryAdding=!1}else(0,n.debugLog)("No emoji last category idx")},hideTt:function(e){(0,g.removeClass)(e,_e.SHOWN_TT_CLS)},showTt:function(e){(0,g.addClass)(e,_e.SHOWN_TT_CLS)},emojiGetCatCont:function(e,t){for(var i="",o="",r=t.length-1,n=0;n<=r;n++)o+=_e.emojiWrapItem(e,t[n],n),(n>0&&n%10==9||n>=r)&&(i+='<div class="emoji_smiles_row">'+o+"</div>",o="");return i},updateRecentEmoji:function(e){var t=_e.getRecentEmojiSorted(),i=_e.emojiGetCatCont(e,t),o=(0,g.ge)("emoji_recent_list"+e+"_-1");if(o){for(var r=o.nextSibling;r&&(r=r.nextSibling,(0,g.hasClass)(r.previousSibling,"emoji_smiles_row"));)(0,g.re)(r.previousSibling);for(var n=(0,g.ce)("div",{innerHTML:i}),s=o.nextSibling,a=o.parentNode;r=n.firstChild;)a.insertBefore(r,s)}},findStickerIndex:function(e,t){if(e)for(var i=e.stickers,o=i.length;o--;)if(String(i[o][0])===String(t))return o;return-1},findSticker:function(e,t){var i=_e.findStickerIndex(e,t);if(-1!==i)return e.stickers[i]},findFavoriteStickerIndex:function(e){return _e.findStickerIndex(_e.stickers[_e.TAB_FAVORITE_STICKERS],e)},findFavoriteSticker:function(e){return _e.findSticker(_e.stickers[_e.TAB_FAVORITE_STICKERS],e)},findRecentStickerIndex:function(e){return _e.findStickerIndex(_e.stickers[_e.TAB_RECENT_STICKERS],e)},findRecentSticker:function(e){return _e.findSticker(_e.stickers[_e.TAB_RECENT_STICKERS],e)},findPackSticker:function(e){if(_e.stickersById&&_e.stickersById.hasOwnProperty(e))return _e.stickersById[e].sticker},isStickersLoaded:function(){if(_e.stickers)for(var e in _e.stickers)if(_e.stickers.hasOwnProperty(e)&&e!==String(_e.TAB_RECENT_STICKERS))return!0;return!1},tabs:{favoriteTabContent:function(e,t){var i,o,r=_e.TAB_FAVORITE_STICKERS,n="emoji_tab emoji_tab_img_cont emoji_tab_favorite emoji_tab_"+r;return cur.stickersTab===r&&(n+=" emoji_tab_sel"),_e.isStickersLoaded()?(0!==t&&0!==(null==(i=_e.stickers[r])||null==(o=i.stickers)?void 0:o.length)||(n+=" unshown"),'<a class="'+n+'" onmousedown="'+e+'" onclick="return cancelEvent(event)"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_favorite"></span></a>'):""}},favorite:{reminder:function(e){var t=(0,g.hasClass)(e,"on"),i=t?"favoriteRemindOff":"favoriteRemindOn";if(!_e[i]){var o={text:function(){return t?(0,y.getLang)("purchases_stickers_favorite_rm_tt"):(0,y.getLang)("purchases_stickers_favorite_add_tt")},black:1,hidedt:100,typeClass:"tt_black",noZIndex:!0,shift:[10,8]},r=(0,g.domClosest)("ui_scroll_container",e);o.appendEl=r;var n=(0,g.domClosest)("ui_scroll_overflow",e),s=(0,g.getXYRect)(e),a=(0,g.getXYRect)(n),c=s.top-a.top,l=(a.right,s.right,a.bottom-s.bottom),_=s.left-a.left,d=(a.width||a.right-a.left)/2;(!vk.rtl&&_>d||vk.rtl&&_<d)&&(o.needLeft=!0,o.shift[0]=9),o.forcetodown=c<_e.FAV_ICON_TT_MIN_HEIGHT,o.forcetoup=l<_e.FAV_ICON_TT_MIN_HEIGHT,(0,j.showTooltip)(e,o),_e[i]=!0,ajax.post("stickers.php",{act:"tt_favorite_off",tt_type:t?1:2})}},markStickerAsFavorite:function(e){e[_e.STICKER_FIELD_IS_FAVORITE]=1},markStickerAsUnfavorite:function(e){e[_e.STICKER_FIELD_IS_FAVORITE]=0},addFavoriteSticker:function(e,t){var i,o=null==(i=_e.stickers[_e.TAB_FAVORITE_STICKERS])?void 0:i.stickers,r=_e.findPackSticker(t);if(o&&r){_e.favorite.markStickerAsFavorite(r),o.unshift(r),_e.favorite.increaseFavoritePackSize();var n=_e.findRecentSticker(t);n&&_e.favorite.markStickerAsFavorite(n),ls.set("recent_stickers",_e.stickers[_e.TAB_RECENT_STICKERS]);for(var s=0,a=Object.entries(_e.opts);s<a.length;s++){var c=a[s],l=c[0],_=c[1];if(!_.noStickers){_e.favorite.changeRenderedPackViewsByStickerId(l,t,!0);var d=_.activePackViews.has(_e.TAB_FAVORITE_STICKERS);_e.resetStickerPackViews(l,!d),_e.favorite.showFavoriteTab(_.tt)}}}},deleteFavoriteSticker:function(e,t){var i=_e.stickers[_e.TAB_FAVORITE_STICKERS];if(i){var o=_e.findFavoriteStickerIndex(t);if(-1!==o){i.stickers.splice(o,1),_e.favorite.reduceFavoritePackSize();var r=_e.findRecentSticker(t);r&&_e.favorite.markStickerAsUnfavorite(r),ls.set("recent_stickers",_e.stickers[_e.TAB_RECENT_STICKERS]);var n=_e.findPackSticker(t);n&&_e.favorite.markStickerAsUnfavorite(n);for(var s=0,a=Object.entries(_e.opts);s<a.length;s++){var c=a[s],l=c[0],_=c[1];if(!_.noStickers){if(!i.stickers.length){_e.favorite.hideFavoriteTab(_.tt);var d=_.tt.querySelector(".emoji_favorite_stickers_cont");d&&d.parentElement.remove(),_.renderedPackViews.delete(_e.TAB_FAVORITE_STICKERS),_e.selectTab(l,_e.TAB_RECENT_STICKERS)}_e.favorite.changeRenderedPackViewsByStickerId(l,t,!1),_e.resetStickerPackViews(l,!_.activePackViews.has(_e.TAB_FAVORITE_STICKERS))}}}}},reduceFavoritePackSize:function(){var e=window.emojiStickers.find((e=>e[0]===_e.TAB_FAVORITE_STICKERS));e&&e[_e.PACK_FIELD_COUNT]&&(e[_e.PACK_FIELD_COUNT]=e[_e.PACK_FIELD_COUNT]-1)},increaseFavoritePackSize:function(){var e=window.emojiStickers.find((e=>e[0]===_e.TAB_FAVORITE_STICKERS));e&&(e[_e.PACK_FIELD_COUNT]=e[_e.PACK_FIELD_COUNT]+1)},showFavoriteTab:function(e){var t=e.querySelector(`.emoji_tab_${_e.TAB_FAVORITE_STICKERS}`);t&&t.classList.remove("unshown")},hideFavoriteTab:function(e){var t=e.querySelector(`.emoji_tab_${_e.TAB_FAVORITE_STICKERS}`);t&&t.classList.add("unshown")},changeRenderedPackViewsByStickerId:function(e,t,i){for(var o,r=_e.opts[e],n=_e.findPackSticker(t),s=ae(r.renderedPackViews);!(o=s()).done;){var a,c,l=o.value,_=l[0],d=l[1],m=d.querySelector(`[data-sticker-id="${t}"]`);if(i){if(m)m.classList.add("faved"),null==(a=m.querySelector(".emoji_sticker_item_fav"))||a.classList.add("on");else if(_===_e.TAB_FAVORITE_STICKERS){var u=_e.renderStickerView(e,_,n),v=d.querySelector("[data-sticker-id]");v?v.parentNode.insertBefore(u,v):d.appendChild(u)}}else if(m)if(_===_e.TAB_FAVORITE_STICKERS)m.parentNode.removeChild(m);else m.classList.remove("faved"),null==(c=m.querySelector(".emoji_sticker_item_fav"))||c.classList.remove("on")}}},updateEmojiCatTitle:function(e){var t=_e.opts[e];if(t&&t.emojiScroll){var i,o,r,s=(0,g.ge)("emoji_block_"+e),a=(0,g.geByClass)("emoji_cat_title_helper",s),c=t.emojiScroll.data.scrollTop,l=(0,g.geByClass1)("emoji_cats_title_helper",t.tt);if(a.length){var _=a[0];i=_e.getSizeCached(_)[1]}for(var d=a.length-1;d>=0;d--)if(c>a[d].offsetTop-i){o=a[d],r=d;break}if(!o)return(0,n.debugLog)("title not found");var m=(0,k.intval)((0,g.attr)(o,"data-id"));if(t.curEmojiCatId!=m){t.curEmojiCatId=m;var u=[o],v=a[r-1];v&&((0,g.addClass)(v,"emoji_cat_title_fix"),(0,g.setStyle)(v.firstChild,"transform","translateY("+(o.offsetTop-v.offsetTop-i)+"px)"));for(var f=o.nextSibling;f;)(0,g.hasClass)(f,"emoji_cat_title_fix")&&u.push(f),f=f.nextSibling;for(var h in u)u.hasOwnProperty(h)&&((0,g.removeClass)(u[h],"emoji_cat_title_fix"),(0,g.setStyle)(u[h].firstChild,"transform","translateY(0px)"));(0,g.val)(l,""),t.emojiTitleHelperIsSet=0}!t.emojiTitleHelperIsSet&&c>=o.offsetTop&&c>0?((0,g.val)(l,(0,g.val)(o)),t.emojiTitleHelperIsSet=1):t.emojiTitleHelperIsSet&&(c<o.offsetTop||0==c)&&((0,g.val)(l,""),t.emojiTitleHelperIsSet=0)}},emojiWrapItem:function(e,t,i){var o,n=_e.cssEmoji[t];o=n?' title="'+n[1]+'"':"";var s="";return r.browser.mobile||(s=' onmouseover="return Emoji.emojiOver('+e+', this, true);"'),'<a class="emoji_smile_cont '+("2764"!=t&&i&&i<54?"emoji_smile_shadow":"")+'" '+o+" onmousedown=\"Emoji.addEmoji(Emoji.shownId, '"+t+'\', this); return cancelEvent(event);" onclick="return cancelEvent(event);" '+s+'><div class="emoji_bg"></div><div class="emoji_shadow"></div>'+_e.getEmojiHTML(t,!1,!1,!0)+"</a>"},reappendEmoji:function(e,t){var i=_e.opts[e];i&&i.rceCont&&(i.addMediaBtn?i.sendWrap.insertBefore(i.rceCont,i.addMediaBtn):i.sendWrap.appendChild(i.rceCont)),t&&(i.ttWrap?i.ttWrap.appendChild(t):i.emojiWrap?i.emojiWrap.appendChild(t):i.obj.appendChild(t),_e.hideTt(t))},ttCalcHeight:function(e,t,i){window.headH=window.headH||(0,g.ge)("page_header")&&_e.getSizeCached((0,g.ge)("page_header"))[1]||0;var o=(window.pageNode&&window.browser.mozilla?Math.min((0,g.getSize)(pageNode)[1],window.lastWindowHeight):window.lastWindowHeight)||(0,g.getScroll)()[3],r=window.scrollGetY?(0,d.scrollGetY)():(0,g.getScroll)()[1],n=(0,g.getXY)(t)[1],s=_e.getSizeCached(t)[1],a=(0,g.geByClass1)("emoji_list",i),c=_e.opts[e].emojiSmileHeigh,l=window.headH,_=_e.opts[e].emojiRowsCount;(0,g.isAncestor)(t,pageNode)||(l=0),(0,g.setStyle)(a,{height:_*c+8});for(var m,u,v,f,h=r+l,p=r+o,k=i,w=(0,g.getSize)(i)[1];k!==bodyNode&&(k=(0,g.domClosestOverflowHidden)(k));){var E=(0,g.getXY)(k)[1];h=Math.max(h,E),p=Math.min(p,E+(0,g.getSize)(k)[1])}for(v=p-n-s-9,m=(u=n-9-h)<w&&v<w?u>=v:u>=w,_e.opts[e].forceUp&&(m=!0),f=m?u:v;f<w&&_>3;)_--,w-=c;_e.opts[e].emojiRowsCount=_,_e.opts[e].emojiSmileHeigh=c,(0,g.setStyle)(a,{height:_*c+8}),(0,g.toggleClass)(i,"tt_down",m),(0,g.toggleClass)(i,"tt_up",!m)},repositionEmoji:function(e,t,i){var o,r=_e.opts[e];if(r){if(i.parentNode&&g.getXY&&g.getStyle&&g.setStyle&&g.geByClass&&(o=(0,g.geByClass1)("emoji_rpointer",i))){var n=parseInt((0,g.getStyle)(i,"width")),s=(0,g.getXY)(t)[0],a=parseInt((0,g.getStyle)(t,"width")),c=(0,g.getXY)(i.parentNode)[0];s+a/2<283?((0,g.setStyle)(i,"left",-n-c),(0,g.setStyle)(o,"left",s+a/2-20+"px")):((0,g.setStyle)(i,"left",""),(0,g.setStyle)(o,"left",""))}else(0,g.setStyle)(i,"left","");var l=(0,g.geByClass1)("emoji_list",i),_=(0,g.geByClass1)("emoji_smile_cont",l);if(_e.opts[e].emojiSmileHeigh=_&&_e.getSizeCached(_)[1]||26,_e.opts[e].emojiRowsCount=9,_e.ttCalcHeight(e,t,i),r.ttWrap){var d=(0,g.getSize)(r.ttWrap)[0]-((0,g.getXY)(r.emojiBtn)[0]-(0,g.getXY)(r.ttWrap)[0]);(0,g.setStyle)(i,"right",d-r.ttDiff+"px")}}},emojiOver:function(e,t,i){if(r.browser.mobile||i&&_e.preventMouseOver)return!0;var o=_e.opts[e];(0,g.addClass)(t,"emoji_over"),o.emojiOvered&&o.emojiOvered!=t&&(0,g.removeClass)(o.emojiOvered,"emoji_over"),o.emojiOvered=t},updateEmojiCategories:function(e,t,i){e.data.scrollBottom-_e.BOTTOM_REST_FOR_ADD_EMOJI_CATEGORY<=0&&t.scrollStarted&&setTimeout((function(){_e.addNextEmojiCategoty(i),_e.updateEmojiCatTitle(i)}),0),_e.updateEmojiCatTitle(i)},calcStickerPackViews(e){var t=this.opts[e],i=new Map,o=0,r=o,n=t.forceStickerPack,s=t.emojiScroll;if(window.emojiStickers){for(var a,c=[],l=ae(window.emojiStickers);!(a=l()).done;){var _=a.value,d=_[0];if(this.stickers.hasOwnProperty(d)){var m=_[1],u=_[4]&&n===d,v=d===_e.TAB_VMOJI;if(m||u)(this.stickers[d].stickers.length||v)&&c.push(_)}}for(var f=[],h=[],p=0,k=c;p<k.length;p++){var g=k[p],w=g[0],E=g[9];w<0||E?f.push(g):h.push(g)}[...f,...h].forEach((e=>{var t=e[0],n=t===_e.TAB_VMOJI,a=this.stickers[t].stickers,c=Math.ceil(a.length/_e.STICKERS_IN_RAW)*_e.STICKER_SIDE_SIZE;c+=_e.STICKER_PACK_HEADER_HEIGHT,n&&s&&(c+=s.data.viewportHeight);var l={id:t,top:o,bottom:o+c};i.set(t,l),o+=c,r+=c})),t.packViews=i,t.packViewsTotalHeight=r}},renderStickerPackView(e,t){var i=this.opts[e],o=t.id,r=i.renderedPackViews.get(o);if(r)return r;var n=window.emojiStickers.find((e=>e[0]===o));if(!n)return"";if(!_e.stickers.hasOwnProperty(o))return"";var s=_e.stickers[o],a=s.stickers,c=s.images,l=o===this.TAB_RECENT_STICKERS,_=o===this.TAB_FAVORITE_STICKERS,d=o===this.TAB_VMOJI,m="";if(m+=_e.getStickerPackBlockHeaderHtml(e,n),l)m+=`<div class="emoji_recent_stickers_cont" id="emoji_recent_stickers_cont${e}">`;else if(_)m+=`<div class="emoji_favorite_stickers_cont" id="emoji_favorite_stickers_cont${e}">`;else if(d&&!vk.widget){var u=c[$.colorScheme.isDarkScheme()?"dark":"light"]||Object.values(c)[0];m+=_e.getVmojiStubHtml(u)}for(var v,f=ae(a);!(v=f()).done;){var h=v.value;m+=this.renderStickerViewHtml(e,o,h)}(l||_)&&(m+="</div>");var p=(0,g.se)(`\n     <div style="\n        position: absolute;\n        width: 100%;\n     ">${m}</div>\n  `);return i.renderedPackViews.set(o,p),p},getStickerPackBlockHeaderHtml:function(e,t){var i=t[0],o=t[8],r=t[9],n=_e.stickers[i],s=n.title,a=n.base_id,c=n.can_gift,l="";if(l+=`\n    <div class="clear emoji_stickers_pack_header">\n      <div class="emoji_stickers_pack_header_main">\n        <div class="emoji_stickers_pack_title">${s}</div>`,a&&!vk.widget){var _="emoji_stickers_pack_settings";o&&(_+=" emoji_stickers_pack_settings--new"),l+=`<a class="${_}" href="javascript:void(0);" onclick="Emoji.showProductSettings(${a});" title="${(0,y.getLang)("purchases_stickers_select_style")}">${(0,Y.getIcon20GearOutline)().icon}</a>`}(r&&!vk.widget&&(l+=`\n      <a\n        class="emoji_stickers_pack_settings"\n        href="javascript:void(0);"\n        onclick="Vmoji.showAvatar(${vk.id}, '${r}', ${i});"\n        title="${(0,y.getLang)("purchases_stickers_keyboard_pack_setup")}"\n      >\n        ${(0,Y.getIcon20GearOutline)().icon}\n      </a>\n    `),l+='\n    </div>\n    <div class="emoji_stickers_pack_header_aside">',c&&!vk.widget)&&(l+=`\n      <div\n        class="emoji_stickers_pack_peer_info"\n        data-product-id="${i}"\n        ${a&&a!==i?"data-is-style":""}\n      ></div>\n      <a\n        class="emoji_stickers_pack_gift"\n        onclick="Emoji.giftStickerToCurrentPeer(${i}, event, { sticker_referrer: &quot;stickers_keyboard2&quot; });"\n      >\n        ${(0,G.getIcon20GiftOutline)().icon}\n      </a>`);return l+="\n    </div>\n  </div>"},getVmojiStubHtml:function(e){return`\n    <div class="emoji_vmoji_stub">\n      <div class="emoji_vmoji_create_avatar">\n        <img class="emoji_vmoji_create_avatar__image" src="${e}" alt="" />\n        ${M.FlatButton.render({className:"emoji_vmoji_create_avatar__button",appearance:M.FlatButtonAppearance.TERTIARY,size:M.FlatButtonSize.M,children:(0,y.getLang)("vmoji_keyboard_create_avatar"),restAttrs:{onclick:"Emoji.createVmojiAvatar();"}}).outerHTML}\n      </div>\n    </div>\n  `},mountStickerPackView(e,t){var i=this.opts[e].tt.querySelector(`.emoji_scroll_stickers .${_e.STICKER_PACKS_CONTAINER_CLASS}`);if(i){var o=this.renderStickerPackView(e,t);o.parentNode!==i&&i.appendChild(o);var r=t.top,n=t.bottom;o.style.cssText+=`height: ${n-r}px; top: ${r}px;`}},showStickerPackView(e,t){var i=this.opts[e],o=i.packViews,r=i.activePackViews,n=o.get(t);n&&n!==r.get(t)&&(this.mountStickerPackView(e,n),r.set(n.id,n))},unmountStickerPackView(e,t){var i=this.opts[e].renderedPackViews.get(t);i&&i.parentNode&&(i.querySelectorAll(".sticker_animation").forEach((e=>{z.StickersAnimation.stopAnimation(e,!0)})),i.parentNode.removeChild(i))},hideStickerPackView(e,t){var i=this.opts[e];this.unmountStickerPackView(e,t),i.activePackViews.delete(t)},resetStickerPackViews(e,t){void 0===t&&(t=!1);var i=this.opts[e];_e.calcStickerPackViews(e);var o=document.querySelector(`.${_e.STICKER_PACKS_CONTAINER_CLASS}`);o&&(o.style.height=i.packViewsTotalHeight+"px");var r=0;if(t)for(var n,s=i.packViews,a=i.activePackViews,c=ae(s.values());!(n=c()).done;){var l=n.value,_=l.id,d=l.top,m=a.get(_);m&&m.top!==d&&(r=d-m.top)}_e.calcStickerPacksToShowHide(e),r?_e.updateStickerPackViews(e,(()=>{i.emojiScroll.scrollTop(i.emojiScroll.data.scrollTop+r)})):_e.updateStickerPackViews(e)},calcStickerPacksToShowHide:function(e){var t=this.opts[e];if(t.emojiScroll){var i=t.emojiScroll.data,o=i.scrollTop,r=i.viewportHeight,n=t.packViews,s=t.activePackViews;t.packsToShow=new Set,t.packsToHide=new Set([...s.keys()]);for(var a,c=ae(n.values());!(a=c()).done;){var l=a.value,_=l.id,d=l.top;if(!(l.bottom<=o)){if(d>o+r)break;t.packsToShow.add(_),t.packsToHide.delete(_)}}}},hideStickerPacksViews:function(e){for(var t,i=ae(this.opts[e].packsToHide);!(t=i()).done;){var o=t.value;this.hideStickerPackView(e,o)}},showStickerPacksViews:function(e){for(var t,i=ae(this.opts[e].packsToShow);!(t=i()).done;){var o=t.value;this.showStickerPackView(e,o)}},updateStickerPackViews:function(e,t){_e.hideStickerPacksViews(e),_e.showStickerPacksViews(e),t&&t(e)},scrollToFirstShownPackTab:function(e){var t=this.opts[e].packsToShow.values().next().value;t&&this.scrollToTab(t,e)},scrollToStickerPackView:function(e,t,i){var o=this.opts[e],r=o.packViews.get(t);r&&o.emojiScroll.scrollTop(r.top,i?0:200)},emojiUIScroll:function(e,t){var i=_e.opts[e];(0,g.addClass)(t,"emoji_expanded"),_e.emojiLoadMore(e),i.emojiScroll?i.emojiScroll.update():(i.emojiScroll=new uiScroll((0,g.geByClass1)("emoji_list",t),{theme:"default emoji no_transition",shadows:!0,global:!0,noForceReFlow:!0,ondragstart:function(){i.scrolling=!0},ondragstop:function(){i.scrolling=!1,(0,I.isFunction)(i.afterScrollFn)&&i.afterScrollFn()},onscrollstart:function(){window.tooltips&&J.tooltips.destroyAll(),i.scrollStarted=!0},onupdate:function(t){i&&(i.curTab==_e.TAB_EMOJI?_e.updateEmojiCategories(t,i,e):(_e.calcStickerPacksToShowHide(e),_e.scrollToFirstShownPackTab(e),_e.updateStickerPackViews(e)))},onresize:e=>{var t=e.container,i=e.data;t.style.setProperty("--scroll-viewport-height",i.viewportHeight+"px")}}),i.sharedTT&&(i.sharedTT.emojiScroll=i.emojiScroll)),i.emojiExpanded=!0},renderStickerViewHtml(e,t,i){var o=i[0],n=i[2],s=i[3],a=i[4],c=i[5]||"",l=this.getStickerReferrer(t,e),_="";this.favoriteAvailable&&(_=`<span\n      role="link"\n      onmouseover="Emoji.favorite.reminder(this)"\n      class="emoji_sticker_item_fav ${a?"on":""}"\n      data-sticker-id="${o}"\n      data-hash="${c}"\n      onmousedown="Stickers.toggleFavorite(this, event, ${e}); cancelEvent(event);"\n      onclick="cancelEvent(event)"></span>`);var d="";if(r.browser.msie&&!r.browser.msie_edge||!s)d=`<a\n      id="emoji_sticker_item${e}_${t}_${o}"\n      data-opt-id="${e}"\n      data-sticker-id="${o}"\n      data-pack-id="${t}"\n      data-src="${n}"\n      data-fav="${a}"\n      data-fav-hash="${c}"\n      class="emoji_sticker_item sticker_item_${o} ${a?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${o}, ${t}, &quot;${l}&quot;);">\n      <img class="emoji_sticker_image" src="${n}" />\n      ${_}\n    </a>`;else{var m=(0,I.rand)(1,1e5);d=`<a\n      id="emoji_sticker_item${e}_${t}_${o}"\n      data-opt-id="${e}"\n      data-sticker-id="${o}"\n      data-pack-id="${t}"\n      data-src="${n}"\n      data-animation-path="${s}"\n      data-uniq-id="${m}"\n      data-fav="${a}"\n      data-fav-hash="${c}"\n      class="emoji_sticker_item sticker_item_${o} ${a?"faved":""}"\n      onclick="Emoji.stickerClick(${e}, ${o}, ${t}, &quot;${l}&quot;);">\n      <div\n        data-uniq-id="${m}"\n        onmouseenter="StickersAnimation.loadAndPlaySticker(this, true);"\n        class="sticker_animation"\n        data-sticker-id="${o}"\n        data-animation-path="${s}">\n        <img class="sticker_img emoji_sticker_image" src="${n}" />\n      </div>\n      ${_}\n    </a>`}return d},renderStickerView:(e,t,i)=>(0,g.se)(_e.renderStickerViewHtml(e,t,i)),emojiMove:function(e){var t=_e.shownId,i=_e.opts[t];if(_e.shown&&i&&i.emojiFocused&&i.openedByTabKey){var o=null;if(i.emojiOvered)switch(e.keyCode){case m.KEY.LEFT:o=_e.getEmojiEl(i.emojiOvered,"left"),(0,m.cancelEvent)(e);break;case m.KEY.RIGHT:o=_e.getEmojiEl(i.emojiOvered,"right"),(0,m.cancelEvent)(e);break;case m.KEY.UP:o=_e.getEmojiEl(i.emojiOvered,"up");break;case m.KEY.DOWN:o=_e.getEmojiEl(i.emojiOvered,"down");break;case m.KEY.ENTER:if(!_e.emojiEnter(t,e))return(0,m.cancelEvent)(e),!1;break;default:return!0}else o=_e.getFirstEmojiEl(t);if(o)return _e.preventMouseOver=!0,_e.emojiOver(t,o),_e.scrollToListEl(t,o),!1}return!0},scrollToListEl:function(e,t){var i=_e.opts[e];if(i&&i.emojiScroll){var o=t.offsetTop,r=Math.max(o+30-i.emojiScroll.data.viewportHeight,Math.min(i.emojiScroll.data.scrollTop,o-30));i.emojiScroll.data.scrollTop!=r&&i.emojiScroll.scrollTop(r)}},anim:function(e,t){clearInterval(cur._imAnim);var i=Math.floor(300/13),o=0,r=(0,g.domLC)(e),n=(0,g.domFC)(e),s=t?0:45,a=t?45:0,c=t?1:0,l=t?0:1;cur._imAnim=setInterval((function(){var _=++o>=i?a:s+1.95*o*(t?1:-1),d=_-45,m=o>=i?l:c+.043333333333333335*o*(t?-1:1),u=1-m;r.style.WebkitTransform=r.style.OTransform=r.style.transform="rotate("+_+"deg)",n.style.WebkitTransform=n.style.OTransform=n.style.transform="rotate("+d+"deg)",r.style.opacity=m,n.style.opacity=u,o>=i&&(clearInterval(cur._imAnim),(t?g.addClass:g.removeClass)(e,"emoji_smile_on"),r.style.WebkitTransform=r.style.OTransform=r.style.transform=n.style.WebkitTransform=n.style.OTransform=n.style.transform=r.style.opacity=n.style.opacity="")}),13)},tplSmile:function(e){return'<div class="emoji_smile_wrap _emoji_wrap"><div class="emoji_smile _emoji_btn" title="'+e+'" onmouseenter="return Emoji.show(this, event);" onmouseleave="return Emoji.hide(this, event);" onclick="return cancelEvent(event);"><div class="emoji_smile_icon"></div></div></div>'},emojiToHTML:v.emojiToHTML,emojiReplace:v.emojiReplace,emojiRegex:(0,o.emojiRegex)(),getCode:function(e){var t=!1;if("emoji_css"==e.className)t=e.getAttribute("emoji");else if(-1!=e.className.indexOf("emoji")){var i=e.src&&e.src.match(/\/([a-f0-9*]+)(_2x)?.png/);t=i?i[1]:e.getAttribute("emoji")}return t},showProductSettings(e){(0,D.previewStickerProduct)(e,{settings:!0})},updatePeerInfo(e,t){void 0===t&&(t=!1);var i=_e.opts[e];if("im"===cur.module&&cur.gid)this.renderPeerInfo(e,null);else{var o=this.getPeerId();(o!==i.currentPeerId||t)&&(i.currentPeerId=o,o?(i.tt.classList.add("emoji_tt_peer_info_loading"),this.getPeerInfo(o).then((t=>{i.tt.classList.remove("emoji_tt_peer_info_loading"),o===i.currentPeerId&&this.renderPeerInfo(e,t)}))):this.renderPeerInfo(e,null))}},renderPeerInfo(e,t){var i=_e.opts[e];if(t){i.tt.classList.remove("emoji_tt_peer_info_unavailable");var o=t.product_ids.reduce(((e,t)=>(e[t]=1,e)),{});i.tt.querySelectorAll(".emoji_stickers_pack_peer_info").forEach((e=>{var i=e.dataset.productId;if(o.hasOwnProperty(i)){var r=void 0!==e.dataset.isStyle;e.innerHTML=`\n        <img\n          class="emoji_stickers_pack_peer_info__photo"\n          src="${t.photo}"\n          width="16"\n          height="16"\n          loading="lazy"\n        />\n        <div\n          class="emoji_stickers_pack_peer_info__purchased_icon"\n        >\n          ${(0,W.getIcon12CheckCircleFill)().icon}\n        </div>\n        <div\n          class="emoji_stickers_pack_peer_info__tooltip_overlay"\n          data-tooltip-text="${r?t.tooltip_style:t.tooltip_pack}"\n          onmouseover="Emoji.showPeerInfoTooltip(event);"\n        ></div>\n      `}else e.innerHTML=""}))}else i.tt.classList.add("emoji_tt_peer_info_unavailable")},showPeerInfoTooltip(e){(0,j.showTooltip)(e.target,{text:e.target.dataset.tooltipText,center:!0,black:!0,shift:[4,8],appendEl:e.target.closest(".emoji_block_cont")})},getTabCont:function(e){_e.calcStickerPackViews(e);var t=_e.opts[e];return`<div class="${_e.STICKER_PACKS_CONTAINER_CLASS}" style="height: ${t.packViewsTotalHeight}px;"></div>`},updateStickersCont:function(e){var t=_e.opts[e],i=_e.getTabCont(e);(0,g.geByClass1)("emoji_scroll_stickers",t.tt).innerHTML=i},hintsStickerItemAnimation:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animationUrl%" data-uniq-id="%uniqId%" data-sticker-id="%stickerId%"><img class="emoji_sticker_image sticker_img" src="%stickerUrl%" /></a>'},hintsStickerItem:function(){return'<a id="emoji_sticker_item%optId%_%selId%_%stickerId%" data-pack-id="%selId%" data-sticker-id="%stickerId%" class="emoji_sticker_item %class%" onclick="%onclick%" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"><img class="emoji_sticker_image" src="%stickerUrl%" /></a>'},tabSwitch:function(e,t,i){if(null!=e){var o=_e.opts[i],r=o.tt;"number"==typeof e&&(e=(0,g.geByClass1)("emoji_tab_"+e,r)),o.curEmojiCatId=null,t==_e.TAB_EMOJI?_e.showEmojiTab(i,t,e):_e.showStickersTab(i,t,e)}},showEmojiTab:function(e,t,i){var o=_e.opts[e],r=o.tt,n=(0,g.geByClass1)("emoji_scroll_smiles",r),s=(0,g.geByClass1)("emoji_scroll_stickers",r),a=(0,g.geByClass1)("emoji_cats_title_helper",r);(0,g.hide)(s),(0,g.show)(n),(0,g.show)(a),o.emojiInited||((0,g.val)(n,_e.getInitEmojiContent(e)),o.emojiInited=!0),o.imagesLoader&&o.imagesLoader.processLoad(),o.emojiOvered&&o.curTab===_e.TAB_EMOJI&&_e.emojiOver(e,_e.getFirstEmojiEl(e)),o.curTab!=_e.TAB_EMOJI&&o.emojiScroll&&o.emojiScroll.scrollTop(0),_e.updateRecentEmoji(e),_e.updateEmojiCatTitle(e),_e.selectTab(e,t,i)},showStickersTab:function(e,t,i){var o=_e.opts[e],r=o.tt,n=(0,g.geByClass1)("emoji_scroll_smiles",r),s=(0,g.geByClass1)("emoji_scroll_stickers",r),a=(0,g.geByClass1)("emoji_cats_title_helper",r);if((0,g.hide)(n),(0,g.show)(s),(0,g.hide)(a),_e.shouldLoadStickers(t))_e.onStickersLoad=function(){var i;_e.updateTabsOpt(e,void 0,!1),(null==(i=_e.stickers)?void 0:i[t])||(t=_e.TAB_RECENT_STICKERS),_e.tabSwitch(t,t,e)},_e.stickersLoadingProgress(e,t,i),o.stickersInited=!1,o.curTab=null,_e.emojiLoadMore(e);else{var c=window.emojiStickers.find((e=>e[0]===t));c&&c[7]&&(0,L.updateUserProductState)(t,A.UserProductStateKey.IsNew,0,!1).then((()=>{Array.from(document.querySelectorAll(`.emoji_tab_${t}`)).forEach((e=>{e.classList.remove("emoji_tab_is_new")}))})),o.stickersInited||(_e.updateStickersCont(e),o.stickersInited=!0),_e.calcStickerPackViews(e),_e.calcStickerPacksToShowHide(e),_e.scrollToStickerPackView(e,t,!0),_e.updateStickerPackViews(e),_e.selectTab(e,t,i)}o.afterLoad&&(o.afterLoad=0),o.stickersInited&&_e.updatePeerInfo(e)},shouldLoadStickers:function(e){var t=_e.stickers&&(0,k.clone)(_e.stickers);return t&&delete t[_e.TAB_RECENT_STICKERS],!window.emojiStickers||!t||(0,I.isEmpty)(t)||!t[e]&&e!=_e.TAB_RECENT_STICKERS},getFirstEmojiEl:function(e){for(var t=_e.opts[e],i=(0,g.geByClass1)("emoji_scroll_smiles",t.tt).firstChild;i;){if((0,g.hasClass)(i,"emoji_smiles_row"))return i.firstChild;i=i.nextSibling}return null},getEmojiEl:function(e,t){for(var i,o=0,r=e.parentNode,s=0,a=r.firstChild;a&&(s++,a!==e);)a=a.nextSibling;for(;e&&!i;){if("left"==t||"right"==t)(i="left"==t?e.previousSibling:e.nextSibling)||("left"==t?(t="up",s=10):(t="down",s=1));else{if("up"!=t&&"down"!=t)break;for(var c=r;c&&(c="up"==t?c.previousSibling:c.nextSibling)&&!(0,g.hasClass)(c,"emoji_smiles_row"););if(!c)break;if(s&&c)for(var l=0,_=c.firstChild;_&&l<s;){if(++l>=s){i=_;break}_=_.nextSibling}if(i||!c)break;i="up"==t||s&&"down"==t?c.lastChild:c.firstChild}if(++o>20){(0,n.debugLog)("ERR!!");break}}return i},addRecentSticker(e){var t=this.stickers[this.TAB_RECENT_STICKERS];if(t){var i=this.findPackSticker(e);if(i){var o=t.stickers.findIndex((t=>{var i=t[0];return String(i)===String(e)}));-1!==o&&t.stickers.splice(o,1),t.stickers.unshift(i);for(var r=0,n=Object.entries(this.opts);r<n.length;r++){var s=n[r],a=s[0],c=s[1];if(!c.noStickers){var l=c.renderedPackViews.get(this.TAB_RECENT_STICKERS);if(l){var _=l.querySelector(`[data-sticker-id="${e}"]`)||this.renderStickerView(a,this.TAB_RECENT_STICKERS,i),d=l.querySelector("[data-sticker-id]");d&&d!==_&&d.parentNode.insertBefore(_,d)}if(c.tt){var m=c.tt.querySelector(`.emoji_tab_${this.TAB_RECENT_STICKERS}.unshown`);m&&m.classList.remove("unshown")}_e.resetStickerPackViews(a,!c.activePackViews.has(_e.TAB_RECENT_STICKERS))}}ls.set("recent_stickers",this.stickers[this.TAB_RECENT_STICKERS])}}},stickerClick:function(e,t,i,o,r){var n=_e.opts[e];if(!(Date.now()-n.ttShowT<_e.CLICK_DELAY||n.preventDoubleClick&&Date.now()-n.preventDoubleClick<_e.CLICK_DELAY)){if(n.preventDoubleClick=Date.now(),!(0,ie.isNewStickerPicker)()&&!r){var a,c,l=!0;if(i)l=null==(a=window.emojiStickers)||null==(c=a.find((e=>e[0]===i)))?void 0:c[1];l&&_e.addRecentSticker(t)}n.onStickerSend&&n.onStickerSend(t,o,"animation"),(0,s.statlogsValueEvent)("stickers_usage",n.ref,t,o),(0,ie.isNewStickerPicker)()?_e.hideNewPicker():_e.ttHide(e,!1,!1,!0),n.recentSticker=t}},stickerOver:function(e,t){var i={act:"a_stickers_hover",sticker_id:e,from:cur.module};if((0,I.isObject)(t.tt)&&"IMG"===t.firstChild.nodeName)return t.tt.show();ajax.post("al_im.php",i,{onDone:function(e,i){var o=(cur.tooltips||[]).length,r=["subscribe_post_tt","sticker_extra_tt","sticker_extra_tt"+o,e.image?"":"tt_text_only"];if(r=r.join(" "),e.show){var n={index:o,className:r,content:i,shift:function(){return[-138,0,-200]},hasover:1,slideX:15,showsp:150,cache:1,forcetodown:!0,no_shadow:!0,dir:"left",onShowStart:function(e){var t=e.container,i=(0,g.getSize)(e.container)[1];if(!(i>=225)){var o=(0,k.intval)((225-i)/2)+10,r=(0,k.intval)((0,g.getStyle)(t,"top",!0))+o;(0,g.setStyle)(t,"top",r)}}};(0,g.gpeByClass)("_im_peer_history_w",t)&&(n.appendParentCls="_im_peer_history_w"),(0,j.showTooltip)(t,n)}}})},selectPeer:function(e){if(void 0!==e){var t=_e.opts[e];if(t.peer)return t.peer}var i=cur.peer||(cur.mbTo?cur.mbTo[0]:"");if(-3==i&&cur.wdd.imw_dd){var o=0;for(var r in cur.wdd.imw_dd.selected)cur.wdd.imw_dd.selected.hasOwnProperty(r)&&(i=cur.wdd.imw_dd.selected[r][0],o+=1);o>1&&(i="")}return i},showMyStickers:function(){cur.boxMyStickers=(0,C.showBox)("al_im.php",{act:"stickers_my"},{dark:1,stat:["im.css","imn.js",window.jsc("web/sorter.js")]})},getSelectedStickersStoreTabId(){var e=document.querySelector("#im_stickers_tabs");if(e){var t=e.querySelector(".ui_tab_sel");if(t)return(t.parentNode.id.match(/^tbt_stickers_(.*)$/)||[])[1]}},showStickersStore:function(e,t,i,o){void 0===i&&(i={}),void 0===o&&(o={});var r=_e.selectPeer(!1!==e?e:void 0),n=_e.opts[e];i=se({},i,{act:"stickers_store",peer:r,box:1}),t&&(i.ref=t),cur.boxStickersStore=(0,C.showBox)("al_im.php",i,{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy(){n&&n.onStoreHide&&n.onStoreHide(),cur.boxStickersStore=null}},onDone(){void 0!==o.scrollTop&&((0,K.getBoxLayerWrap)().scrollTop=o.scrollTop)}}),cur.boxStickersStore.reload=()=>{if(cur.boxStickersStore){var i=_e.getSelectedStickersStoreTabId(),o=(0,K.getBoxLayerWrap)().scrollTop;cur.boxStickersStore.hide(),_e.showStickersStore(e,t,{tab:i},{scrollTop:o})}},_e.hideStickersStoreNotification(),(0,k.each)((0,g.geByClass)("emoji_shop_icon_badge"),(function(e,t){(0,g.re)(t)})),_e.hasNewStickers=!1},previewSticker:function(e,t,i,o){if(le()){var r=(i=i||{}).peerId||_e.selectPeer(),n={recipientIds:r?[r]:[],preview_ref:i.sticker_referrer||"store"};return i.stickerId?(0,D.previewSticker)(i.stickerId,n):(0,D.previewStickerProduct)(e,n),(0,m.cancelEvent)(o),!1}if(i=i||{},o&&(0,m.checkEvent)(o))return!0;var s={act:"sticker_preview",pack_id:e},a=_e.selectPeer();if(i.peer?s.peer=i.peer:a&&(s.peer=a),i.preview&&(s.preview=1),i.gift&&(s.gift=1),i.giftTo&&(s.gift_to=i.giftTo),i.stickerId&&(s.sticker_id=i.stickerId),s.sticker_referrer=i.sticker_referrer||"store",i.name){var c=nav.objLoc[0].split("/");"stickers"==c[0]&&c[1]!=i.name&&nav.setLoc({0:"stickers/"+i.name})}return cur.boxStickersPreview=(0,C.showBox)("al_im.php",s,{dark:1,stat:["im.css","imn.js"],onFail:function(t){if(window.cur.emojiStickersDisabled||(window.cur.emojiStickersDisabled={}),e&&(window.cur.emojiStickersDisabled[e]=!0),t)return!0}}),(0,m.cancelEvent)(o),!1},getStickerPack(e){if(window.emojiStickers){var t=window.emojiStickers.find((t=>t[_e.PACK_FIELD_ID]===e))||null;return Promise.resolve(t)}return new Promise(((t,i)=>{ajax.post("al_im.php",{act:"a_stickers_list"},{onDone(i){window.emojiStickers=i,t(i?_e.getStickerPack(e):null)},onFail:()=>(i(),!0)})}))},getClosestTextInput(e){if(e.getAttribute("contenteditable"))return e;var t=e.closest(".js-im-page, .fc_tab, .mv_chat");return t?t.matches(".fc_tab")?t.querySelector(".fc_editable"):t.matches(".js-im-page")?document.querySelector("._im_text"):t.matches(".mv_chat")?t.querySelector(".mv_chat_reply_input"):null:null},showPackInKeyboard(e,t){var i=_e.getClosestTextInput(t);if(i&&void 0!==i.emojiId){var o=_e.opts[i.emojiId];(0,ie.isNewStickerPicker)()||_e.ttClick(i.emojiId,i.parentNode.parentNode.querySelector("._emoji_btn"),!1,!0);var r=o.tt.querySelector(`.emoji_tab_${e}`),n=void 0!==Object.keys(_e.stickers||{}).find((e=>e!==_e.TAB_RECENT_STICKERS));n?_e.tabSwitch(r,e,i.emojiId):(_e.onStickersLoad=()=>_e.tabSwitch(e,e,i.emojiId),_e.stickersLoadingProgress(i.emojiId,e,r))}},clickSticker:function(e,t,i,o){var r;if(void 0===o&&(o={}),null==(r=window.cur.emojiStickersDisabled)?void 0:r[e])return!0;var n=o.vmoji;if(n&&(0,p.partConfigEnabled)("vmoji")&&!window.vk.widget){var s=n.avatarOwnerId,a=n.avatarCharacterId;if(!s)return window.vk.widget||_e.previewSticker(e,!1,{sticker_referrer:"message"}),!1;if(s===window.vk.id&&t){var c,l=(0,ie.isNewStickerPicker)()?null==(c=window.StickerPickerViewer)?void 0:c.api.getPack({productId:e}):_e.getStickerPack(e);Promise.all([l,_e.getVmojiAvatar()]).then((i=>{var o,r,n=i[0],c=i[1],l=(0,ie.isNewStickerPicker)()?null==n||null==(o=n.product)?void 0:o.active:Boolean(null==n?void 0:n[_e.PACK_FIELD_IS_ACTIVE]);c&&c.character_id===a&&l?(0,ie.isNewStickerPicker)()?null==(r=window.StickerPickerViewer)||r.showPack(e,t):_e.showPackInKeyboard(e,t):_e.showVmojiAvatar(s,a,e)}))}else _e.showVmojiAvatar(s,a,e);return!1}if(t)return(0,te.showPackByClickOnSticker)(e,t),!1;window.vk.widget||_e.previewSticker(e,!1,{sticker_referrer:"message"})},stickersLoadingProgress:function(e,t,i){var o=_e.opts[e];(0,g.removeClass)((0,g.geByClass1)("emoji_tab_sel",o.tt),"emoji_tab_sel"),(0,g.addClass)(i,"emoji_tab_sel"),(0,g.geByClass1)("emoji_scroll_stickers",o.tt).innerHTML='<div class="emoji_scroll_progress">'+(0,g.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})+"</div>"},buyStickers:function(e,t,i,o,r){if(i&&M.FlatButton.getAppearance(i)===M.FlatButtonAppearance.SECONDARY)return!0;if(le())return M.FlatButton.lock(i),H.Cart.create([e]).order({hash:o,ref:r}).then((t=>{if(M.FlatButton.unlock(i),t&&!t.error){(0,l.showDoneBox)((0,K.getPurchaseResult)(t));try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===r&&window.Videoview&&window.Videoview.onStickersPurchased(e),(0,p.partConfigEnabled)("stickers_catalog_reload_after_buy")&&(cur.boxStickersStore?cur.boxStickersStore.reload():nav.reload({params:{tab:_e.getSelectedStickersStoreTabId()},preventScroll:!0}))}})),(0,m.cancelEvent)(t);var n=_e.selectPeer();return ajax.post("/al_im.php",{act:"a_stickers_buy",pack_id:e,hash:o,peer:n,sticker_referrer:(0,I.unclean)(r)},{onDone:function(t,i,o,n,s,a){if((0,k.each)((0,g.geByClass)("_sticker_btn_"+e),(function(){this.innerHTML=n,this.onmouseover="",this.onclick="",M.FlatButton.setAppearance(this,M.FlatButtonAppearance.SECONDARY)})),cur.boxStickersPreview&&cur.boxStickersPreview.hide(),s&&cur.boxStickersStore&&cur.boxStickersStore.hide(),(0,l.showDoneBox)(t),i){_e.stickers[_e.TAB_RECENT_STICKERS].promoted=a,_e.updateTabs(i,o,!0);try{vk.widget&&window.Rpc&&window.Rpc.callMethod("proxy","updateStickers")}catch(e){}"video_live"===r&&window.Videoview&&window.Videoview.onStickersPurchased(e)}var c=cur.tabbedStickersBox;if(c&&c.tbUpdate)for(var _ in c.tbUpdate)c.tbUpdate.hasOwnProperty(_)&&(c.tbUpdate[_]=1);var d=cur.emojiId&&cur.emojiId[cur.peer];if(d){var m=(0,g.geByClass1)("emoji_tab_"+e,_e.opts[d].tt);m&&_e.tabSwitch(m,e,d)}(0,p.partConfigEnabled)("stickers_catalog_reload_after_buy")&&nav.reload({preventScroll:!0})},showProgress:()=>M.FlatButton.lock(i),hideProgress:()=>M.FlatButton.unlock(i),onFail:function(e){return e&&setTimeout((0,C.showFastBox)((0,y.getLang)("global_error"),e).hide,3e3),!0}}),(0,m.cancelEvent)(t)},stickerAct:function(e,t,i,o,r){var n=M.FlatButton.getAppearance(e)===M.FlatButtonAppearance.SECONDARY;if(r&&n)return!0;var s=(r?n:(0,g.hasClass)(e,"_im_sticker_activated"))?1:0,a=cur.tabbedStickersBox;if(a)for(var c in a.tbUpdate)a.tbUpdate.hasOwnProperty(c)&&(a.tbUpdate[c]=1);return ajax.post("/al_im.php",{act:"a_stickers_switch",pack_id:t,hash:i,state:s,from_btn:r?1:0},{onDone:function(i,o,n,a){r||(M.FlatButton.setLabel(e,i),e.onmouseover="",(0,g.setStyle)(e,{width:"auto"}),(0,g.toggleClass)(e,"_im_sticker_activated",!s)),(0,k.each)((0,g.geByClass)("_sticker_btn_"+t),(function(){M.FlatButton.setLabel(this,a),this.onmouseover="";var e=s?M.FlatButtonAppearance.PRIMARY:M.FlatButtonAppearance.SECONDARY;M.FlatButton.setAppearance(this,e)})),_e.updateTabs(o,n,!0);var c=e.parentNode.parentNode;if(!r){if(cur.stickersSorter.destroy(),s){(0,g.show)("im_stickers_deact");var l=(0,g.ge)("im_stickers_deact_wrap");l.firstChild?l.insertBefore(c,l.firstChild):l.appendChild(c),(0,g.setStyle)(c,{cursor:"default"})}else{(0,g.geByTag1)("div","im_stickers_my_wrap").appendChild(c),(0,g.ge)("im_stickers_deact_wrap").childNodes.length||(0,g.hide)("im_stickers_deact")}cur.stickersSorterInit()}},showProgress:()=>M.FlatButton.lock(e),hideProgress:()=>M.FlatButton.unlock(e)}),(0,m.cancelEvent)(o)},getTabsCode:function(e,t){var i=[];e&&i.push.apply(i,e),i.length>1&&(_e.hasNewStickers=!1);for(var o=_e.opts[t].forceStickerPack,r="",n="",s="",a=0,c=i;a<c.length;a++){var l=c[a],_=l[0],d=l[1],m=l[3],u=l[4]&&_===o,v=l[5];if(d||m||u){var f=l[6],h=l[7],p=l[8],k=l[9],g=void 0;if(d||u?(_>0&&-1===_e.stickerPacksToLoad.indexOf(_)&&_e.stickerPacksToLoad.push(_),g="Emoji.tabSwitch(this, "+_+", "+t+"); return cancelEvent(event);"):g="Emoji.previewSticker("+_+", false, {sticker_referrer: 'keyboard'}); return cancelEvent(event);",l[2]&&(_e.hasNewStickers=l[2]),_===_e.TAB_VMOJI)r+=`\n        <a class="${(0,O.classNames)(`emoji_tab emoji_tab_${_} emoji_tab--vmoji-stub`,{emoji_tab_sel:cur.stickersTab==_})}" onmousedown="${g}" onclick="return cancelEvent(event);">\n          ${(0,F.getIcon24VmojiOutline)().icon}\n        </a>\n      `;else if(_===_e.TAB_RECENT_STICKERS){var w="emoji_tab emoji_tab_img_cont emoji_tab_recent emoji_tab_"+_;cur.stickersTab==_&&(w+=" emoji_tab_sel"),r+='<a class="'+w+'" onmousedown="'+g+'" onclick="return cancelEvent(event);"><span class="emoji_tab_icon emoji_sprite emoji_tab_icon_recent"></span></a>'}else if(_===_e.TAB_FAVORITE_STICKERS)r+=_e.tabs.favoriteTabContent(g,f);else if(_){var E="emoji_tab emoji_tab_img_cont emoji_tab_"+_;(h||p)&&(E+=" emoji_tab_is_new"),cur.stickersTab==_&&(E+=" emoji_tab_sel"),d||u||(E+=" emoji_tab_promo"),k&&(E+=" emoji_tab--vmoji");var S='<a class="'+E+'" onmousedown="'+g+'" onclick="return cancelEvent(event);"><img width="22" height="22" src="'+v+'" class="emoji_tab_img" /></a>';k?s+=S:u?n=S+n:n+=S}else{var b="emoji_tab emoji_tab_"+_;cur.stickersTab==_&&(b+=" emoji_tab_sel"),d||(b+=" emoji_tab_promo"),r+='<a class="'+b+'" onmousedown="'+g+'" onclick="return cancelEvent(event);"><div class="emoji_tab_icon emoji_sprite emoji_tab_icon_'+_+'"></div></a>'}}}return s&&(s=`<span class="emoji_tabs_group emoji_tabs_group--vmoji">${s}</span>`),r+s+n},updateTabsOpt:function(e,t,i){void 0===i&&(i=!0);var o=_e.opts[e];if(!o.noStickers){var r=(0,g.ge)("emoji_tabs_cont_"+e);r&&(r.innerHTML=_e.getTabsCode(window.emojiStickers,e)),i&&_e.throwTabsScroll(e),_e.checkNewStickers(o),void 0!==typeof t&&(o.stickersInited=!!t)}},updateTabs:function(e,t,i){e&&i&&window.Notifier&&Notifier.lcSend("emoji",{act:"updateTabs",newStickers:e,keywords:t});var o=0;for(var r in void 0===t?((0,Q.initStickersKeywords)(),window.stickersKeywordsData||(o=1)):(window.stickersKeywordsData=t,(0,Q.setStickersKeywords)(window.stickersKeywordsData,i)),void 0===e?window.emojiStickers&&window.stickersKeywordsData||(0,Z.cachedStickersKeywordsTime)().then((e=>{ajax.post("al_im.php",{act:"a_stickers_list",need_keywords:o,cache_time:e},{onDone:_e.updateTabs})})):window.emojiStickers=e,_e.opts)_e.opts.hasOwnProperty(r)&&_e.updateTabsOpt(r,!1);var n=_e.stickers&&(0,k.clone)(_e.stickers);n&&delete n[_e.TAB_RECENT_STICKERS],_e.onStickersLoad&&window.emojiStickers&&!(0,I.isEmpty)(n)&&(_e.onStickersLoad(),_e.onStickersLoad=!1)},showStickersStoreNotification(){Array.from(document.querySelectorAll(".emoji_smile")).filter((e=>!e.querySelector(".emoji_smile_icon_promo"))).forEach((e=>{e.appendChild((0,g.ce)("div",{className:"emoji_smile_icon_promo"}))})),window.nav.enableDot(ne.PAGE_ID_STICKERS)},hideStickersStoreNotification(){document.querySelectorAll(".emoji_smile_icon_promo").forEach((e=>{e.parentNode.removeChild(e)})),window.nav.disableDot(ne.PAGE_ID_STICKERS)},checkNewStickers:function(e){var t=e.txt;if(!e.noStickers&&!e.noStickersStore&&window.emojiStickers&&t&&t.getAttribute("contenteditable")){for(var i in window.emojiStickers)if(window.emojiStickers.hasOwnProperty(i)&&window.emojiStickers[i][2]){_e.hasNewStickers=window.emojiStickers[i][2];break}_e.hasNewStickers<0&&!_e.noNewStickers&&setTimeout((()=>_e.showStickersStoreNotification()),(0,g.hasClass)(t,"fc_editable")?200:0)}},giftStickerToCurrentPeer(e,t,i){var o=this.getPeerId();R.Ranges.isUserId(o)||R.Ranges.isChatOrChannelPeer(o)?this.giftSticker(e,o,t,i):this.giftSticker(e,"",t,i)},giftSticker:function(e,t,i,o){if(le())return(0,x.giftStickerProducts)([e],t?String(t).split(",").map((e=>Number(e))):[],{ref:o.sticker_referrer||"store",gift_ref:o.ref}),(0,m.cancelEvent)(i);var r={act:"stickers_gift_box",pack_id:e,peers:t,ref:(o=o||{}).ref};return o.from&&(r.from=o.from),r.sticker_referrer=o.sticker_referrer||"store",boxLayerWrap.scrollTop=0,(0,C.showBox)("/al_im.php",r,{stat:["wide_dd.js","wide_dd.css","notifier.css","notifier.js"],dark:1}),(0,m.cancelEvent)(i)},toggleStickers:function(e,t){var i=_e.opts[e];i&&(i.noStickers=t,i.tt&&((0,g.toggleClass)(i.tt,"emoji_no_tabs",t),i.curTab&&_e.tabSwitch(0,0,e)))},getSizeCached:function(e){return(e=(0,g.ge)(e))?(void 0!==e[_e.CACHED_WIDTH_PROP]&&void 0!==e[_e.CACHED_HEIGHT_PROP]||(e[_e.CACHED_WIDTH_PROP]=e.offsetWidth,e[_e.CACHED_HEIGHT_PROP]=e.offsetHeight),[e[_e.CACHED_WIDTH_PROP],e[_e.CACHED_HEIGHT_PROP]]):[0,0]},clearSizeCached:function(e){(e=(0,g.ge)(e))&&(e[_e.CACHED_WIDTH_PROP]=void 0,e[_e.CACHED_HEIGHT_PROP]=void 0)},getStickerReferrer:function(e,t){void 0===t&&(t=null);var i=_e.opts[t];return i&&"stories"===i.ref?_e.STICKER_REFERRERS.STORY_KEYBOARD:e===_e.TAB_RECENT_STICKERS?_e.STICKER_REFERRERS.RECENT:e===_e.TAB_FAVORITE_STICKERS?_e.STICKER_REFERRERS.FAVORITE:e===_e.TAB_NEW_CONVO_STICKERS?_e.STICKER_REFERRERS.NEW_CONVO:_e.STICKER_REFERRERS.KEYBOARD},render:{stickerHintRs:function(e,t,i){var o=t,n="",s=o<0&&!(0,p.partConfigEnabled)("stickers_can_send_unpurchased_stickers");if(o<0)n=window.promotedStickerUrls&&window.promotedStickerUrls[-o];else if(i)n=i[2];else{var a=(0,N.getSticker)(o);a&&(n=(0,B.getStickerImageUrl)(a,64,64))}var c=i?i[3]:"",l={optId:e,selId:0,stickerId:o,stickerUrl:n,class:s?"promo":"",onclick:"Emoji.stickerHintClick("+e+", "+o+", '"+n+"', this)"},_="";return(!r.browser.msie||r.browser.msie_edge)&&c&&n?(_=_e.hintsStickerItemAnimation(),l.animationUrl=c,l.class+=" sticker_animation"):n&&(_=_e.hintsStickerItem()),(0,g.rs)(_,l)}},resetStickersCache(){_e.stickers={},_e.resetVmojiAvatarCache(),cur.boxMyStickers&&(cur.boxMyStickers.isVisible()||cur.boxMyStickers.setOptions({onShow(){cur.boxMyStickers.hide(),_e.showMyStickers()}}))},_vmojiAvatarCache:void 0,showVmojiAvatar(e,t,i){var o=(0,l.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,l.isBoxLoadingCancelled)(o)||((0,l.hideBoxLoader)(),window.Vmoji.showAvatar(e,t,i))}))},getVmojiAvatar:()=>void 0!==_e._vmojiAvatarCache?Promise.resolve(_e._vmojiAvatarCache):(0,q.vmojiGetAvatar)().then((e=>{var t=e.avatar,i=void 0===t?null:t;return _e._vmojiAvatarCache=i,i})),resetVmojiAvatarCache(){_e._vmojiAvatarCache=void 0},createVmojiAvatar(){var e=(0,l.showBoxLoader)();window.stManager.add(window.jsc("web/vmoji.js")).then((()=>{(0,l.isBoxLoadingCancelled)(e)||((0,l.hideBoxLoader)(),window.Vmoji.createAvatar())}))},__eof:1}},494422:(e,t,i)=>{"use strict";i.d(t,{getCaretBoundingRect:()=>o});var o=function(e){var t=e.getBoundingClientRect(),i=null,o=null;if(t.top===t.bottom)return{left:0,top:0,bottom:0};if(document.selection)(i=(o=document.selection.createRange()).getClientRects()||[]).length||(o.text="_",o.moveStart("character",-1),i=o.getClientRects(),o.text=""),i=i[i.length-1];else if(window.getSelection){var r=getSelection();if(r.anchorNode){if((o=r.getRangeAt(0)).collapsed){var n=o.startOffset;o.setStart(o.startContainer,0),i=o.getClientRects(),o.setStart(o.startContainer,n)}i=i&&i.length?i[i.length-1]:{right:t.left,top:t.top,bottom:t.top}}else i={right:0,top:0,bottom:0}}return{left:i.right-t.left,top:i.top-t.top,bottom:i.bottom-t.top}}},408270:(e,t,i)=>{"use strict";i.d(t,{EMOJI_SECTIONS_CODES:()=>n});i(821249);var o=i(625488),r={1:["😀","😃","😄","😁","😅","😆","😂","🤣","😉","😊","☺","🙂","🙃","😇","😗","😙","😚","😘","😍","🥰","🤩","🤗","😋","😜","🤪","😛","😝","🤑","🤭","🤐","🤫","😶","🤔","🤨","🧐","😐","😑","🙄","😬","🤥","😏","😌","🤤","😴","🤓","😎","🥳","🤠","😒","😔","😪","😕","😟","🙁","☹","😮","😯","😲","😳","🥺","😦","😧","😨","😰","😥","😢","😭","😱","😖","😣","😞","😓","😩","😫","😷","🤒","🤕","🤢","🤮","🤧","🥶","🥵","🥴","😵","🤯","😤","😠","😡","🤬","😈","👿","💀","☠","💩","🤡","👹","👺","👻","👽","👾","🤖","😺","😸","😹","😻","😼","😽","🙀","😿","😾","🙈","🙉","🙊","🦠"],2:["🐵","🐒","🦍","🐶","🐕","🐩","🐺","🦊","🦝","🐱","🐈","🦁","🐯","🐅","🐆","🐴","🐎","🦄","🦓","🦌","🐮","🐂","🐃","🐄","🐷","🐽","🐖","🐗","🐏","🐑","🐐","🐪","🐫","🦙","🦒","🐘","🦏","🦛","🐭","🐁","🐀","🐹","🐰","🐇","🐿","🦔","🦇","🐻","🐨","🐼","🦘","🦡","🐾","🦃","🐔","🐓","🐣","🐤","🐥","🐦","🐧","🕊","🦅","🦆","🦢","🦉","🦚","🦜","🐸","🐊","🐢","🦎","🐍","🐲","🐉","🦕","🦖","🐳","🐋","🐬","🐟","🐠","🐡","🦈","🐙","🦀","🦞","🦐","🦑","🐚","🐌","🦋","🐛","🐜","🐝","🐞","🦗","🕷","🕸","🦂","🦟","💐","🌸","💮","🏵","🌹","🥀","🌺","🌻","🌼","🌷","🌳","🌲","🎄","🌴","🌵","🌾","🌱","🌿","☘","🍀","🍁","🍂","🍃","🌑","🌒","🌓","🌔","🌕","🌖","🌗","🌘","🌙","🌚","🌛","🌜","🌡","☀","🌝","🌞","⭐","🌟","🌠","☁","⛅","⛈","🌤","🌥","🌦","🌧","🌨","🌩","🌪","🌫","🌬","💨","🌀","🌈","🌂","☂","☔","⛱","⚡","❄","☃","⛄","☄","🔥","💦","💧","🌊"],3:["👍🏻","👎🏻","👌🏻","✌🏻","🤞🏻","🤟🏻","🤘🏻","🤙🏻","🖕🏻","✊🏻","👊🏻","🤛🏻","🤜🏻","👈🏻","👉🏻","👆🏻","👇🏻","☝🏻","👋🏻","🤚🏻","🖐🏻","✋🏻","🖖🏻","👏🏻","🙌🏻","👐🏻","🤲🏻","🤝🏻","🙏🏻","💪🏻","🦵🏻","🦶🏻","👂🏻","👃🏻","🧠","🦷","🦴","👀","👁","👅","👄","✍🏻","💅🏻","🤳","👫","👭","👬","👩‍❤️‍💋‍👨","👨‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👩‍❤️‍👨","👨‍❤️‍👨","👩‍❤️‍👩","👪","👶","🧒","👦","👧","🧑","👱","👨","🧔","👱‍♂️","👨‍🦰","👨‍🦱","👨‍🦳","👨‍🦲","👩","👱‍♀️","👩‍🦰","👩‍🦱","👩‍🦳","👩‍🦲","🧓️","👴️","👵️","🙍‍♂️️","🙍‍♀️️","🙎‍♂️","🙎‍♀️️","🙅‍♂️","🙅‍♀️","🙆‍♂️","🙆‍♀️","💁‍♂️","💁‍♀️️","🙋‍♂️","🙋‍♀️️","🙇‍♂️","🙇‍♀️️","🤦‍♂️","🤦‍♀️","🤷‍♂️","🤷‍♀️","💆‍♂️️","💆‍♀️","💇‍♂️️","💇‍♀️","🚶‍♂️️","🚶‍♀️️","🏃‍♂️️","🏃‍♀️","💃","🕺","🕴️","👯‍♂️️","👯‍♀️","🧖‍♂️","🧖‍♀️️","👼","🎅","🤶","🦸‍♂️","🦸‍♀️","🦹‍♂️","🦹‍♀️","🧙‍♂️","🧙‍♀️","🧚‍♂️","🧚‍♀️","🧛‍♂️","🧛‍♀️","🧜‍♂️","🧜‍♀️","🧝‍♂️","🧝‍♀️","🧞‍♂️","🧞‍♀️","🧟‍♂️","🧟‍♀️","👨‍⚕️","👩‍⚕️","👨‍🎓","👩‍🎓","👨‍🏫","👩‍🏫","👨‍⚖️","👩‍⚖️","👨‍🌾","👩‍🌾","👨‍🍳","👩‍🍳","👨‍🔧","👩‍🔧","👨‍🏭","👩‍🏭","👨‍💼","👩‍💼","👨‍🔬","👩‍🔬","👨‍💻","👩‍💻","👨‍🎤","👩‍🎤","👨‍🎨","👩‍🎨","👨‍✈️","👩‍✈️","👨‍🚀","👩‍🚀","👨‍🚒","👩‍🚒","👮‍♂️","👮‍♀️","🕵️‍♂️","🕵️‍♀️","💂‍♂️","💂‍♀️","👷‍♂️","👷‍♀️","🤴","👸","👳‍♂️","👳‍♀️","👲","🧕","🤵","👰","🤰","🤱","🛀","🛌"],4:["🍏","🍎","🍐","🍅","🥝","🍑","🍒","🍓","🍇","🍈","🍉","🍊","🍋","🍌","🍍","🥭","🥥","🥑","🍆","🥔","🥕","🌽","🌶","🥒","🥬","🥦","🍄","🥜","🌰","🍞","🥐","🥖","🥨","🥯","🥞","🧀","🍖","🍗","🥩","🥓","🍔","🍟","🍕","🌭","🥪","🌮","🌯","🥙","🥚","🍳","🥘","🍲","🥣","🥗","🍿","🧂","🥫","🍱","🍘","🍙","🍚","🍛","🍜","🍝","🍠","🍢","🍣","🍤","🍥","🥮","🍡","🥟","🥠","🥡","🍦","🍧","🍨","🍩","🍪","🎂","🍰","🧁","🥧","🍫","🍬","🍭","🍮","🍯","🍼","🥛","☕","🍵","🍶","🍾","🍷","🍸","🍹","🍺","🍻","🥂","🥃","🥤","🥢","🍽","🍴","🥄"],5:["⚽","⚾","🥎","🏀","🏐","🏈","🏉","🎾","🥏","🎳","🏏","🏑","🏒","🥍","🏓","🏸","🥊","🥋","🥅","⛳","⛸","🎣","🎽","🛹","🎿","🛷","🥌","🎯","🎱","🎮","🕹","🎰","🎲","🧩","♟","🧗‍♂️️","🧗‍♀️","🤺","🏇","⛷","🏂","🏌️‍♂️","🏌️‍♀️","🏄‍♂️","🏄‍♀️","🚣‍♂️","🚣‍♀️","🏊‍♂️","🏊‍♀️","⛹️‍♂️","⛹️‍♀️","🏋️‍♂️","🏋️‍♀️","🚴‍♂️","🚴‍♀️","🚵‍♂️","🚵‍♀️","🤸","🤼‍♂️","🤼‍♀️","🤽‍♂️","🤽‍♀️","🤾‍♂️","🤾‍♀️","🤹‍♂️","🤹‍♀️","🧘‍♂️","🧘‍♀️","🎖","🏆","🏅","🥇","🥈","🥉"],6:["🚂","🚃","🚄","🚅","🚆","🚇","🚈","🚉","🚊","🚝","🚞","🚋","🚌","🚍","🚎","🚐","🚑","🚒","🚓","🚔","🚕","🚖","🚗","🚘","🚙","🚚","🚛","🚜","🏎","🏍","🛵","🚲","🛴","🚏","🛣","🛤","🛢","⛽","🚨","🚥","🚦","🛑","🚧","⚓","⛵","🛶","🚤","🛳","⛴","🛥","🚢","✈","🛩","🛫","🛬","💺","🚁","🚟","🚠","🚡","🛰","🚀","🛸","🌍","🌎","🌏","🌐","🗺","🗾","🧭","🏔","⛰","🌋","🗻","🏕","🏖","🏜","🏝","🏞","🏟","🏛","🏗","🧱","🏘","🏚","🏠","🏡","🏢","🏣","🏤","🏥","🏦","🏨","🏩","🏪","🏫","🏬","🏭","🏯","🏰","💒","🗼","🗽","⛪","🕌","🕍","⛩","🕋","⛲","⛺","🌁","🌃","🏙","🌄","🌅","🌆","🌇","🌉","♨","🌌","🎠","🎡","🎢","💈","🎪"],7:["🎙","🎚","🎛","🎤","🎧","📻","🎷","🎸","🎹","🎺","🎻","🥁","📯","🎭","🖼","🎨","🧵","🧶","🔮","🧿","🧸","🃏","🀄","🎴","🎃","🎆","🎇","🧨","✨","🎈","🎉","🎊","🎋","🎍","🎎","🎏","🎐","🎑","🧧","🎀","🎁","🎗","🎟","🎫","🛎","🧳","⌛","⏳","⌚","⏰","⏱","⏲","🕰","👓","🕶","🥽","🥼","👔","👕","👖","🧣","🧤","🧥","🧦","👗","👘","👙","👚","👛","👜","👝","🛍","🎒","👞","👟","🥾","🥿","👠","👡","👢","👑","👒","🎩","🎓","🧢","⛑","📿","💄","💍","💎","📱","📲","☎","📞","📟","📠","🔋","🔌","💻","🖥","🖨","⌨","🖱","🖲","💽","💾","💿","📀","🧮","🎥","🎞","📽","🎬","📺","📷","📸","📹","📼","🔍","🔎","🕯","💡","🔦","🏮","📔","📕","📖","📗","📘","📙","📚","📓","📒","📃","📜","📄","📰","🗞","📑","🔖","🏷","💰","💴","💵","💶","💷","💸","💳","🧾","💹","💱","💲","✉","💌","📧","📨","📩","📤","📥","📦","📫","📪","📬","📭","📮","🗳","✏","✒","🖋","🖊","🖌","🖍","📝","💼","📁","📂","🗂","📅","📆","🗒","🗓","📇","📈","📉","📊","📋","📌","📍","📎","🖇","📏","📐","✂","🗃","🗄","🗑","🔒","🔓","🔏","🔐","🔑","🗝","🔨","⛏","⚒","🛠","🗡","⚔","🔪","🔫","🏹","🛡","🔧","🔩","⚙","🗜","⚖","🔗","⛓","🧰","🧲","⚗","🧪","🧫","🧬","🔬","🔭","📡","💉","💊","🚪","🛏","🛋","🚽","🚿","🛁","🧴","🧷","🧹","🧺","🧻","🧼","🧽","🧯","🛒","🚬","⚰","⚱","🏺","🗿"],8:["💋","❤","💔","❣","💘","💝","💖","💗","💓","💞","💕","💟","💜","🧡","💛","💚","💙","🖤","💯","💢","💥","💫","🕳","💣","💬","👁️‍🗨️","🗨","🗯","💭","💤","🗣","👤","👥","👣","🔇","🔊","📢","📣","🔔","🔕","🎼","🎵","🎶","⚠","🚸","☢","☣","🆚","🆓","🆕","🚮","🚾","🚭","✅","♻","⚕","🔱","‼","⁉","❓","❗","🆘","⛔","🚫","🚳","🚯","🚱","🚷","📵","🔞"],9:["🇷🇺","🇰🇿","🇧🇾","🇺🇦","🇲🇳","🇬🇪","🇦🇿","🇹🇯","🇧🇷","🇱🇹","🇱🇻","🇪🇪","🇦🇲","🏁","🚩","🎌","🏴","🏳","🏳️‍🌈","🏴‍☠️","🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇨","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇺","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼"]},n=Object.keys(r).reduce(((e,t)=>(e[t]=r[t].map((e=>(0,o.emojiSymbolToByteHex)(e))),e)),{})},857748:(e,t,i)=>{"use strict";i.d(t,{parseAttachmentId:()=>o,prepareImageBounds:()=>r,getPhotoSize:()=>n});i(702707),i(426833),i(804723);function o(e){if(!e||"string"!=typeof e)return null;var t=e.match(/(photo|doc)(-?\d+)_(\d+)/);if(!t)return null;var i=t[1],o=parseInt(t[2]),r=parseInt(t[3]),n=[o,r].join("_");return{type:i,ownerId:o,id:r,rawId:n}}function r(e,t){var i=e;return e>68&&(i=68),t>68&&(i=68*e/t),[i,i*(t/e)]}function n(e,t,i){if(!e||!t||!i)return null;var o=Object.values(e).sort(((e,t)=>e[1]-t[1]||e[2]-t[2]));return o.find((e=>e[1]>=t&&e[2]>=i))||o[parseInt(o.length/2)]||o[0]}},453262:(e,t,i)=>{"use strict";i.d(t,{StickersAnimation:()=>o.StickersAnimation});i(66992),i(241539),i(788674),i(333948);var o=i(802215);o.StickersAnimation.init({animatorLoader:()=>Promise.all([Promise.all([i.e(76429),i.e(75514),i.e(68592),i.e(28477),i.e(79344)]).then(i.bind(i,826443)).then((e=>e.LottieManager)),Promise.all([i.e(38288),i.e(55489)]).then(i.bind(i,809499)).then((e=>e.lottie))])})},11122:(e,t,i)=>{"use strict";i.d(t,{default:()=>f});i(66992),i(319601),i(569720),i(324603),i(339714),i(804723),i(115306),i(333948);var o=i(962857),r=i(850167);function n(){return n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},n.apply(this,arguments)}var s=["мне","тебе","ему","ей","маме","папе","сестре","брату","родителям"],a=["ден(?:ьги|ежки|ьгу|ежку|ег|ежек|як)","дол(?:г|жок)","(?:(?:в|на)\\s)подар(?:ок|ки)"],c=["переводом","(?:(?:по|на)\\s)(?:номеру?\\s)?(?:карт(?:у|очку|ы|очки)|тел(?:ефона)?)","(?:по\\s)?безнал(?:у|ичке|ом|ичкой)","на\\sсбер(?:банк)?"],l=["сот(?:оч)ку","\\d+(?:\\s*р(?:[.,\\s]|уб(?:лей)?|$))?"],_=new RegExp(`(${l.join(")|(")})`);function d(e,t){return"amount"===e?function(e){var t=e.match(_);if(t){if(t[1])return 100;if(t[2])return parseInt(t[2])}return 0}(t):t}var m=new RegExp(`^(?:(${["(?:за|с|пере)?кин(?:ь(?:ся)?|ьте(?:сь)?|ешь(?:ся)?|ете(?:сь)?)","переве(?:ди|дите|дешь|дете)","отправ(?:ь|ьте|ишь|ите)","соб(?:ери|ерите|ерешь|ерете)","(?:от)?да(?:й|йте|шь|дите)","верн(?:и|ите|ешь|ете)","возвра(?:ти|тите|тишь|щай|щайте)","займ(?:и|ите|ешь)"].join("|")})|(${["перевод","(?:за|с|пере)?кин(?:уть(?:ся)?|у(?:сь)?|ем(?:ся)?)","переве(?:сти|вожу|дим|ду|ем)","отправ(?:ить|ляю|ляем|лю|им)","(?:со)?б(?:рать|ираю|ираем|еру|ерем)","(?:от)?да(?:ть|ю|ем|м|дим)","верн(?:уть|у|ем)","возвра(?:тить|щу|тим|щаю|щаем)"].join("|")}))((?:\\s+(?:${[...s,...a,...c,...l].join("|")}))+)\\s*$`),u=new RegExp(`(${s.join("|")})|(${a.join("|")})|(${c.join("|")})|(${l.join("|")})`,"gi"),v={DEFAULT_QUERY:"деньги",introViewed:!1,match:function(e,t){void 0===t&&(t=0);var i=e.toLowerCase().replace(/ё/g,"е").match(m);if(i){for(var o={input:e,request:i[1],send:i[2],context:i[3]};i=u.exec(o.context),i;)for(var r={receiver:i[1],subject:i[2],method:i[3],amount:i[4]},n=0,s=Object.entries(r);n<s.length;n++){var a=s[n],c=a[0],l=a[1];l&&(o[c]=d(c,l))}if(o.subject||o.method||o.amount)return o}return null},setIntroViewed:function(e){this.introViewed=e},onClick:function(e,t,i,s,a){if(void 0===s&&(s=0),void 0===a&&(a={}),this.introViewed){var c=[e,t,i,s].join("_");o.MoneyTransfer.showMoneyTransferBox({tab:i,amount:s,owner_id:e,to_id:t,from:"sticker_link"},{cache:this.lastBoxId===c},void 0,(()=>{cur.paymentsOptions&&(cur.paymentsOptions.onSendStart=a.onSendStart)})),this.lastBoxId=c}else(0,r.showWiki)(n({w:"moneysend_promo",fromId:e,toId:t,action:i},s?{amount:s}:{})),this.introViewed=!0}};const f=v},451620:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{tooltips:()=>tooltips});var _shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(40906),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(49535),_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(635676),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(695724),_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(315544),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(787481),tooltips={show:function show(el,options){if(window.AudioPage&&window.AudioPage.forceFix&&window.AudioPage.forceFix(),el.hidetimer)return el.hidetimer&&clearTimeout(el.hidetimer),void(el.hidetimer=0);if(el.tt){if("object"==typeof el.tt&&(el.tt.shown=!1),el.ttimer&&clearTimeout(el.ttimer),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(options.text)){var ttText=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domByClass)(el.tt.container,"tt_text");if(ttText){var text=options.text();if(!text)return;ttText.innerHTML=text}}var opts=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(el.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(el.tt.opts):{},options||{}),isNewTT=void 0!==opts.dir,canshow;if(!el.tt.el)return el.tt="show",void(el.ttimer=setTimeout((function(){if(el.tt.el)return opts.showdt=0,void tooltips.show(el,opts);el.tt="shownow"}),opts.showdt||0));if(opts.js){var evalString="(function(){return function(){var tip=this;"+opts.js+"};})()";try{var evalResult=eval(evalString),evalApply=evalResult.apply(el.tt);canshow=!1!==evalApply}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalString)}}else canshow=!0;canshow&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(el.tt.container)?el.tt.showing||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(el.tt.container,{opacity:1},void 0!==opts.showsp?opts.showsp:200):el.ttimer=setTimeout((function(){var e=el.tt.container;if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e)){var t=opts.forcexy?opts.forcexy:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(el),i=opts.forcesize?opts.forcesize:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(el,!1,!0),o=opts.toup,r=vk.rtl&&!opts.asrtl||opts.asrtl&&!vk.rtl,n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("page_header_wrap")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(el,"page_layout")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("page_header_wrap"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ge)("ads-app-header")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)("ads-app-header"):[0,0];if(i[0]||i[1]){e.style.opacity=0,opts.width&&(e.style.width=opts.width+"px"),opts.maxWidth&&(e.style["max-width"]=opts.maxWidth+"px"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e),isNewTT||(e.firstChild.className="toup"+(opts.toup?1:""));var s=opts.shift;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(s)&&(s=s()),void 0!==s&&2==s.length&&s.push(s[1]);var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e),c=bodyNode.scrollTop||htmlNode.scrollTop||0,l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e),_=t[1]-l[1]-s[1]-n[1]-c,d=lastWindowHeight-(t[1]+i[1]+l[1]+s[2])+c,m=_<0,u=d<0,v=_<0;m&&u?(_>d&&_+c>0&&(o=!0,v=!1),o&&v?o=!1:o||!u||v||(o=!0)):o&&m?o=!1:o||!u||m||(o=!0);var f=opts.needLeft||(opts.black||opts.checkLeft)&&window.lastWindowWidth&&lastWindowWidth-(t[0]+(r?i[0]+s[0]:l[0]-s[0]))<1,h="";opts.forceright&&(f=0),opts.forcetodown&&(o=!1),opts.forcetoup&&(o=!0),isNewTT?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(e,"tt_down"),h=opts.dir&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["up","down","left","right"])?"tt_"+opts.dir:"tt_"+(o?"down":"up"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,h),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.toggleClass)(e,"toleft",!!f),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)):(h="toup"+(o?1:""),(o!=opts.toup||f)&&(h+=f?" toleft":"",l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(e)),e.firstChild.className=h,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,o?"tt_toup":""));var p,k=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(a);if(t[0]-=k[0],t[1]-=k[1],el.tt.zIndexEls=[],!opts.noZIndex)for(;a&&a!=bodyNode&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(a,"scroll_fix");){var g=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getStyle)(a,"zIndex")),w=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(a.ttCount);if(g&&!w)break;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(a,"zIndex",opts.zIndex||100),el.tt.zIndexEls.push(a),a.ttCount=w+1,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(a)}var E=(p=isNewTT?!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.inArray)(opts.dir,["left","right"])||opts.forcetoup||opts.forcetodown?o?t[1]-(l[1]+s[1]):t[1]+i[1]+s[2]:t[1]-Math.floor(l[1]/2)-s[1]:t[1]+(o?-(l[1]+s[1]):i[1]+s[2]))+(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slide)*(o?-1:1),S=t[0]+(r?s[0]+i[0]-l[0]:o?-s[0]:-(s[3]||s[0]));f&&(S-=(l[0]-(opts.reverseOffset||39))*(r?-1:1)),opts.center&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.addClass)(e,"tocenter"),l[0]!=i[0]&&(S-=r?0:(l[0]-i[0])/2));var b=S+(r?-1:1)*(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(opts.slideX);if(opts.showIfFit&&(S+k[0]<0||S+k[0]+l[0]>lastWindowWidth||p+k[1]<0||p+k[1]+l[1]>lastWindowHeight))return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container);el.tt.showing=!0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e,{top:E,left:b});var T={opacity:1};b!=S&&(T.left=S),E!=p&&(T.top=p),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.animate)(e,T,void 0!==opts.showsp?opts.showsp:200,(function(){el.tt&&el.tt.showing&&(el.tt.showing=!1),opts.onShowEnd&&opts.onShowEnd(),"object"==typeof el.tt&&el.tt&&(el.tt.shown=!0)})),opts.onShowStart&&opts.onShowStart(el.tt)}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(el.tt.container)}}),opts.showdt||0))}},clearZindex:function(e){e.tt&&e.tt.opts&&e.tt.zIndexEls&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e.tt.zIndexEls,(function(){var e=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(this.ttCount);e<=1?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(this,"zIndex",""),this.ttCount=0):this.ttCount=e-1}))},hide:function(e,t){if("shownow"!==e.tt){if(e.tt&&"object"==typeof e.tt&&(e.tt.shown=!1),(t||{}).fasthide)return clearTimeout(e.hidetimer),clearTimeout(e.ttimer),e.hidetimer=0,e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);e.hidetimer||(e.hidetimer=setTimeout((function(){if(e.hidetimer=0,clearTimeout(e.ttimer),!e.tt||"hide"==e.tt||e.tt.el&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isVisible)(e.tt.container))return e.tt&&e.tt.el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.tt.container),void tooltips.clearZindex(e);var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt.opts?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(e.tt.opts):{},t||{});e.tt.el?e.ttimer=setTimeout((function(){i.hasover||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"none"}),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_2__.fadeOut)(e.tt.container,void 0!==i.showsp?i.showsp:200,(function(){e.tt&&e.tt.container&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(e.tt.container,{pointerEvents:"auto"}),tooltips.clearZindex(e)})),i.onHide&&i.onHide()}),i.hidedt||0):e.tt="hide"}),1))}},hideAll:function(e){if(cur.tooltips)for(var t=0;t<cur.tooltips.length;++t){var i=cur.tooltips[t];e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(i.el,e)||(i.opts.forceNoHide||(i.el&&i.el.ttimer&&clearTimeout(i.el.ttimer),i.hide({fasthide:!0})))}},rePositionTT:function(e){if(e){var t=e.opts,i=e.el,o=e.container,r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)(i),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(i,!1,!0);if(n[0]||n[1]){var s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getSize)(o),a=t.needLeft||t.black&&lastWindowWidth&&lastWindowWidth-(r[0]+s[0])<1,c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(o.firstChild,"toup1")||t.toup||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(o,"tt_down"),l=t.shift,_=vk.rtl&&!t.asrtl||t.asrtl&&!vk.rtl;(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(l)&&(l=l());var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.getXY)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(o));r[0]-=d[0],r[1]-=d[1];var m=r[0]+(_?l[0]+n[0]-s[0]:c?-l[0]:-(l[3]||l[0]));a&&(m-=s[0]-39),t.center&&s[0]!=n[0]&&(m-=(s[0]-n[0])/2);var u=r[1]+(c?-(s[1]+l[1]):n[1]+l[2]);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(o,{left:m,top:u})}}},rePositionAll:function(){if(cur.tooltips)for(var e=0;e<cur.tooltips.length;++e){var t=cur.tooltips[e].opts;t&&(t.nohideover||t.nohide)&&tooltips.rePositionTT(cur.tooltips[e])}},destroy:function(e){if(e){if(clearTimeout(e.ttimer),clearTimeout(e.hidetimer),e.tt&&e.tt.el){if(e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.cleanElems)(e.tt.container),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(e,"click",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(window,"scroll",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.removeEvent)(document,"click",e.tthide),e.tt.container){var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e.tt.container);t&&t.removeChild(e.tt.container)}tooltips.clearZindex(e),e.tt.el=!1}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeAttr)(e,"tt","tthide","ttimer","hidetimer")}},destroyAll:function(e){if(cur.tooltips){for(var t=0;t<cur.tooltips.length;++t)e&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.isAncestor)(cur.tooltips[t].el,e)||cur.tooltips[t].destroy();e||delete cur.tooltips}},create:function(e,t){var i;void 0!==t.shift&&2==t.shift.length&&t.shift.push(t.shift[1]);var o=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({shift:t.black?[11,8,8]:void 0!==t.dir?[2,8,8]:[2,3,3],toup:!0},t);t.black&&!o.dir&&(o.dir="auto",o.typeClass="tt_black"),e.tthide||(e.tthide=tooltips.hide.pbind(e),t.nohide||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",e.tthide),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(window,"scroll",e.tthide),t.hideOnTooltipContainerClick||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"click",e.tthide),t.hasover||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(document,"click",e.tthide)));var r=o.no_shadow?" tt_no_shadow":"";if(!o.content){if(e.tt&&!o.force)return e.hidetimer?(clearTimeout(e.hidetimer),void(e.hidetimer=0)):void 0;if(!o.text){if(!o.url)return;return clearTimeout(e.ttimer),void(e.ttimer=setTimeout((function(){e.tt="show",ajax.post(o.url,o.params||{},{onDone:function(t,i){var r=e.tt,n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(o);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{content:t||"",js:i}),tooltips.create(e,n),"shownow"==r&&tooltips.show(e,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(n,{showdt:0}))},onFail:function(){return!0},cache:o.cache||0}),tooltips.show(e,o)}),o.ajaxdt||0))}o.content='<div class="tt_text">'+((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(o.text)?o.text():o.text),o.link&&(o.content+='<br /><a style="display: flex; margin-top: 8px" target="_blank" href="'+o.link.link+'">'+o.link.text+"</a>"),o.content+="</div>"}var n=(void 0!==o.dir?"tt_w":"tt")+" "+(void 0!==o.dir?o.typeClass||"tt_default":"")+" "+(o.className||"");if(e.tt&&e.tt.el){var s=e.tt.container;e.tt.onClean&&e.tt.onClean(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.geByClass1)("wrapped",s).innerHTML=o.content,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(e.tt,{opts:o,show:tooltips.show.pbind(e,t)}),s.className=n,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(s)}else{var a;a=o.black?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:o.content,className:n},{display:"none"}):void 0!==o.dir?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:'<div class="wrapped">'+o.content+"</div>",className:n+r},{display:"none"}):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{innerHTML:`<table cellspacing="0" cellpadding="0">\n    <tr><td colspan="3" class="tt_top"><div class="top_pointer"></div></td></tr>\n    <tr>\n      <td class="side_sh"></td>\n      <td class="outer"><table cellspacing="0" cellpadding="0">\n        <tr><td class="side_sh"></td>\n          <td class="wrapped">${o.content}</td>\n        <td class="side_sh"></td></tr>\n        <tr><td colspan="3"><div class="bottom_sh"></div></td></tr>\n      </table></td>\n      <td class="side_sh"></td>\n    </tr>\n    <tr><td colspan="3" class="tt_bottom"><div class="bottom_sh"></div><div class="bottom_pointer${r}"></div></td></tr>\n  </table>`,className:n},{display:"none"});var c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domPN)(e);if(t.appendEl)c=t.appendEl;else if(t.appendParentCls)c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)(t.appendParentCls,c);else if(!(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_w",c)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosest)("tt_default",c)))do{c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.domClosestPositioned)(c||e,{noOverflow:!0})}while((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hasClass)(c,"tt_noappend"));c||(c=bodyNode),c.appendChild(a),i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)({el:e,opts:o,show:tooltips.show.pbind(e,t),hide:e.tthide,destroy:tooltips.destroy.pbind(e),container:a},o.tip||{}),o.nohideover||o.text&&!o.hasover||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"mouseover",i.show),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"mouseout",i.hide)),o.hideOnTooltipContainerClick&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(a,"click",i.hide),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.removeClass)(i.container,"fixed"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.setStyle)(i.container,{position:"absolute"}),e.tt=i,cur.tooltips||(cur.tooltips=[]),cur.tooltips.push(i)}o.init&&o.init(i)},addAudio:function(e,t,i,o){ajax.post("audio.php",{act:"a_add",oid:t,aid:i,hash:o},{onDone:function(){e.parentNode.replaceChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.ce)("div",{className:"fl_r add_audio_plus done"}),e)},onFail:function(){return!0},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.nextSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.previousSibling)},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.hide)(e.previousSibling),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_4__.show)(e.nextSibling)}})}}},927140:(e,t,i)=>{"use strict";i.d(t,{isHintsOfMentionsOpen:()=>r});var o=i(315544),r=function(e){var t=(0,o.data)(e,"composer");return(null==t?void 0:t.wdd)&&(0,o.isVisible)(t.wdd.listWrap)}},211314:(e,t,i)=>{"use strict";i.d(t,{getStickerKeywordsCacheData:()=>l,setStickerKeywordsCacheData:()=>_,cachedStickersKeywordsTime:()=>d});var o=i(891047),r=i(26330),n=i(19331),s="stickers_keywords",a=(0,o.createStore)("emoji-db-v1","emoji-cache"),c=function(){return(0,n.partConfigEnabled)("stickers_keywords_idb_cache")&&"indexedDB"in window.self};function l(){return c()?(0,o.get)(s,a):Promise.resolve(r.default.get(s))}function _(e){return c()?(0,o.set)(s,e,a).then((function(){r.default.remove(s)})):Promise.resolve(r.default.set(s,e))}function d(){return l().then((function(e){var t=(null==e?void 0:e.time)||0;return Math.floor(t/1e3)}))}},345435:(e,t,i)=>{"use strict";i.d(t,{initStickersKeywords:()=>c,setStickersKeywords:()=>l});var o=i(315544),r=i(211314),n=i(40906),s=i(104958),a=i(26330);function c(){window.stickersKeywordsData?l(window.stickersKeywordsData):(0,r.getStickerKeywordsCacheData)().then((function(e){if(e){var t=e.keywords;e.time>(0,n.vkNow)()-s.Emoji.stickersKeywordsExpire&&(window.stickersKeywordsData=t),window.stickersKeywordsData&&l(window.stickersKeywordsData)}}))}function l(e,t){if(e){window.stickersKeywords={};var i,c,l="",_=e.reduce((function(e,t){var i=t.words,o=t.user_stickers,r=t.promoted_stickers.map((function(e){return-e})),n=o.concat(r);return i.forEach((function(t){l+="\n"+t,e.push(n)})),e}),[]);if(i=l,c=document.createElement("div"),(0,o.val)(c,i),(l=c.textContent||c.innerText)&&l.slice("\n".length).split("\n").forEach((function(e,t){window.stickersKeywords[e]=_[t]})),!s.Emoji.stickers[s.Emoji.TAB_RECENT_STICKERS]){var d=a.default.get("recent_stickers");d&&(s.Emoji.stickers[s.Emoji.TAB_RECENT_STICKERS]=d)}t&&(0,r.setStickerKeywordsCacheData)({time:(0,n.vkNow)(),keywords:e}).then((function(){s.Emoji.updateStickersHints(!0)}))}}},791849:(e,t,i)=>{"use strict";i.d(t,{initNewStickerPicker:()=>s});var o=i(570655),r=i(66433),n=0,s=function(){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var e;return(0,o.__generator)(this,(function(t){switch(t.label){case 0:if(++n>3)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,Promise.all([i.e(76429),i.e(24509),i.e(56990),i.e(31848),i.e(28477),i.e(882)]).then(i.bind(i,209146))];case 2:return e=t.sent().StickerPickerViewer,window.StickerPickerViewer=new e,[3,4];case 3:return t.sent(),(0,r.logError)(new Error("Fail to import NewStickerPicker chunk: "+n+" try")),setTimeout((function(){s()}),3e3),[3,4];case 4:return[2]}}))}))}},543836:(e,t,i)=>{"use strict";i.d(t,{showPackByClickOnSticker:()=>s});var o,r=i(723355);!function(e){e.MESSAGE="message"}(o||(o={}));var n=function(e){return window.Emoji.previewSticker(e,!1,{sticker_referrer:o.MESSAGE})},s=function(e,t){var i;(0,r.isNewStickerPicker)()?null===(i=window.StickerPickerViewer)||void 0===i||i.api.getPack({productId:e}).then((function(i){var o,r;Boolean(null===(o=null==i?void 0:i.product)||void 0===o?void 0:o.active)?null===(r=window.StickerPickerViewer)||void 0===r||r.showPack(e,t):n(e)})).catch((function(){n(e)})):window.Emoji.getStickerPack(e).then((function(i){Boolean(i&&i[window.Emoji.PACK_FIELD_IS_ACTIVE])?window.Emoji.showPackInKeyboard(e,t):n(e)}))}},723355:(e,t,i)=>{"use strict";i.d(t,{isNewStickerPicker:()=>r});var o=i(19331);function r(){return!!(0,o.partConfigEnabled)("new_sticker_picker")}}}]);try{stManager.done("dist/a1258c00747aa03727abf8c40b9e7df9.a107c4eaee75d7bacde2.js")}catch(e){}