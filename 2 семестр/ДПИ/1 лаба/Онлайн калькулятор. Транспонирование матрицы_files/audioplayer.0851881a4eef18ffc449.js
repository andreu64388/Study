(self.webpackChunkvk=self.webpackChunkvk||[]).push([[40885],{984287:(e,t,i)=>{"use strict";i.d(t,{drawAlbumPartRow:()=>a});i(115306);var o=i(786067);function a(e){return`<div class="audio_album_part_row">${(0,o.getLang)("audio_album_part").replace("{part}",e)}</div>`}},430463:(e,t,i)=>{"use strict";i.d(t,{getAlbumParts:()=>a});var o=i(722904);function a(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){for(var t=e.getAudiosList(),i=e.getAudiosCount(),a=[],s=0,l=0;l<i;l++){var r=t[l][o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];r>s&&(s=r,a.push({number:r,offset:l}))}if(a.length>1)return a}return!1}},234247:(e,t,i)=>{"use strict";i.d(t,{showAudioAlbum:()=>l});var o=i(185850),a=i(45634),s=i(986773);function l(e,t){return cur.viewAsBox?cur.viewAsBox():(t=a.AudioUtils.audioTupleToAudioObject(t),layers.fullhide&&layers.fullhide(),(0,s.onAdditionalEvent)(e,t,{type:o.TYPE_SHOW_ALBUM}),a.AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))}},463091:(e,t,i)=>{"use strict";i.d(t,{followArtist:()=>_});var o=i(386409),a=i(45634),s=i(786067),l=i(124041),r=i(486125);function _(e,t,i,_){(0,o.lockButton)(_),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(_),onDone:i=>{(0,o.unlockButton)(_),l.FlatButton.setLabel(_,(0,s.getLang)("audio_following_artist_button")),_.classList.add("MusicAuthor__follow_btn__followed"),(0,r.showDoneBoxFull)("",{},{text:(0,s.getLang)("audio_follow_artist_success_notification_text"),title:(0,s.getLang)("audio_follow_artist_success_notification_title")}),_.onclick=o=>{o.preventDefault(),a.AudioUtils.unfollowArtist(e,t,i,_)}}})}},57472:(e,t,i)=>{"use strict";function o(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})}i.d(t,{trackArtistToOfficial:()=>o})},636760:(e,t,i)=>{"use strict";i.d(t,{unfollowArtist:()=>_});var o=i(386409),a=i(45634),s=i(786067),l=i(315544),r=i(124041);function _(e,t,i,_){(0,o.lockButton)(_),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:i},{onFail:()=>(0,o.unlockButton)(_),onDone:i=>{_&&((0,o.unlockButton)(_),(0,l.hasClass)(_,"MusicAuthor__follow_btn__can_follow")?(r.FlatButton.setLabel(_,(0,s.getLang)("audio_follow_artist_button")),_.classList.remove("MusicAuthor__follow_btn__followed"),_.onclick=o=>{o.preventDefault(),a.AudioUtils.followArtist(e,t,i,_)}):(0,l.re)(_))}})}},442277:(e,t,i)=>{"use strict";i.d(t,{getRowActionName:()=>s});var o=i(786067),a=i(45634);function s(e,t,i){var s,l=a.AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":s=(0,o.getLang)("audio_delete_from_current");break;case"recoms_delete":s=(0,o.getLang)("audio_dont_show");break;case"listened_delete":s=(0,o.getLang)("audio_remove_from_list");break;case"delete":if(a.AudioUtils.isPodcast(t))s=(0,o.getLang)("audio_podcast_delete_episode");else if(window.AudioPage&&window.AudioPage.isInRecentPlayed(i))s=(0,o.getLang)("audio_remove_from_list");else{var r=l[t.fullId];s=r&&r.deleteAll?r.deleteAll.text:(0,o.getLang)("global_delete_audio")}break;case"restore_recoms":s=(0,o.getLang)("audio_restore_audio");break;case"more":s=(0,o.getLang)("global_media_selector_more");break;case"add":var _=l[t.fullId];if(_&&l[_.addedFullId]&&(_=null),a.AudioUtils.isPodcast(t))s=(0,o.getLang)("audio_podcast_restore_episode");else if(_&&"deleted"==_.state)s=(0,o.getLang)("audio_restore_audio");else if(_&&"added"==_.state)s=(0,o.getLang)("global_delete_audio");else{var d=!!window.AudioPage&&currentAudioPage(i);s=d&&d.getOwnerId()<0&&d.canAddToGroup()&&d.getOwnerId()!==t.ownerId?(0,o.getLang)("audio_add_to_group"):(0,o.getLang)("audio_add_to_audio")}break;case"edit":s=a.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_edit_episode"):(0,o.getLang)("audio_edit_audio");break;case"next":s=(0,o.getLang)("audio_set_next_audio");break;case"recoms":s=(0,o.getLang)("audio_show_recommendations");break;case"fave":s=a.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_listen_later"):"";break;case"lyrics":s=(0,o.getLang)("audio_show_lyrics");break;default:s=""}return s}},160260:(e,t,i)=>{"use strict";i.d(t,{hasAudioHQBodyClass:()=>a});var o=i(722904);function a(){return document.body.classList.contains(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS)}},930982:(e,t,i)=>{"use strict";i.d(t,{renderAudioDiag:()=>l});var o=i(315544),a=i(695724),s=i(722904);function l(){var e=(0,o.ge)("audio_diag_log"),t=ls.get(s.AUDIO_PLAYER_ENUMS.LOG_LS_KEY)||[];e&&(0,a.each)(t,(function(t,i){var a=new Date(i.shift()).toUTCString();i=i.join(", "),e.appendChild((0,o.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+i+"</div>"))}))}},655700:(e,t,i)=>{"use strict";i.d(t,{toggleAudioHQBodyClass:()=>a});var o=i(722904);function a(){var e=AudioPlayer.showHQLabel();document.body.classList.toggle(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS,e)}},869053:(e,t,i)=>{"use strict";i.d(t,{updateQueueReceivedPost:()=>s});var o=i(315544),a=i(695724);function s(e){e&&(0,a.each)((0,o.geByClass)("_audio_row",e),(function(){(0,o.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))}},67766:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{AudioPlaylist:()=>AudioPlaylist});var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57327),core_js_modules_es_array_index_of__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(682772),core_js_modules_es_array_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(66992),core_js_modules_es_array_slice__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(747042),core_js_modules_es_array_sort__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(702707),core_js_modules_es_array_splice__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(140561),core_js_modules_es_string_replace__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(115306),core_js_modules_es_string_search__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(864765),core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(323123),core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(333948),_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(40906),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(486125),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(695724),_utils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(45634),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(270148),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(18149),_web_audio_FetchService__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(414325);class AudioPlaylist{static splitId(e){var t=e.split("_"),i=t[0],o=t[1],a=t.slice(2);return[i,o,a=a.join("_")]}constructor(e,t,i){var o={};if(e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(e.getId))return e.isReference()?(window.getAudioPlayer().addPlaylist(this),e):(this._ref=e,void window.getAudioPlayer().addPlaylist(this));(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(e)?(o=e,this._ensureIndex()):(o.ownerId=t,o.type=e,o.albumId=i||++AudioPlaylist.plIndex),this._type=o.type,this._ownerId=o.ownerId||vk.id,this._albumId=o.albumId||0,this._fromId=o.fromId||0,this._list=[],this._context=o.context||"",this._blockId=o.blockId,this._isFakeId=!1,this._expire=o.expire||null,this._noDiscover=o.hasOwnProperty("noDiscover")?o.noDiscover:null,this._nextOffset=o.nextOffset,this._forceReload=!1,this._fetchService=new _web_audio_FetchService__WEBPACK_IMPORTED_MODULE_16__.FetchService,this.mergeWith(o),window.getAudioPlayer().addPlaylist(this)}updatePlaylist(e){var t=this.getSelf(),i=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,i=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,i=!0),i):i}_ensureIndex(e){var t=this.getSelf();if(t._index)e&&e();else{var i=function(e,t){var i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(t);return i>=33&&i<48?String.fromCharCode(i):e};t._index=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_15__.vkIndexer(t._list,(function(e){return(e[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,i)}),e)}}cleanIndex(){this.getSelf()._index=null}search(e,t){var i=this.getSelf();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(e)||(e={q:e}),this._ensureIndex((()=>{var o=i._index?i._index.search(e.q):[];return o=o.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS]})),t(o)}))}setNextOffset(e){this._nextOffset=e}getNextOffset(){var e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._implPlay_rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return null==this.getSelf()._titleLang?null:this.getSelf()._titleLang}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getAudiosList(){return this.getSelf()._list}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){var e=this.getSelf()._live;return!!e&&{hostId:(e=e.split(","))[0],audioId:e[1],hash:e[2]}}getAudiosCount(){var e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){var e=this.getAudiosList(),t=0;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(e,(function(e,i){t+=i[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),t}getAudio(e){if(!e)return null;var t=this.getSelf();"string"==typeof e&&(e=e.split("_"));for(var i=0,o=t._list.length;i<o;i++)if(e[0]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_ID])return t._list[i];return null}getAudioAt(e){var t=this.getSelf();return e<t._list.length?t._list[e]:null}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){var t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}getForceReload(){return this.getSelf()._forceReload}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}getFeedOffset(){return this._feedOffset}getFeedFrom(){return this._feedFrom}_unref(){var e=this._ref;if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(e)){var t={};for(var i in e)if(e.hasOwnProperty(i)&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(e[i])&&0===i.indexOf("_")){var o=e[i];t[i.substr(1)]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(o)?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clone)(o):o}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this._fetchService=t.fetchService,this.mergeWith(t)}}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}indexOfAudio(e){if(!e)return-1;var t=[];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isString)(e)?t=e.split("_"):(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isObject)(e)?t=[e.ownerId,e.id]:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isArray)(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);var i=this._list;if(!i)return-1;for(var o=0,a=i.length;o<a;o++)if(i[o]&&t[0]==i[o][_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==i[o][_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_ID])return o;return-1}asObject(){var e={};return e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=window.getAudioPlayer()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,e.blockId=this.getBlockId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),this.getType()===AudioPlaylist.TYPE_RADIO&&(e.list=this.getAudiosList()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}clean(e){e||this._unref();var t=this.getSelf();t._hasMore=!0,t._list=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){return this.getSelf()._list=e||[]}setForceReload(e){var t=this.getSelf();return e&&(t._hasMore=!0),t._forceReload=e}getBlockId(){return this.getSelf()._blockId}getAudioIds(e){return this.getSelf()._fetchService.getAudioIds({playlistId:this.getPlaylistId(),playlistOwnerId:this.getOwnerId(),playlistAccessHash:this.getAccessHash(),blockId:this.getBlockId(),albumId:this.getAlbumId(),trackType:e,context:this.getContext()})}loadAll(e,t){if(void 0===t&&(t=""),!this.isFullyLoadable())return e&&e(this);this.load(0,e,!0,"default",t)}loadByBlockId(e,t,i,o){var a=this;void 0===o&&(o="default");var s=function(e,t){void 0===t&&(t=null);var i=a._onDoneLoading;delete a._onDoneLoading,delete a._loadingAll,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(i||[],((e,i)=>{i&&i(a,t)}))},l=this.getNextOffset();return!this.getAudiosCount()||e&&e===l?(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll?void 0:i?(this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_14__.loadAllPlaylistAudios)(this,s)):void ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:l},{onDone:e=>{this._blockId=e.blockId;var t=window.getAudioPlayer();t.mergePlaylistData(this,e),s(),t.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})):t&&t(this)}load(offset,_onDone,needAll,trackType,viewType){void 0===trackType&&(trackType="default"),void 0===viewType&&(viewType=null),(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isFunction)(offset)?(_onDone=offset,offset=0):offset=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(offset),this.getSelf().isExpired()&&(this.getSelf()._hasMore=!0,this.getSelf().setForceReload(!0));var searchParams=this.getSearchParams(),wasPreload=!1,countAvailable=this.getType()===this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,i)=>{var o=this._onDoneLoading;i||(delete this._onDoneLoading,delete this._loadingAll),(!wasPreload||wasPreload&&cur.audioChooseBox&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_11__.curBox)())&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(o||[],((i,o)=>{o&&o(e,t)})),i&&(wasPreload=!0)},params;if(this.getSelf().getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return _onDone&&_onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(_onDone),this._loadingAll)return _onDone&&_onDone(this);if(needAll)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_14__.loadAllPlaylistAudios)(this,callOnDones,viewType);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getSelf().getForceReload()&&this.getSelf().setForceReload(!1);var isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{var ownerId=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:ownerId,playlist_id:this.getPlaylistId(),offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.intval)(nav.objLoc.claim),track_type:trackType}}return ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf().setNextOffset(""),void(isCatalog?_onDone&&_onDone(loadedPlaylist):callOnDones(loadedPlaylist));if(window.addTemplates({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!this._loadingAll||needAll){var audioPlayer=window.getAudioPlayer();audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?_onDone&&_onDone(loadedPlaylist.list):callOnDones(loadedPlaylist),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}},onFail:()=>!0,cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0})}isExpired(){var e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.each)(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire"],((t,i)=>{void 0!==e[i]&&(this["_"+i]=e[i])}))}mergeWith(e){var t=e.list;this.isExpired()&&(this.getSelf()._list=[]),t&&t.length&&(this.getType()===AudioPlaylist.TYPE_RADIO?this.pushAudio(t,0):this.pushAudio(t)),this.mergeInfo(e)}pushAudio(e,t){this._unref();var i=void 0===t,o=o=>{for(var a=this.getAudiosList(),s=[],l=0;l<o.length;l++){var r=o[l],_=this.indexOfAudio(r);_<0?s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clone)(r)):i||(s.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clone)(r)),a.splice(_,1),_<t&&t--)}for(var d=0,n=s;d<n.length;d++){var u=n[d];u[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.replaceEntities)(u[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),u[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_12__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.replaceEntities)(u[_utils__WEBPACK_IMPORTED_MODULE_13__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,""))}i?a.push(...s):a.splice(t,0,...s),this._index&&this._index.add(e)};(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isArray)(e)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_10__.isArray)(e[0])?o(e):e&&e.length&&o([e])}moveAudio(e,t){this._unref();var i=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,i[0])}removeAudio(e){var t=this.indexOfAudio(e);if(t>=0){this._unref();var i=this._list.splice(t,1);return this._index&&this._index.remove(i[0]),window.getAudioPlayer().saveStateCurrentPlaylist(),t}return-1}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextLiveAudio(e){var t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>e&&e(t),onFail:()=>!0})}}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_FEED="feed",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.TYPE_RADIO="radio",AudioPlaylist.DEFAULT_PLAYLIST_ID=-1,AudioPlaylist.RADIO_PLAYLIST_ID=-110},461292:(e,t,i)=>{"use strict";i.d(t,{TopAudioPlayer:()=>p});i(57327);var o=i(45634),a=i(726271),s=i(850167),l=i(786067),r=i(49535),_=i(695724),d=i(315544),n=i(937884),u=i(563175),c=i(996512),h="top_audio_player_enabled";class p{constructor(e){this.ap=(0,s.getAudioPlayer)(),this._el=e,this._playIconBtn=(0,d.ge)("top_audio"),this._audioBtnGroup=(0,d.ge)("top_audio_btn_group"),this.init()}static init(){var e=(0,d.ge)("top_audio_player"),t=(0,d.data)(e,"object");t||(t=new p(e),(0,d.data)(e,"object",t))}init(){var e=this;function t(t){return(0,d.hasClass)(this,"top_audio_player_play")?(e.ap.podcastSetActionRef(e.ap.getCurrentAudio(),e.ap.isPlaying()?o.AudioUtils.PodcastsLogs.ACTION_PAUSE:o.AudioUtils.PodcastsLogs.ACTION_PLAY,"top_player"),e.ap.isPlaying()?e.ap.pause():e.ap.play(),!1):(0,d.hasClass)(this,"top_audio_player_prev")?(e.ap.playPrev(),!1):(0,d.hasClass)(this,"top_audio_player_next")?(e.ap.playNext(),!1):void 0}this.ap.on(this,n.events.UPDATE,this.onUpdate.bind(this)),this.ap.on(this,n.events.PLAY,this.onPlay.bind(this)),this.ap.on(this,n.events.PLAY_REQUESTED,this.onPlay.bind(this)),this.ap.on(this,[n.events.PAUSE,n.events.STOP],this.onPause.bind(this)),this.ap.top=this,(0,_.each)(["prev","play","next"],(function(i,o){(0,r.addEvent)((0,d.geByClass1)("top_audio_player_"+o,e._el),"click",t)})),(0,r.addEvent)(this._el,"mousedown",(function(t){if(!(0,d.gpeByClass)("top_audio_player_btn",t.target,e._el))return 1!=t.which||(0,d.hasClass)(t.target,"top_audio_player_btn")||(0,d.hasClass)(t.target,"top_audio_player_act_icon")||o.AudioUtils.getLayer().toggle(),(0,r.cancelEvent)(t)})),(0,r.addEvent)((0,d.ge)("top_audio"),"mousedown",(function(e){return!0!==(0,r.checkEvent)(e)&&(o.AudioUtils.getLayer().toggle(),(0,r.cancelEvent)(e))})),a.browser.safari||(0,r.addEvent)(document,"keydown keyup",(function(e){(0,d.toggleClass)((0,d.ge)("top_audio_play"),"shuffle",e.shiftKey)})),this._resetAudio(),this._updateTitle(this.ap.getCurrentAudio())}onPause(){this._el&&((0,d.removeClass)(this._el,"top_audio_player_playing"),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,c.getIcon24Play)().icon);var e=(0,d.geByClass1)("_top_audio_player_play_blind_label");e&&(e.innerHTML=(0,l.getLang)("global_audio_play"))}onPlay(e,t,i){this._hideButton(),requestAnimationFrame((function(){var e=o.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()})),(0,d.addClass)(this._el,h),(0,d.toggleClass)(this._el,"top_audio_player_playing",!0),this._el.querySelector(".top_audio_player_play svg").outerHTML=(0,u.getIcon24Pause)().icon;var a=(0,d.geByClass1)("_top_audio_player_play_blind_label");a&&(a.innerHTML=this.ap.isPlaying()?(0,l.getLang)("global_audio_pause"):(0,l.getLang)("global_audio_play")),this._updateTitle(e,i)}onUpdate(e){e?(this._updateTitle(e),this._hideButton(),(0,d.addClass)(this._el,h)):this._resetAudio()}_updateTitle(e,t){if(t=(0,_.intval)(t),e=o.AudioUtils.audioTupleToAudioObject(e),(0,d.toggleClass)(this._el,"audio_player_podcast",o.AudioUtils.isPodcast(e)),(0,d.toggleClass)(this._el,"audio_player_article_tts",o.AudioUtils.isArticleTts(e)),(0,d.toggleClass)(this._el,"audio_player_external_stream_audio",o.AudioUtils.isExternalStream(e)),e){void 0!==this._currTitleReTO&&clearTimeout(this._currTitleReTO);var i=(0,d.geByClass1)("top_audio_player_title_out",this._el);(0,d.re)(i);var a=(0,d.geByClass1)("top_audio_player_title",this._el);if(0!==t){var s=t<0?-10:10,l=`opacity: 0; top: ${s}px; left: ${a.offsetLeft}px`,r=this.getTitleText(e),n=(0,d.se)('<div class="top_audio_player_title top_audio_player_title_next" style="'+l+'">'+r+"</div>");n.setAttribute("onmouseover","setTitle(this)"),t>0?(0,d.domInsertAfter)(n,a):(0,d.domInsertBefore)(n,a),(0,d.addClass)(a,"top_audio_player_title_out"),(0,d.setStyle)(a,{top:-s,opacity:0}),setTimeout((function(){(0,d.setStyle)(n,{top:0,opacity:1})}),10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout((function(){(0,d.re)(a),(0,d.removeClass)(n,"top_audio_player_title_next")}),p.TITLE_CHANGE_ANIM_SPEED)}else a&&(a.innerHTML=this.getTitleText(e),a.titleSet=0,a.setAttribute("onmouseover","setTitle(this)"))}}getTitleText(e){return[e.performer,e.title].filter((e=>!!e)).join(" &mdash; ")}_resetAudio(){(0,d.removeClass)(this._playIconBtn,h),(0,d.removeClass)(this._el,h),(0,d.removeClass)(this._el,"top_audio_player_playing"),(0,d.removeClass)(this._el,"audio_player_podcast"),(0,d.removeClass)(this._el,"audio_player_article_tts"),(0,d.removeClass)(this._el,"audio_player_external_stream_audio"),(0,d.show)(this._audioBtnGroup);var e=o.AudioUtils.getLayer();e&&e.isShown()&&e.updatePosition()}_hideButton(){(0,d.hide)(this._audioBtnGroup),(0,d.hasClass)(this._playIconBtn,h)||(0,d.addClass)(this._playIconBtn,h)}}p.TITLE_CHANGE_ANIM_SPEED=190},189158:(e,t,i)=>{"use strict";i.d(t,{WebPlayerAdapter:()=>_});var o=i(343860),a=i(695724),s=i(45634),l=i(315544),r=i(624715);class _ extends o.AudioStatsPlayerAdapter{getPausedBy(e){var t=this.player,i=t.pausedByVideo,o=t.pausedByStories,a=t.pausedByAudio,s=t.pausedByQueue;return i&&e<i||window.Videoview&&Videoview.isLayerShown()?"video":o&&e<o||window.cur&&cur.storyLayer?"stories":a&&e<a?"audio":s&&e<s?"queue":null}getState(){var e=super.getState(),t=this.getAudioId();if(t){var i=(0,l.geByClass)("_audio_row_"+t+" audio_row__current",(0,l.ge)("page_layout"));if(i&&i.length)return o.FULL_SCREEN_STATE}return e}getAudio(){return(0,r.audioTupleToAudioObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){var e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[s.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(e=this.player.getVolume(),Math.log(1+34*e)/Math.log(35)));var e}getAudioId(){var e=this.player.getCurrentAudio();if(e)return e[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){var e=this.player.getCurrentAudio();if(e)return e[s.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){var e=this.player._prevAudio;if(e)return e[s.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){var e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){var e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){var e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){var e=this.player.getPlaylistQueue();if(e)return e.isShuffled()}isRealPlaylist(){var e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){var e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){var e=this.player.getCurrentAudio();return s.AudioUtils.isPodcast(e)}isExternalStream(){var e=this.player.getCurrentAudio();return s.AudioUtils.isExternalStream(e)}isRadio(){var e=this.player.getCurrentAudio();return s.AudioUtils.isRadio(e)}isMarusiaTrack(){var e=this.player.getCurrentAudio();return s.AudioUtils.isMarusiaTrack(e)}isLastTrack(){var e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return!!e&&(!(!e||t)||t.indexOfAudio(e)+1===t.getAudiosCount())}getTrackPosition(){var e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return e?e&&!t?0:t.indexOfAudio(e):null}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){var t=e&&e.hash,i=(0,a.extend)({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",i,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}getPlaylistQueue(){this.player.getPlaylistQueue()}}},840887:(e,t,i)=>{"use strict";i.d(t,{followCurator:()=>d});var o=i(386409),a=i(45634),s=i(786067),l=i(124041),r=i(850167),_=i(937884);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,r.getAudioPlayer)().notify(_.events.CURATOR_FOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,(0,s.getLang)("audio_following_artist_button")),i.classList.add("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),a.AudioUtils.unfollowCurator(e,t,i)}}})}},190347:(e,t,i)=>{"use strict";i.d(t,{unfollowCurator:()=>d});var o=i(386409),a=i(45634),s=i(786067),l=i(124041),r=i(850167),_=i(937884);function d(e,t,i){(0,o.lockButton)(i),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(i),onDone:t=>{(0,r.getAudioPlayer)().notify(_.events.CURATOR_UNFOLLOW),(0,o.unlockButton)(i),l.FlatButton.setLabel(i,(0,s.getLang)("audio_follow_artist_button")),i.classList.remove("MusicAuthor__follow_btn__followed"),i.onclick=o=>{o.preventDefault(),a.AudioUtils.followCurator(e,t,i)}}})}},470353:(e,t,i)=>{"use strict";i.d(t,{addToGroupBox:()=>r});var o=i(315544),a=i(786067),s=i(146143),l=i(486125);function r(e,t,i){var r=e+"_"+t,_=(0,s.showBox)("al_audio.php",{act:"add_to_groups_box",playlist_id:r,access_hash:i}).setButtons((0,a.getLang)("Save"),(()=>{var e=[];for(var t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&((0,o.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:(0,o.ge)("add_playlist_to_group_hash").value,playlist_id:r},{onDone(e){_.hide(),(0,l.showDoneBox)(e)},onFail:e=>((0,o.ge)("add_playlist_to_group_fail").innerHTML=e,!0)}))}))}},748409:(e,t,i)=>{"use strict";i.d(t,{removeFromGroup:()=>r});var o=i(315544),a=i(786067),s=i(146143),l=i(486125);function r(e,t,i,r){void 0===r&&(r=null);var _=e+"_"+t,d=cur.audioPage&&-cur.audioPage._ownerId||cur.group_id;if(d>0)var n=(0,s.showBox)("al_audio.php",{act:"delete_from_group_box",playlist_id:_,group_id:d}).setButtons((0,a.getLang)("global_yes"),(()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:d,hash:i,playlist_id:_},{onDone(e){if(n.hide(),(0,l.showDoneBox)(e),r){var t=(0,o.gpeByClass)("audio_pl_snippet2",r);t&&t.classList.remove("audio_pl__can_remove_from_club")}},onFail:e=>(n.hide(),(0,l.showDoneBox)(e),!0)})}),(0,a.getLang)("global_cancel"),(()=>n.hide())).show()}},459285:(e,t,i)=>{"use strict";i.d(t,{addToPlaylistsBoxInit:()=>c});i(57327),i(682772);var o=i(315544),a=i(49535),s=i(695724),l=i(486125),r=i(386409),_=i(786067),d=i(609720),n=i(806439),u=i(219202);function c(e,t,i,h,p){if("undefined"==typeof AutoList)return window.stManager.add(window.jsc("web/auto_list.js"),(()=>{c(e,t,i,h,p)}));var A=(0,l.curBox)(),g=(0,o.geByClass1)("_audio_atp_content",A.bodyNode),y=(0,o.geByClass1)("_audio_atp_list",A.bodyNode),P=(0,o.ge)("audio_atp_search"),f=(0,o.geByClass1)("_audio_atp_empty"),E=(0,o.getSize)(g)[1];(0,o.setStyle)(y,{height:E-(0,o.getSize)(P)[1]});var v,w="";function I(){v&&v.destroy(),y.innerHTML="";var e=[];e=w?h.filter((e=>e[2].toLowerCase().indexOf(w)>=0)):h,(0,o.toggle)(y,0!=e.length),(0,o.toggle)(f,0==e.length),v=new AutoList(y,{onNeedRows:(t,i)=>{for(var o=[],a=i,s=Math.min(e.length,i+30),l=a;l<s;l++){var r=e[l];if(r){var _=r[4]?"ape_selected":"",d=`<div class="ape_check">\n              <div class="ape_check--unchecked">${(0,n.getIcon24CheckCircleOff)().icon}</div>\n              <div class="ape_check--checked">${(0,u.getIcon24CheckCircleOn)().icon}</div>\n            </div>`,c=`<div class="ape_pl_item _ape_pl_item ${_}" data-id="${r[1]}">${d}<div class="ape_pl_item_inner"><span class="ape_pl_title">${r[2]}</span> <span class="ape_pl_size">${r[3]}</span></div></div>`;o.push(c)}}t(o)}})}I(),cur.addToPlaylistSearch=(0,d.debounce)((function(e){w=(0,s.trim)(e).toLowerCase(),I()}),200);var m={},b={};(0,a.addEvent)(y,"click",(e=>{var t=(0,o.domClosest)("_ape_pl_item",e.target),i=(0,o.domData)(t,"id");(0,o.toggleClass)(t,"ape_selected")?(b[i]=!0,delete m[i]):(m[i]=!0,delete b[i])})),A.removeButtons(),A.addButton((0,_.getLang)("global_save"),(o=>{var a=Object.keys(b),s=Object.keys(m);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:a.join(","),remove_pl_ids:s.join(","),owner_id:e,audio_owner_id:t,audio_id:i,hash:p},{showProgress:()=>(0,r.lockButton)(o),hideProgress:()=>(0,r.unlockButton)(o),onDone:()=>{A.hide()},onFail:()=>(A.hide(),!0)})}),"ok",!0),A.addButton((0,_.getLang)("global_cancel"),A.hide.bind(this),"no",!0)}},953054:(e,t,i)=>{"use strict";i.d(t,{claimPlaylist:()=>a});var o=i(486125);function a(e,t,i){var a=nav.objLoc.claim;if(a){var s={act:i?"a_unclaim_playlist":"a_claim_playlist",claim:a,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",s,{onDone:e=>{(0,o.showDoneBox)(e)}})}}},734264:(e,t,i)=>{"use strict";i.d(t,{copyPlaylistLink:()=>_});var o=i(601984),a=i(786067),s=i(479957),l=i(486125),r=i(812595);function _(e,t,i){(0,s.statlogsValueEvent)("audio_copy_link",vk.id),(0,o.copyToClipboard)((0,r.getPlaylistUrl)(e,t,i,!0)),(0,l.showDoneBox)((0,a.getLang)("audio_playlist_link_copied"))}},548616:(e,t,i)=>{"use strict";function o(e,t,i,o){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(a){a.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=a.audio_playlist_cover_upload_options),a.editorial_playlists_params&&(cur.editorialPlaylistsParams=a.editorial_playlists_params),AudioPage.editPlaylist(e,t,i,o)},onFail:()=>!0})}))}i.d(t,{editPlaylist:()=>o})},703780:(e,t,i)=>{"use strict";i.d(t,{followPlaylist:()=>c});i(57327),i(115306);var o=i(315544),a=i(850167),s=i(786067),l=i(40906),r=i(486125),_=i(695724),d=i(146143),n=i(937884),u=[];function c(e,t,i,c,h,p){if(void 0===h&&(h=!1),void 0===p&&(p=""),vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;var A=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,i);function g(a){var s=(0,o.domData)(e,"text-followed"),l=(0,o.domData)(e,"text-follow"),r=a?s:l;(0,o.domData)(e,"tooltip-text",r),((0,o.geByClass1)("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=r,A.setFollowed(a);var d=A.getAddClasses()||"";d=d.replace("audio_pl__followed",""),a&&(d+=" audio_pl__followed"),A.mergeWith({addClasses:d}),(0,_.each)((0,o.geByClass)(`_audio_pl_${t}_${i}`),((t,i)=>{(0,o.toggleClass)(i,"audio_pl__followed",a);var s=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];s&&(s.innerHTML=e.innerHTML)}))}function y(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){var o=null;u=u.filter((e=>{var a=e.playlistId===i&&e.playlistOwnerId===t;return a&&(o=e.pl),!a})),o&&cur.audioPage._data.playlists.unshift(o)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((e=>{var o=e.id===i&&e.owner_id===t;return o&&u.push({playlistId:i,playlistOwnerId:t,pl:e}),!o}));cur.audioPage.updatePlaylistsCounter(vk.id)}}var P=(0,o.gpeByClass)("_audio_pl",e),f=(0,o.toggleClass)(P,"audio_pl__followed");g(f),y(f),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:i,hash:c,showcase:h,block_id:p},{onDone(e){(0,l.isObject)(e)&&f&&(0,a.getAudioPlayer)().notify(n.events.MUSIC_PLAYLISTS_ADD,e)},onFail:e=>(new d.MessageBox({title:(0,s.getLang)("global_error")}).content(e).setButtons((0,s.getLang)("audio_ok"),(function(){(0,r.curBox)().hide()})).show(),g(!1),y(!1),!0)})}},295224:(e,t,i)=>{"use strict";i.d(t,{getContextPlaylist:()=>r});i(892222),i(57327),i(682772),i(66992),i(747042),i(115306),i(323123),i(333948);var o=i(315544),a=i(45634),s=i(850167),l=i(695724);function r(e,t){var i=(0,s.getAudioPlayer)(),r=a.AudioUtils.getAudioFromEl(e,!0);if(r){var _=null,d=[],n=(0,o.domData)(e,"new-post"),u=!1,c=null,h=AudioPlaylist.TYPE_TEMP,p=vk.id,A=null,g={},y=window.AudioPage&&currentAudioPage(e);if((0,o.traverseParent)(e,(e=>u=(0,o.domData)(e,"audio-context"))),u=(u=r.context||u)||("audio"==cur.module?cur.submodule:cur.module),t)return{context:u};var P=a.AudioUtils.contextSplit(u),f=P[0],E=P[1],v=(0,o.gpeByClass)("_audio_pl",e),w=!1;if(v){var I=(0,o.domData)(v,"playlist-id");(c=i.getPlaylistByBlockId(I))||(c=i.getPlaylist(...AudioPlaylist.splitId(I||"")));var m=(0,o.domData)(v,"title")||"";m&&c.mergeWith({title:(0,l.clean)(m)});var b=(0,o.domData)(v,"access-hash")||"";b&&c.mergeWith({accessHash:b})}else if(y&&y.getPageCurrentPlaylist())c=y.getPageCurrentPlaylist();else if("module"==f){var C=E;c=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,C||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),d=[_]}else if(0===r.context.indexOf("admin"))(c=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,r.ownerId,0,r.accessKey)).getAudiosCount()||c.setForceReload(!0);else if(0===r.context.indexOf("im"))_=(_=(0,o.gpeByClass)("_im_peer_history",e))||(0,o.gpeByClass)("_fc_tab_log_msgs",e),A="im"+(cur.peer||"");else if(0===r.context.indexOf("board"))w=!0,A=r.context,d=R((0,o.geByClass)("_wall_audio_rows",_));else if(0===r.context.indexOf("widget"))w=!0,A=r.context;else if(0===r.context.indexOf("wiki"))w=!0,A="wiki";else if(0===r.context.indexOf("post")){h=AudioPlaylist.TYPE_WALL,A=r.context,w=!0;var O=r.context.replace("post","").split("_");p=O[0],g={postId:O[1]}}else if(0===r.context.indexOf("choose"))A=r.context;else if("feed"==n||0===r.context.indexOf("feed")||0===r.context.indexOf("feedsearch"))A="feed",w=!0,d=R((0,o.geByClass)("wall_text",_));else if("group_wall"==f||"user_wall"==f||0===r.context.indexOf("reply")||"wall"==n){h=AudioPlaylist.TYPE_WALL,p=cur.oid;var T=(E||"").split("_")[1],D=cur.wallQuery||"",L=(0,o.ge)("wall_search"),U=(0,l.inArray)(cur.wallType,["own","full_own"])?"own":"all";A=hashCode(U+"_"+D),w=!0,"wall"==cur.module&&(0,o.val)(L)&&(D=(0,o.val)(L)),T&&(g={postId:T,wallQuery:D,wallType:U}),0===r.context.indexOf("reply")&&(d=R([(0,o.gpeByClass)("_replies_list",e)]),A="reply"+A,w=!0);var M=(0,o.gpeByClass)("wide_column",e);if(M){var S=(0,o.geByClass)("wall_text",M);d=Array.isArray(S)&&S.length>0?d.concat(S):d.concat(R([_]))}else d=d.concat(R([_]))}else"article"==f&&(c=cur.articlePlaylist);return _||(_=(0,o.domPN)(e)),(d=d.filter((function(e){return!!e})))&&0!=d.length||(d=[_]),"function"==typeof(c=c||i.getPlaylist(h,p,A)).setIsFakeId&&c.setIsFakeId(w),(c=c.getAudiosCount()?c:a.AudioUtils.initDomPlaylist(c,d)).mergeWith(g||{}),-1==c.indexOfAudio(r)&&(c=a.AudioUtils.initDomPlaylist(c,[(0,o.domPN)(e)])),{playlist:c,context:u}}function R(e){return[].slice.call(e)}}},594144:(e,t,i)=>{"use strict";function o(){return window.playlistAddRestoreInfo||(window.playlistAddRestoreInfo={}),window.playlistAddRestoreInfo}i.d(t,{getPlaylistAddRestoreInfo:()=>o})},920817:(e,t,i)=>{"use strict";i.d(t,{hidePlaylistFromRecoms:()=>l});var o=i(213294),a=i(786067),s=i(486125);function l(e,t,i){ajax.post("al_audio.php?act=hide_playlist_from_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,s.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_hidden"));var o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,a.getLang)("audio_playlist_recoms_show"),o.setAttribute("onclick","AudioUtils.showPlaylistInRecoms("+e+", "+t+", '"+i+"');");for(var l=0,r=["audio_search","audio_search_layer"];l<r.length;l++){var _=r[l],d=document.getElementById(_);if(d)window.currentAudioPage(d).catalogController.currentSection.reloadBlock("recommended_playlists")}},onFail(e){(0,o.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},517097:(e,t,i)=>{"use strict";i.d(t,{initDomPlaylist:()=>s});i(66992),i(454747),i(333948);var o=i(695724),a=i(78838);function s(e,t){var i=[];return(0,o.each)(t,(function(e,t){t&&[...t.querySelectorAll("._audio_row")].forEach((e=>{i.push((0,a.getAudioFromEl)(e))}))})),e.pushAudio(i),e}},271891:(e,t,i)=>{"use strict";i.d(t,{initRowPlaylistsChooser:()=>a});var o=i(45634);function a(e,t,i){var a,s=o.AudioUtils.audioTupleToAudioObject(e);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,o.AudioUtils.playlistsByAudioDataCache=o.AudioUtils.playlistsByAudioDataCache||{};var l=o.AudioUtils.playlistsByAudioDataCache,r=a+"_"+s.ownerId+"_"+s.id;l[r]?o.AudioUtils._showPlaylistsChooser(i,t,l[r],a,s,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:s.ownerId,audio_id:s.id},{onDone:(_,d,n)=>{var u=l[r]={playlists:_,morePlaylists:d,newPlaylistHash:n};o.AudioUtils._showPlaylistsChooser(i,t,u,a,s,e)},onFail:()=>!0})}},270148:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{loadAllPlaylistAudios:()=>loadAllPlaylistAudios});var core_js_modules_es_array_concat__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(892222),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(454747),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(695724),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(850167),AUDIO_LOAD_CHUNK_SIZE=1e3,chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount=void 0;function loadAllPlaylistAudios(e,t,i){if(void 0===i&&(i=!1),e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===i,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,(()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))}))}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);var e=[];((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(chunks,(function(t,i){i&&(e=e.concat(i))})),(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_3__.getAudioPlayer)().getPlaylists().forEach((t=>{t.getId()===playlist.getId()&&(t._list=e)})),(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_3__.getAudioPlayer)().mergePlaylistData(playlist,{hasMore:!1}),onDone)&&onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}function loadAllChunks(e,t){t=t||0;var i=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));isAttach&&t&&totalCount>preloadedCount&&i===t&&i++,i-t<=0?e():function(){for(var o=new CallHub(e,i-t),a=t;a<i;a++)loadChunk(a,(()=>{o.done()}))}()}function loadChunk(chunkIndex,callback){var isPreload=isAttach&&!chunkIndex?1:0,offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)(nav.objLoc.claim),ref:playlist.getRef()},{onDone:function onDone(data,tpl,langs,templatesScript){if(0===chunkIndex){if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_3__.getAudioPlayer)().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},759448:(e,t,i)=>{"use strict";i.d(t,{onAudioAddedToPlaylist:()=>l});var o=i(315544),a=i(850167),s=i(695724);function l(e,t,i,l){(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).pushAudio(l,0),(0,s.each)((0,o.geByClass)(`_audio_pl_${e}_${t}`),((e,t)=>{(0,o.domReplaceEl)(t,(0,o.se)(i))}))}},409082:(e,t,i)=>{"use strict";function o(e,t){var i=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(i?":"+i:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})}i.d(t,{onPlaylistChoose:()=>o})},563767:(e,t,i)=>{"use strict";i.d(t,{showAudioPlaylist:()=>p});i(323123);var o=i(315544),a=i(45634),s=i(726271),l=i(850167),r=i(786067),_=i(486125),d=i(695724),n=i(49535),u=i(146143),c=i(897213),h=i(812595);function p(e,t,i,p,A,g){if(cur.apLayer)return(0,n.cancelEvent)(A);if(vk.widget)return!0;if(!A||!(A.metaKey&&s.browser.mac||A.ctrlKey)){var y=null;return window.Photoview&&window.cur&&cur.pvShown&&(y=(0,d.clone)(nav.objLoc),Photoview.hide(!0)),(0,_.boxRefreshCoords)(boxLoader),(0,o.show)(boxLoader),(0,o.show)(boxLayerWrap),window.stManager.add([window.jsc("web/auto_list.js"),"audio.css"],(function(){var s,A,P=(0,l.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i);function f(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,s&&(0,n.removeEvent)(window.audioPlaylistLayerWrap,"click",s),A&&(0,n.removeEvent)(bodyNode,"keydown",A),delete cur.apLayer,delete cur.apLayerPlaylistId,(0,o.removeClass)(layerBG,"ap_layer_bg_dark"),y?nav.change(y):nav.change({z:!1}),layerQueue.pop()}P.setContext(p),P.setForceReload(!0),P.setFromId(cur.oid),P.loadAll((function(P,E){if((0,o.hide)(boxLoader),(0,o.hide)(boxLayerWrap),E){var v=(0,r.getLang)("audio_error_deleted_playlist_box").split("/");return new u.MessageBox({title:v[0]}).content(v[1]).setButtons((0,r.getLang)("global_close"),(function(){(0,_.curBox)().hide(),y&&nav.change(y)})).show(),void nav.setLoc((0,d.extend)(nav.objLoc,{z:!1}))}var w=(0,d.extend)(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(i?"/"+i:"")});nav.setLoc(w),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=(0,o.se)('<div class="ap_layer_wrap"></div>'),bodyNode.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";var I=P&&P.getAudiosList?P.getAudiosList().length:0,m=P.isBlocked&&P.isBlocked(),b=(0,h.getPlaylistUrl)(P.getOwnerId(),P.getPlaylistId(),P.getAccessHash()),C=(0,d.getTemplate)("audio_playlist_snippet",{title:P.getTitle(),subTitle:P.getSubtitle(),description:P.getDescription(),coverStyle:P.getCoverUrl()?"background-image:url('"+P.getCoverUrl()+"'); background-size: cover;":"",authorLine:P.getAuthorLine(),infoLine1:P.getInfoLine1(),infoLine2:P.getInfoLine2(),id:P.getPlaylistId(),ownerId:P.getOwnerId(),href:b,addCls:P.getAddClasses(),followHash:P.getFollowHash(),accessHash:P.getAccessHash(),editHash:P.getEditHash(),deleteHash:P.getDeleteHash(),replaceHash:P.getReplaceHash(),gridCovers:P.getGridCovers(),type:P.getType(),context:p,followButtonText:P.isFollowed()?(0,r.getLang)("audio_playlist_btn_added"):(0,r.getLang)("audio_playlist_btn_add")});if(cur.apLayer=(0,o.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${C}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),m){(0,o.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=(0,d.getTemplate)("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),(0,n.addEvent)(window.audioPlaylistLayerWrap,"click",s=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=(0,o.geByClass1)("_ap_layer__close",cur.apLayer)||layers&&layers.fullhide&&layers.fullhide()}),(0,n.addEvent)(bodyNode,"keydown",A=function(e){if(27==e.keyCode)return layers&&layers.fullhide&&layers.fullhide(),(0,n.cancelEvent)(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),(0,o.addClass)(layerBG,"ap_layer_bg_dark");var O=(0,o.geByClass1)("_audio_pl_snippet__list",cur.apLayer),T=a.AudioUtils.getAlbumParts(P),D=0;I&&!m&&(cur.apLayerAutoList=new c.default(O,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){for(var i=[],o=P.getAudiosList(),s=t-=D;s<t+30;s++){var l=o[s];if(!l)break;if(T&&T.length&&T[0].offset===s){var r=T.shift();D++,i.push(a.AudioUtils.drawAlbumPartRow(r.number))}i.push(a.AudioUtils.drawAudio(l))}e(i)}}));(0,_.boxRefreshCoords)(cur.apLayer),(0,l.getAudioPlayer)().updateCurrentPlaying(),layers.fullhide=f,cur.apLayerPlaylistId=[e,t],g&&g()}))})),!1}}},254492:(e,t,i)=>{"use strict";i.d(t,{showPlaylistInRecoms:()=>l});var o=i(213294),a=i(786067),s=i(486125);function l(e,t,i){ajax.post("al_audio.php?act=show_playlist_in_recoms",{owner_id:e,playlist_id:t,access_hash:i},{onDone(){(0,s.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_showed"));var o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,a.getLang)("audio_playlist_recoms_hide"),o.setAttribute("onclick","AudioUtils.hidePlaylistFromRecoms("+e+", "+t+", '"+i+"');");for(var l=0,r=["audio_search","audio_search_layer"];l<r.length;l++){var _=r[l],d=document.getElementById(_);if(d)window.currentAudioPage(d).catalogController.currentSection.reloadBlock("recommended_playlists")}},onFail(e){(0,o.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},403753:(e,t,i)=>{"use strict";i.d(t,{showPlaylistsChooser:()=>n});i(323123);var o=i(315544),a=i(45634),s=i(786067),l=i(146143),r=i(695724),_=i(185850),d=i(986773);function n(e,t,i,n,u,c){var h=i.playlists,p=i.newPlaylistHash,A=i.morePlaylists;a.AudioUtils.copiedToPlaylistAudios=a.AudioUtils.copiedToPlaylistAudios||{},a.AudioUtils.copiedToPlaylistAudiosHashes=a.AudioUtils.copiedToPlaylistAudiosHashes||{};var g=t,y=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,(0,s.getLang)("audio_add_to_new_pl"),"audio_row__action_playlist"]));if((0,o.domInsertAfter)(y,g),g=y,y.addEventListener("click",(()=>{a.AudioUtils.editPlaylist(n,!1,"edit",{addAudio:c,newPlaylistHash:p})})),(0,r.each)(h,((e,t)=>{var i=!0,s=t[0]+"_"+t[1]+"_"+u.fullId,l=a.AudioUtils.copiedToPlaylistAudios[s],n="audio_row__action_playlist";(t[3]||l)&&(i=!1,n+=" audio_row__more_playlist_added");var c=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],n]));(0,o.domInsertAfter)(c,g),g=c;var h=!1;c.addEventListener("click",(()=>{if(!h){h=!0;var e=u.ownerId,l=u.id,n=a.AudioUtils.copiedToPlaylistAudios[s];n&&(e=(n=n.split("_"))[0],l=n[1]),i&&(a.AudioUtils.copiedToPlaylistAudiosHashes[s]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:l,do_add:(0,r.intval)(i)},{onDone:(e,o,l)=>{(0,d.onAdditionalEvent)(c,u,{type:i?_.TYPE_ADDED:_.TYPE_REMOVED,playlistId:t[0]+"_"+t[1]}),a.AudioUtils.copiedToPlaylistAudios[s]=!!i&&l,t[4]=i?e:a.AudioUtils.copiedToPlaylistAudiosHashes[s],i=!i,h=!1},onFail:()=>!0}),(0,o.toggleClass)(c,"audio_row__more_playlist_added",i)}}))})),A){var P=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,(0,s.getLang)("audio_row_show_all_playlists"),"audio_row__action_playlist"]));P.addEventListener("click",(()=>{(0,l.showBox)("al_audio.php?act=more_playlists_add",{owner_id:n,audio_owner_id:u.ownerId,audio_id:u.id},{params:{bodyStyle:"padding: 0px",width:560}})})),(0,o.domInsertAfter)(P,g),g=P}e.updatePosition()}},355145:(e,t,i)=>{"use strict";i.d(t,{turnPlaylistDiscover:()=>a});var o=i(486125);function a(e,t){var i={act:"turn_playlist_discover",owner_id:e,playlist_id:t};ajax.post("al_audio.php",i,{onDone:e=>{(0,o.showDoneBox)(e)}})}},888614:(e,t,i)=>{"use strict";i.d(t,{deleteEpisode:()=>a});var o=i(12733);function a(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.deleteEpisode(t.fullId,t.deleteHash)}))}},798783:(e,t,i)=>{"use strict";i.d(t,{editEpisode:()=>a});var o=i(12733);function a(e,t){(0,o.isPodcast)(t)&&(cur.podcastEditData={audioId:t.fullId},window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.edit(t.fullId)})))}},747447:(e,t,i)=>{"use strict";i.d(t,{faveEpisode:()=>l});var o=i(12733),a=i(896438),s=i(850167);function l(e,t){if(e&&(0,o.isPodcast)(t)){var i=(0,a.getAudioExtra)(t).faveHash;(0,s.bookmarkPodcast)(e.querySelector(".audio_row__action_fave"),t.fullId,i)}}},557761:(e,t,i)=>{"use strict";i.d(t,{isPrivatePodcast:()=>s});var o=i(12733),a=i(896438);function s(e){return!(!(0,o.isPodcast)(e)||!(0,a.getAudioExtra)(e).private)}},425209:(e,t,i)=>{"use strict";i.d(t,{openEpisode:()=>l});var o=i(850167),a=i(624715),s=i(12733);function l(e,t){t=(0,a.audioTupleToAudioObject)(t),(0,s.isPodcast)(t)&&(0,o.showPodcast)(e,t.fullId,null,"audio")}},568062:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACTION_PLAY:()=>a,ACTION_PAUSE:()=>s,ACTION_SEEK:()=>l,ACTION_HEARTBEAT:()=>r,ACTION_TIME_MARKER:()=>_,log:()=>d});var o=i(12733),a="play",s="pause",l="seek",r="heartbeat",_="time_marker";function d(e,t){var i=t.audio;(0,o.isPodcast)(i)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.log(e,t)}))}},750288:(e,t,i)=>{"use strict";i.d(t,{restoreEpisode:()=>a});var o=i(12733);function a(e,t){(0,o.isPodcast)(t)&&window.stManager.add([window.jsc("web/podcast.js")],(function(){Podcast.restoreEpisode(t.fullId,t.editHash)}))}},739724:(e,t,i)=>{"use strict";function o(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)}i.d(t,{showRecoms:()=>o})},867696:(e,t,i)=>{"use strict";i.d(t,{audioSearchPerformer:()=>a});i(115306);var o=i(40906);function a(e,t,i){var a=!!window.AudioPage&&currentAudioPage(e),s=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){a&&s?(t=(0,o.unclean)(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(e,i)}),50)}},986773:(e,t,i)=>{"use strict";i.d(t,{onAdditionalEvent:()=>_});i(747042),i(319601);var o=i(185850),a=i(189158),s=i(850167),l=i(713359);function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},r.apply(this,arguments)}function _(e,t,i){void 0===i&&(i={});var _=new o.AudioStats(new a.WebPlayerAdapter((0,s.getAudioPlayer)())),d=t&&t.context||e&&(0,l.getContext)(e)||"",n=t&&t.album&&t.album.slice(0,2).join("_"),u=r({},t,{context:d,playlistId:n},i);_.sendCurrentAudioEvent({type:u.type,subtype:u.subtype||_.getPlaySubtype(),ownerId:u.ownerId,audioId:u.id,trackCode:u.trackCode,state:_.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:u.context,playlistId:u.playlistId})}},207879:(e,t,i)=>{"use strict";i.d(t,{addAudio:()=>P});var o=i(315544),a=i(45634),s=i(850167),l=i(486125),r=i(695724),_=i(937884),d=i(185850),n=i(986773),u=i(295224),c=i(40906),h=i(99392),p=i(786067),A=i(293680),g=i(49535),y=i(146143);function P(e,t,i){if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function P(t){return(0,o.domData)(e,"in-progress",(0,r.intval)(t))}if(!(0,r.intval)((0,o.domData)(e,"in-progress"))&&(P(!0),t=t||a.AudioUtils.getAudioFromEl(e,!0))){var f=window.AudioPage&&currentAudioPage(e),E=f&&f.getOwnerId()<0&&f.canAddToGroup()&&f.getOwnerId()!==t.ownerId?-f.getOwnerId():0,v=a.AudioUtils.getAddRestoreInfo(),w=v[t.fullId];w&&v[w.addedFullId]&&(w=null);var I=(0,o.geByClass1)("_audio_row_"+t.fullId);I=I!=e&&I;var m=f&&f.getPageCurrentPlaylist(),b=(0,u.getContextPlaylist)(e,!0),C={group_id:E,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:b&&b.context||"",track_code:t.trackCode};w?"recom_hidden"==w.state?(f&&(f.restoreRecommendation(e),P(!1)),a.AudioUtils.onRowOver(e,!1,!0)):"deleted"==w.state?(A.ajax.post("al_audio.php",{act:"restore_audio",oid:t.ownerId,aid:t.id,hash:t.restoreHash,track_code:t.trackCode},{onDone:function(){(0,n.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED}),P(!1)},onFail:()=>(P(!1),!0)}),(0,o.removeClass)(e,"audio_row__deleted"),delete v[t.fullId],a.AudioUtils.onRowOver(e,!1,!0)):"added"==w.state&&(A.ajax.post("al_audio.php",{act:"delete_audio",oid:w.audio.ownerId,aid:w.audio.id,hash:w.audio.deleteHash,track_code:t.trackCode},{onDone:function(){(0,n.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED});var i=(0,s.getAudioPlayer)();i&&(i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,E?-E:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(w.addedFullId),i.notify(_.events.MUSIC_AUDIOS_DELETE,t)),P(!1)},onFail:()=>(P(!1),!0)}),(0,o.removeClass)(e,"audio_row__added"),I&&(0,o.removeClass)(I,"audio_row__added"),delete v[t.fullId],(0,s.getAudioPlayer)().notify(_.events.REMOVED,t.fullId,w.addedFullId)):(A.ajax.post("al_audio.php?act=add",C,{onDone:function(l,r){if((0,n.onAdditionalEvent)(e,t,{type:d.TYPE_ADDED}),l){var u=l[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+l[a.AudioUtils.AUDIO_ITEM_INDEX_ID];v[t.fullId]={state:"added",addedFullId:u,audio:a.AudioUtils.audioTupleToAudioObject(l)},(0,s.getAudioPlayer)().notify(_.events.MUSIC_AUDIOS_ADD,t),(0,c.isFunction)(i)&&i(),function(e,t){var i;if(!t||!t.id)return;var a=null==e||null==(i=e.parentElement)?void 0:i.querySelector(".audio_page_player_share");if(!a)return;var s=(0,o.se)(`\n    <div class="ta_l">\n      <div>${t.text}</div>\n    </div>\n `),l=()=>{window.ajax.post("al_index.php",{act:"help_hints_hide",hash:t.hash,hint_id:t.id})};(0,g.addEvent)(s,"click",l);var r=new h.ElementTooltip(a,{appendToParent:!0,cls:"feature_intro_tt feature_intro_blue_tt feature_intro_blue_tt--heightSmall",content:s,offset:[0,10],align:h.ElementTooltip.ALIGN_RIGHT,onHide:l});r.show(),a.addEventListener("mouseenter",(()=>{r.hide()}))}(e,r)}P(!1)},onFail:function(t){return t&&new y.MessageBox({title:(0,p.getLang)("global_error")}).content(t).setButtons((0,p.getLang)("global_close"),(()=>(0,l.curBox)().hide())).show(),(0,o.removeClass)(e,"audio_row__added"),P(!1),!0}}),(0,o.addClass)(e,"audio_row__added"),I&&(0,o.addClass)(I,"audio_row__added"),(0,s.getAudioPlayer)().notify(_.events.ADDED,t.fullId),f&&m&&f.onUserAction(t,m))}}},874229:(e,t,i)=>{"use strict";i.d(t,{addAudioToOwner:()=>a});var o=i(49535);function a(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),(0,o.cancelEvent)(t)}},141593:(e,t,i)=>{"use strict";i.d(t,{cancelReplacement:()=>a});var o=i(315544);function a(e,t,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),(0,o.re)(i)}},59943:(e,t,i)=>{"use strict";i.d(t,{chooseAudioBox:()=>s});var o=i(315544),a=i(49535);function s(e,t,i){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,(0,o.removeClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.add;else{var s=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>s)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,(0,o.addClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return(0,a.cancelEvent)(i)}},438022:(e,t,i)=>{"use strict";i.d(t,{claim:()=>l});var o=i(315544),a=i(505260),s=i(624715);function l(e,t,i){(0,o.addClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,s.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_claim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId})}},569272:(e,t,i)=>{"use strict";i.d(t,{deleteAudio:()=>p});var o=i(315544),a=i(850167),s=i(695724),l=i(386409),r=i(146143),_=i(786067),d=i(185850),n=i(986773),u=i(45634),c=i(295224),h=i(937884);function p(e,t,i,p,A){function g(t){return(0,o.domData)(e,"in-progress",(0,s.intval)(t))}if(window.tooltips&&tooltips.hideAll(),!(0,s.intval)((0,o.domData)(e,"in-progress"))){g(!0);var y=!1;t.isClaimed&&(y=!0);var P=u.AudioUtils.getAddRestoreInfo(),f=P[t.fullId];if(f&&f.deleteAll)(0,r.showFastBox)({title:(0,_.getLang)("audio_delete_all_title"),dark:1,onHide:()=>g(!1)},f.deleteConfirmMsg||"",(0,_.getLang)("global_delete"),(function(e){var t=(0,s.extend)({act:"delete_all"},f.deleteAll);ajax.post("al_audio.php",t,{showProgress:()=>(0,l.lockButton)(e),onDone:function(){var e=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,f.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);(0,a.getAudioPlayer)().deletePlaylist(e),nav.reload()},onFail:()=>!0})}),(0,_.getLang)("global_cancel"));else{if(y?(0,o.re)(e):(0,o.addClass)(e,"audio_row__deleted"),A){ajax.post("al_audio.php",{act:"remove_listened",audio_id:t.id,audio_owner_id:t.ownerId,hash:t.actionHash},{onFail:()=>!0}),(0,o.re)(e);var E=(0,a.getAudioPlayer)().getCurrentPlaylist();E&&E.getType()==AudioPlaylist.TYPE_RECOM&&E.getAlbumId()==u.AudioUtils.AUDIO_RECOMS_TYPE_LISTENED&&E.removeAudio(t.fullId)}else if(p){var v=u.AudioUtils.getAudioExtra(t).recom,w=null,I=(0,c.getContextPlaylist)(e);I&&(w=I.playlist&&I.playlist.getAlbumId());var m={act:"hide_recommendation",hash:v.hash,audio_id:t.fullId,playlist_id:w};nav.objLoc.audio_id&&(m.recommendation_type="query"),ajax.post("al_audio.php",m,{onDone:()=>{(0,n.onAdditionalEvent)(e,t,{type:d.TYPE_RECOMMENDATION_REMOVED}),g(!1)},onFail:()=>(g(!1),!0)}),P[t.fullId]={state:"recom_hidden"};var b=(0,a.getAudioPlayer)().getCurrentPlaylist();b&&b.getType()==AudioPlaylist.TYPE_RECOM&&(P[t.fullId].removedCurrentPos=b.removeAudio(t))}else ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:(i,o)=>{(0,n.onAdditionalEvent)(e,t,{type:d.TYPE_REMOVED}),y||g(!1),P[t.fullId]={state:"deleted",deleteAll:i,deleteConfirmMsg:o},y&&u.AudioUtils.deleteDeletedAudios(),(0,a.getAudioPlayer)().notify(h.events.MUSIC_AUDIOS_DELETE,t),u.AudioUtils.onRowOver(e,!1,!0)},onFail:()=>!0});u.AudioUtils.onRowOver(e,!1,!0)}}}},875751:(e,t,i)=>{"use strict";i.d(t,{deleteCurrentAudio:()=>s});var o=i(315544),a=i(850167);function s(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);var i=(0,a.getAudioPlayer)(),s=i.getPlaylistQueue();s&&(s.removeAudio(t.fullId),i.saveStateCurrentPlaylist()),(0,o.re)(e)}},600732:(e,t,i)=>{"use strict";i.d(t,{deleteDeletedAudios:()=>l});var o=i(695724),a=i(850167),s=i(894391);function l(){(0,o.each)((0,s.getAddRestoreInfo)(),((e,t)=>{"deleted"!==t.state&&"recom_hidden"!==t.state||(0,a.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}},580260:(e,t,i)=>{"use strict";i.d(t,{deleteListenedAudio:()=>a});var o=i(569272);function a(e,t){(0,o.deleteAudio)(e,t,!1,!1,!0)}},926100:(e,t,i)=>{"use strict";i.d(t,{deleteRecomsAudio:()=>a});var o=i(569272);function a(e,t){(0,o.deleteAudio)(e,t,!1,!0)}},81679:(e,t,i)=>{"use strict";i.d(t,{getDurationMod:()=>d,drawAudio:()=>n});i(115306),i(323123);var o=i(624715),a=i(45634),s=i(355645),l=i(695724),r=i(289988),_=i(166773);function d(e){return e<600?"s":e<3600?"m":e<36e3?"l":"n"}function n(e,t){for(var i=JSON.parse((0,l.getTemplate)("audio_bits_to_cls")),n=e[a.AudioUtils.AUDIO_ITEM_INDEX_FLAGS],u=[],c=0;c<32;c++){var h=1<<c;n&h&&u.push(i[h])}var p=(0,o.audioTupleToAudioObject)(e),A=a.AudioUtils.isPodcast(e);A&&(u.push("audio_podcast"),a.AudioUtils.isPrivatePodcast(e)&&u.push("audio_podcast_private")),t&&u.push(t);var g,y=e[a.AudioUtils.AUDIO_ITEM_INDEX_COVER_URL].split(",")[0],P=void 0===y?"":y,f=a.AudioUtils.getAudioPerformers(e),E=e[a.AudioUtils.AUDIO_ITEM_INDEX_DURATION],v=(0,r.formatTime)(E),w=(0,l.clean)(JSON.stringify(e));try{var I=(0,l.getTemplate)("podcast_row",e);g=A&&I?I:(0,l.getTemplate)("audio_row",e)}catch(e){return""}var m="";return p.hasTrackPage&&(u.push("audio_has_track_page"),m=`/audio${p.trackPageId}`),(0,_.isRadio)(p)&&u.push("audio_row--radio"),g=(g=(g=(g=(g=(g=(g=(g=(g=g.replace(/%cls%/,(()=>u.join(" ")))).replace(/%duration%/,(()=>v))).replace(/%serialized%/,(()=>w))).replace(/%cover_image%/,(()=>{return e=P,t=p.title,e?`<img class='audio_row__cover' alt='${t}' src='${e}' loading='lazy' decoding='async' width='40' height='40' />`:`<div class='audio_row__cover audio_row__without_cover'>${(0,s.getIcon24Song)().icon}</div>`;var e,t}))).replace(/%performers%/,(()=>f))).replace(/%track_url%/,(()=>m))).replace(/%duration_mod%/,(()=>d(E)))).replace(/%chart_info_position%/,(()=>{return(t=e[a.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[a.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t}))).replace(/%chart_info_state%/,(()=>function(e){var t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[a.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[a.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state)))}},263677:(e,t,i)=>{"use strict";i.d(t,{editAudio:()=>a});var o=i(146143);function a(e,t,i){(0,o.showBox)("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px;",hideButtons:1},dark:1})}},873040:(e,t,i)=>{"use strict";i.d(t,{getActionIcon:()=>A});var o=i(908928),a=i(221324),s=i(685098),l=i(177801),r=i(14377),_=i(385023),d=i(743707),n=i(784502),u=i(244030),c=i(165266),h=i(712768),p={current_delete:(0,n.getIcon20Cancel)(),recoms_delete:(0,n.getIcon20Cancel)(),listened_delete:(0,n.getIcon20Cancel)(),delete:(0,n.getIcon20Cancel)(),restore_recoms:(0,d.getIcon20Add)(),more:(0,c.getIcon20More)(),edit:(0,l.getIcon20WriteOutline)(),recoms:(0,s.getIcon20Stars)(),lyrics:(0,h.getIcon20TextTtOutline)()};function A(e){var t=p[e],i="";if(t)i=g(t);else switch(e){case"add":i=g((0,u.getIcon20Check)())+g((0,d.getIcon20Add)());break;case"next":i=`<div class="audio_row__icon--horizontal">${g((0,r.getIcon20ListPlayOutline)())+g((0,_.getIcon20ListAddOutline)())}</div>`;break;case"fave":i=g((0,o.getIcon24FavoriteOutline)())+g((0,a.getIcon24Favorite)())}return i}function g(e){return`<div class="audio_row__icon audio_row__icon_${e.name}">${e.icon}</div>`}},894391:(e,t,i)=>{"use strict";function o(){return window.audioAddRestoreInfo||(window.audioAddRestoreInfo={}),window.audioAddRestoreInfo}i.d(t,{getAddRestoreInfo:()=>o})},78838:(e,t,i)=>{"use strict";i.d(t,{getAudioFromEl:()=>s});var o=i(315544),a=i(45634);function s(e,t){e=(0,o.domClosest)("_audio_row",e);var i=(0,o.data)(e,"audio")||JSON.parse((0,o.domData)(e,"audio"));if(!i)return null;if(t){(i=a.AudioUtils.audioTupleToAudioObject(i)).isDeleted=(0,o.hasClass)(e,"audio_row__deleted"),i.isCurrent=(0,o.hasClass)(e,a.AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=(0,o.hasClass)(e,a.AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!(0,o.gpeByClass)("_audio_section__current",e),i.isNumeric=!!(0,o.gpeByClass)("audio_numeric",e),i.isWithCovers=!!(0,o.gpeByClass)("audio_w_covers",e),i.withInlinePlayer=!i.isWithCovers&&!(0,o.gpeByClass)("audio_no_inline_player",e),i.isInSnippet=!!(0,o.gpeByClass)("_audio_pl_snippet__list",e),i.isInEditBox=!!(0,o.gpeByClass)("_audio_pl_edit_box",e),i.isInRecomsBlock=!!(0,o.gpeByClass)("_audio_recoms_blocks",e),i.isInFastChat=!!(0,o.gpeByClass)("fc_tab",e),i.isInAttach=!!(0,o.gpeByClass)("media_preview",e),i.isSetClaimed=(0,o.hasClass)(e,"audio_moder_claimed"),i.isPodcastListSnippet=(0,o.hasClass)(e,"podcast_list_snippet");var s=(0,o.gpeByClass)("_audio_pl",e);i.isCurrentAlbumSnippet=!!i.album&&!!s&&s.dataset.playlistId===`playlist_${i.album[0]}_${i.album[1]}`}return i}},729956:(e,t,i)=>{"use strict";i.d(t,{getAudioFullId:()=>a});var o=i(722904);function a(e){return e[o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]}},979663:(e,t,i)=>{"use strict";i.d(t,{onAudioChoose:()=>r});var o=i(695724),a=i(786067),s=i(315544),l=i(49535);function r(e,t,i,r){if((0,o.isUndefined)(t.selected)){var _=cur.attachCount&&cur.attachCount()||0,d=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",d,r),(!cur.attachCount||cur.attachCount()>_)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,(0,s.addClass)((0,s.domPN)(t),"audio_selected");var n=(0,s.getSize)(t)[0];(0,s.setStyle)(t,"width",n),t.innerHTML=(0,a.getLang)("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,(0,s.removeClass)((0,s.domPN)(t),"audio_selected"),t.innerHTML=(0,a.getLang)("global_add_media");return(0,l.cancelEvent)(e)}},934495:(e,t,i)=>{"use strict";i.d(t,{onRowLeave:()=>a});var o=i(315544);function a(e){(0,o.data)(e,"leaved",!0);var t=(0,o.data)(e,"tt");if((!t||!t.isShown())&&(clearTimeout(window.audioRowHoverTO),(0,o.data)(e,"actions"))){var i=(0,o.geByClass1)("_audio_row__actions",e),a=(0,o.geByClass1)("_audio_row__duration",e);(0,o.re)(i),(0,o.setStyle)(a,"visibility","visible"),(0,o.data)(e,"actions",0)}}},505260:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{onRowOver:()=>onRowOver});var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57327),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(454747),_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(315544),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45634),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(850167),_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(786067),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(49535),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(695724),_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(873040);function onRowOver(audioEl,event,forceRedraw){(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(audioEl,"podcast_list_snippet")||(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(audioEl,"podcast_snippet__controls")||((0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(audioEl,"leaved",!1),(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(audioEl,"actions")&&!forceRedraw||(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(audioEl,"no_extra")||(clearTimeout(window.audioRowHoverTO),window.audioRowHoverTO=setTimeout((()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);var audio=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAudioFromEl(audioEl),audioObject=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAudioFromEl(audioEl,!0),playerUI=(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_4__.getAudioPlayerUI)(),actions=[],moreActions=[],context=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getContextPlaylist(audioEl,!0),_AudioUtils$contextSp=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.contextSplit(context),sectionContext=_AudioUtils$contextSp[0],blockContext=_AudioUtils$contextSp[1],extra=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAudioExtra(audioObject);if(context=sectionContext,audioObject.isDeleted)if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject))actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{var deleteRestoreInfo=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAddRestoreInfo();deleteRestoreInfo[audioObject.fullId]&&deleteRestoreInfo[audioObject.fullId].deleteAll&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{var actionsList=["next","add","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject))actionsList=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isExternalStream(audioObject))actionsList=[];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"current_delete","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)if("my_audios_block"===blockContext)actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"];else switch(context){case"album_page":actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];break;case"my":case"my_audios_short":case"module":case"user_list":case"group_list":actionsList=[playerUI.lyrics.enabled&&"lyrics","recoms","edit","next","add","delete","share","open_album","add_to_playlist"].filter(Boolean);break;case"edit_playlist":actionsList=["add","next","edit"];break;case"recoms_recoms":actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"];break;case"recoms_recent_audios":actionsList=["recoms","edit","next","add","listened_delete","share","open_album","add_to_playlist"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"]);break;case"recommendations":"recoms_recoms_detail"===blockContext&&(actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"]);break;case"apps_edit":actionsList=["apps_edit_delete"];break;case"clips":case"clip_effect_list":audioObject.isOriginalSound&&(actionsList=[]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add","share","open_album","add_to_playlist"])}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_7__.each)(extra.moder_actions,((i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])})),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter((e=>"open_album"!==e))),vk.id||(actionsList=actionsList.filter((e=>"open_album"===e)));var ap=(0,_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_4__.getAudioPlayer)(),currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget&&(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)||(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_7__.inArray)(context,["my","my_audios_short","group_list","search_results","my_playlists"]));actionsList.forEach((e=>{switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":var t=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(t=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=t&&actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.replaceWithOriginal.bind(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils,audioEl,audioObject))},(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.editEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":!audioObject.canDelete||audioObject.isInRecomsBlock||vk.widget||actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"current_delete":actions.push(["current_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms_delete":actions.push(["recoms_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteRecomsAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"listened_delete":audioObject.isInRecomsBlock||actions.push(["listened_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.deleteListenedAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)&&actions.push(["fave",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"share":audioObject.isClaimed||moreActions.push(["share",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.shareAudio,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.showAudioAlbum,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("audio_open_album")]);break;case"open_episode":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.openEpisode,(0,_web_lib_lang__WEBPACK_IMPORTED_MODULE_5__.getLang)("audio_podcast_open_episode")]);break;case"lyrics":audioObject.hasLyrics&&actions.push(["lyrics",()=>{playerUI.lyrics.open({audio,playlist:context.playlist,context:audioObject.context||context.context})},"",'onmouseover="audioShowActionTooltip(this)"'])}})),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){var actionsEl=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)('<div class="_audio_row__actions audio_row__actions"></div>');actions.forEach((e=>{var t=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getRowActionName(e[0],audioObject,audioEl),i=(0,_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_8__.getActionIcon)(e[0]),o=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(`<button\naria-label="${t}"\ndata-action="${e[0]}"\nclass="audio_row__action audio_row__action_${e[0]} _audio_row__action_${e[0]}${e[4]?" "+e[4]:""}" ${e[3]||""}>\n${e[2]||i}\n</button>`);e[1]&&o.addEventListener("click",(t=>(e[1]&&e[1].call(window,audioEl,audioObject),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(t)))),actionsEl.appendChild(o)}));var rectoreInfo=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.getAddRestoreInfo(),audioRestorationInfo=rectoreInfo[audioObject.fullId];audioRestorationInfo&&rectoreInfo[audioRestorationInfo.addedFullId]&&(audioRestorationInfo=null),audioRestorationInfo&&"added"===audioRestorationInfo.state&&(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(audioEl,"audio_row__added");var rowInfoEl=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_row__info",audioEl),rowDurationEl=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_row__duration",audioEl),rowAlreadyActionsEl=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_row__actions",audioEl);if(!rowInfoEl)return;(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.re)(rowAlreadyActionsEl),(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.setStyle)(rowDurationEl,"visibility","hidden"),rowInfoEl.appendChild(actionsEl);var moreActionsBtnEl=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_row__action_more",actionsEl);moreActions.length&&moreActionsBtnEl&&setMoreAction(audioEl,audio,audioObject,moreActions,moreActionsBtnEl),(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(audioEl,"actions",1)}}),forceRedraw?0:10)))}function setMoreAction(e,t,i,o,a){var s=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("im-page_classic",e),l=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("_im_peer_history_w",e),r=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("_im_peer_history",e),_=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("_im_chat_body_abs",e),d=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),n=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("wk_history_audio_content",e),u=e.closest(".CatalogBlock"),c={};r?(c.getWrapEl=()=>s?null:_,c.appendTo=r):n?c.appendTo=n:u?c.appendTo=u:(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.gpeByClass)("post",e)?c.appendTo=document.body:c.appendToParent=!0;var h=new ElementTooltip(a,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_7__.extend)({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:d,bottomGap:s&&l?parseInt((0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(l,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domData)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"leaved")&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.onRowLeave(e)}},c));o.forEach((o=>{var a,s,l=(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)((0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.rs)(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,o));"add_to_playlist"===o[0]?(l.addEventListener("mouseenter",a=()=>{clearTimeout(s),s=setTimeout((()=>{l.removeEventListener("mouseenter",a),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.initRowPlaylistsChooser(t,l,h)}),150)}),l.addEventListener("click",(()=>{s||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_3__.AudioUtils.initRowPlaylistsChooser(t,l,h)})),l.addEventListener("mouseleave",(()=>{clearTimeout(s)}))):l.addEventListener("click",(t=>(o[1].call(window,e,i),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(t))));d.appendChild(l)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.addEvent)(a,"click",(e=>{h.isShown()||h.show(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_6__.cancelEvent)(e)})),(0,_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"tt",h)}},373761:(e,t,i)=>{"use strict";i.d(t,{replaceWithOriginal:()=>_});var o=i(315544),a=i(850167),s=i(722904),l=i(81679),r=i(624715);function _(e,t,i){(t=t||(0,a.getAudioPlayer)().getCurrentAudio())&&(t=(0,r.audioTupleToAudioObject)(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(a){var r=JSON.parse(t.extra).claim.original;r[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=a,r[s.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;var _=(0,o.se)((0,l.drawAudio)(r));e.parentElement.insertBefore(_,e),e.parentElement.removeChild(e),i&&i()},onFail:()=>(i(),!0)}))}},531254:(e,t,i)=>{"use strict";i.d(t,{shareAudio:()=>n});var o=i(185850),a=i(850167),s=i(146143),l=i(486125),r=i(986773),_=i(12733),d=i(624715);function n(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(t=t||(0,a.getAudioPlayer)().getCurrentAudio()){t=(0,d.audioTupleToAudioObject)(t);var i=(0,_.isPodcast)(t)?"podcast":"audio";return(0,r.onAdditionalEvent)(e,t,{type:o.TYPE_SHARE_AUDIO}),!(0,s.showBox)("like.php",{act:"publish_box",object:i+t.fullId,list:t.actionHash,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,l.showDoneBox)(e),!0}})}}},21734:(e,t,i)=>{"use strict";i.d(t,{showAudioRestriction:()=>f});var o=i(624715),a=i(786067),s=i(486125),l=i(695724),r=i(81679),_=i(722904),d=i(315544),n=i(982452),u=i(850167),c=i(146143),h=i(460615),p=i(40906),A=i(124041),g=i(420130),y=i(785039);function P(e){var t=A.FlatButton.render({children:(0,a.getLang)("global_close"),appearance:A.FlatButtonAppearance.PRIMARY,size:A.FlatButtonSize.M,restAttrs:{onclick:"curBox().hide()"}});(0,c.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()" aria-label="${(0,a.getLang)("global_close")}">\n      ${(0,g.getIcon24Cancel)().icon}\n    </button>\n    <div class="audio_restriction_box__icon">${(0,y.getIcon56PensiveFace)().icon}</div>\n    <div class="audio_restriction_box__title">${(0,a.getLang)("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n      ${t}\n    </div>\n  `)}function f(e,t){if(void 0===t&&(t={}),!e)return!1;if((e=(0,o.audioTupleToAudioObject)(e)).restrictionStatus){if(e.actionHash){(0,h.statlogsValueEvent)("audio_restriction_popup","show",e.restrictionStatus);var i=(0,c.showBox)("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){var i=(0,s.curBox)();(0,p.isFunction)(t.onShow)&&t.onShow(),i&&i.once("click:ok",(()=>{(0,h.statlogsValueEvent)("audio_restriction_popup","click",e.restrictionStatus)}))},onHide:i=>{(0,p.isFunction)(t.onHide)&&t.onHide(),i||(0,h.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,i)=>{if(i&&i.play){t.hide();var a=function(e){var t=(0,d.geByClass)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;var i=(0,n.parseJSON)((0,d.domData)(t[0],"audio"));if(!i)return!1;var o=(0,n.parseJSON)(i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);o&&delete o.claim,i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(o);var a=(0,u.getAudioPlayer)().getCurrentPlaylist(),s=(0,d.se)((0,r.drawAudio)(i,"no_extra"));if(a){var c=i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],h=a.getAudio(c);h&&(h[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],h[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],h[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=i[_.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return(0,l.each)(t,((e,t)=>{var o=e>0?(0,d.se)((0,r.drawAudio)(i,"no_extra")):s;t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t)})),s}(i.audio?(0,o.audioTupleToAudioObject)(i.audio):e),s=(0,u.getAudioPlayer)();a&&s.toggleAudio(a,{target:a})}},onFail:()=>(i&&i.hide(),P(e),!0)})}else P(e);return!0}return!1}},402297:(e,t,i)=>{"use strict";i.d(t,{toggleAudioLyrics:()=>s});var o=i(315544),a=i(45634);function s(e,t){var i=(0,o.geByClass1)("_audio_row__lyrics",e);if(i){if((0,o.toggle)(i)){var s=(0,o.getSize)(e)[1],l=(0,o.getSize)(i)[1];(0,o.setStyle)(e,"height",s+l),(0,o.data)(e,"prevHeight",s)}else{var r=(0,o.data)(e,"prevHeight");(0,o.setStyle)(e,"height",r)}}else{(0,o.addClass)(e,"audio_loading");var _={act:"get_lyrics",aid:t.fullId,lid:t.lyrics};a.AudioUtils.isPodcast(t)&&(_.podcast=!0),ajax.post("al_audio.php",_,{onDone:function(s){(0,o.removeClass)(e,"audio_loading"),i=(0,o.se)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${s}</div></div>`),(0,o.geByClass1)("_audio_row_content",e).appendChild(i),a.AudioUtils.toggleAudioLyrics(e,t)},onFail:()=>!0})}}},703912:(e,t,i)=>{"use strict";i.d(t,{unclaim:()=>l});var o=i(315544),a=i(505260),s=i(624715);function l(e,t,i){(0,o.removeClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,s.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_unclaim",claim:i,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})}},782928:(e,t,i)=>{"use strict";i.d(t,{initUpload:()=>c});i(319601),i(115306),i(323123);var o=i(315544),a=i(45634),s=i(726271),l=i(101178),r=i(786067),_=i(486125),d=i(695724),n=i(668040);function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},u.apply(this,arguments)}function c(e,t,i,c,h,p,A,g,y,P,f,E){cur.loadAudioDone=function(t,i){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,i),cur.boxClose){delete cur.boxClose;var s=cur.audiosLoaded>1?(0,r.getLang)("audio_success_msg_multiple"):(0,r.getLang)("audio_success_msg");e.setOptions({title:(0,r.getLang)("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(s),(0,o.hide)(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+i[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone(){cur.__phinputs=cur.__phinputs||[],(0,l.globalHistoryDestroy)(nav.objLoc[0])}})},cur.loadAudioFailed=function(i,a){(0,o.hide)(e.progress),Upload.embed(i);var s=(0,o.ge)("audio_new_error"),l=s&&(0,o.domFC)(s),_=a.split("|");l&&(a=_[0],_=_[1],l.innerHTML=_||(t[a]||(0,r.getLang)("audio_loading_error").replace("{code}",(0,d.intval)(a))),(0,o.show)(s))},Upload.init("audio_add_upload_btn",i,c,{file_name:"file",file_size_limit:h,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:p,onUploadStart:function(t,i){"form"===Upload.types[t]&&(0,o.show)(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||((0,o.geByClass1)("file",(0,o.ge)("audio_add_upload_btn")).disabled=!0),(0,_.curBox)().changed=!0},onUploadProgress:function(e,t,i){if(!(0,o.ge)("form"+e+"_progress")){for(var a=Upload.obj[e],l=(0,o.getSize)(a)[1]/2+10,r=a.firstChild;r;)1===r.nodeType&&(r.id==="uploader"+e&&s.browser.msie?(0,o.setStyle)(r,{position:"relative",left:"-5000px"}):(0,o.setStyle)(r,{visibility:"hidden"})),r=r.nextSibling;a.appendChild((0,o.ce)("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:l+"px",marginTop:-l+"px"}))}var _=(0,d.intval)(t/i*100);(0,o.setStyle)((0,o.ge)("form"+e+"_progress"),{width:_+"%"})},onUploadComplete:function(e,t){var i;this.use_go_uploader||(t=t.replace(/\+/g," "));try{i=JSON.parse(t)}catch(e){i=(0,n.fromQueryString)(t)}var o={};this.use_go_uploader?o={act:"done_add",upldr:1,go_uploader_response:t}:(i.title=decodeURIComponent(i.title),i.artist=decodeURIComponent(i.artist),o=u({},i,{},{act:"done_add",upldr:1})),i.code?cur.loadAudioFailed(e,i.code):ajax.post("al_audio.php",o,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:A,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:g,error:y,error_hash:P,dropbox:"choose_audio_dropbox",use_go_uploader:E}),e.setControlsText(f)}},700688:(e,t,i)=>{"use strict";i.d(t,{getUMAInfo:()=>a});var o=i(146143);function a(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})}},251980:(e,t,i)=>{"use strict";i.d(t,{getUMAInfoAlbum:()=>a});var o=i(146143);function a(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})}},45634:(e,t,i)=>{"use strict";i.d(t,{AudioUtils:()=>ke});i(319601);var o=i(722904),a=i(867696),s=i(402297),l=i(442277),r=i(505260),_=i(934495),d=i(759448),n=i(403753),u=i(271891),c=i(459285),h=i(739724),p=i(531254),A=i(234247),g=i(425209),y=i(373761),P=i(263677),f=i(798783),E=i(875751),v=i(926100),w=i(580260),I=i(569272),m=i(888614),b=i(750288),C=i(600732),O=i(747447),T=i(949002),D=i(563767),L=i(979663),U=i(409082),M=i(548616),S=i(703780),R=i(285200),x=i(869053),B=i(655700),k=i(160260),N=i(894391),W=i(594144),F=i(207879),K=i(874229),j=i(59943),H=i(597970),Y=i(844900),Q=i(81679),X=i(927313),V=i(78838),G=i(729956),q=i(624715),$=i(517097),z=i(295224),J=i(270605),Z=i(930982),ee=i(438022),te=i(703912),ie=i(700688),oe=i(251980),ae=i(141593),se=i(748409),le=i(470353),re=i(12733),_e=i(262121),de=i(309427),ne=i(144670),ue=i(557761),ce=i(568062),he=i(734264),pe=i(21734),Ae=i(430463),ge=i(984287),ye=i(463091),Pe=i(636760),fe=i(840887),Ee=i(190347),ve=i(285132),we=i(291976),Ie=i(57472),me=i(953054),be=i(782928),Ce=i(355145),Oe=i(920817),Te=i(254492),De=i(944568),Le=i(341487),Ue=i(719927),Me=i(333097),Se=i(896438),Re=i(166773),xe=i(890458);function Be(){return Be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},Be.apply(this,arguments)}var ke=Be({},o.AUDIO_PLAYER_ENUMS,{audioSearchPerformer:a.audioSearchPerformer,toggleAudioLyrics:s.toggleAudioLyrics,getRowActionName:l.getRowActionName,initRowPlaylistsChooser:u.initRowPlaylistsChooser,addToPlaylistsBoxInit:c.addToPlaylistsBoxInit,showRecoms:h.showRecoms,shareAudio:p.shareAudio,showAudioAlbum:A.showAudioAlbum,openEpisode:g.openEpisode,replaceWithOriginal:y.replaceWithOriginal,editAudio:P.editAudio,editEpisode:f.editEpisode,deleteCurrentAudio:E.deleteCurrentAudio,deleteRecomsAudio:v.deleteRecomsAudio,deleteListenedAudio:w.deleteListenedAudio,deleteAudio:I.deleteAudio,deleteEpisode:m.deleteEpisode,restoreEpisode:b.restoreEpisode,deleteDeletedAudios:C.deleteDeletedAudios,faveEpisode:O.faveEpisode,contextSplit:T.contextSplit,showAudioPlaylist:D.showAudioPlaylist,editPlaylist:M.editPlaylist,followPlaylist:S.followPlaylist,getLayer:R.getLayer,updateQueueReceivedPost:x.updateQueueReceivedPost,toggleAudioHQBodyClass:B.toggleAudioHQBodyClass,hasAudioHQBodyClass:k.hasAudioHQBodyClass,getAddRestoreInfo:N.getAddRestoreInfo,getPlaylistAddRestoreInfo:W.getPlaylistAddRestoreInfo,addAudio:F.addAudio,addAudioToOwner:K.addAudioToOwner,chooseAudioBox:j.chooseAudioBox,getAudioArtistsString:H.getAudioArtistsString,getAudioPerformers:Y.getAudioPerformers,drawAudio:Q.drawAudio,isClaimedAudio:X.isClaimedAudio,getDurationMod:Q.getDurationMod,getAudioExtra:Se.getAudioExtra,getAudioFromEl:V.getAudioFromEl,getAudioFullId:G.getAudioFullId,audioTupleToAudioObject:q.audioTupleToAudioObject,initDomPlaylist:$.initDomPlaylist,getContextPlaylist:z.getContextPlaylist,renderAudioDiag:Z.renderAudioDiag,claim:ee.claim,unclaim:te.unclaim,getUMAInfo:ie.getUMAInfo,getUMAInfoAlbum:oe.getUMAInfoAlbum,cancelReplacement:ae.cancelReplacement,removeFromGroup:se.removeFromGroup,addToGroupBox:le.addToGroupBox,showAudioRestriction:pe.showAudioRestriction,isPodcast:re.isPodcast,isArticleTts:_e.isArticleTts,isRadio:Re.isRadio,isExternalStream:xe.isExternalStream,isMarusiaTrack:de.isMarusiaTrack,isMarusiaTale:ne.isMarusiaTale,isPrivatePodcast:ue.isPrivatePodcast,followArtist:ye.followArtist,unfollowArtist:Pe.unfollowArtist,followCurator:fe.followCurator,unfollowCurator:Ee.unfollowCurator,followOwner:ve.followOwner,unfollowOwner:we.unfollowOwner,trackArtistToOfficial:Ie.trackArtistToOfficial,PodcastsLogs:ce,copyPlaylistLink:he.copyPlaylistLink,getAlbumParts:Ae.getAlbumParts,drawAlbumPartRow:ge.drawAlbumPartRow,onRowOver:r.onRowOver,onRowLeave:_.onRowLeave,onAudioAddedToPlaylist:d.onAudioAddedToPlaylist,onAudioChoose:L.onAudioChoose,onPlaylistChoose:U.onPlaylistChoose,claimPlaylist:me.claimPlaylist,initUpload:be.initUpload,turnPlaylistDiscover:Ce.turnPlaylistDiscover,hidePlaylistFromRecoms:Oe.hidePlaylistFromRecoms,showPlaylistInRecoms:Te.showPlaylistInRecoms,hideCatalogBlock:De.hideCatalogBlock,mergeAudioTupleWithoutContext:Le.mergeAudioTupleWithoutContext,followRadiostation:Ue.followRadiostation,unfollowRadiostation:Me.unfollowRadiostation,_showPlaylistsChooser:n.showPlaylistsChooser,debugLog:J.debugLog})},105832:(e,t,i)=>{"use strict";function o(e){return e&&e<=-2e9&&e>=-2002e6}i.d(t,{checkIsOfficialPlaylist:()=>o})},782508:(e,t,i)=>{"use strict";i.d(t,{connectListenQueue:()=>A});i(454747);var o=i(511867),a=i(45634),s=i(850167),l=i(146143),r=i(143707),_=i(19331),d=null,n=null,u=!1,c=0,h=new o.WebQueueListener((function(e){if(e.failed)return void A(!0);for(var t=(0,s.getAudioPlayer)(),i=t.isPlaying(),o=t.getCurrentAudio(),r=a.AudioUtils.isPodcast(o),_=0;_<e.events.length;_++){var d=e.events[_].data;if("start"===d.type&&AudioPlayer.getDeviceId()!==d.uuid&&!n&&!r&&i){t.pausedByQueue=Date.now(),t.pause(),n=(0,l.showBox)("al_audio.php",{act:"start_playback_box",uuid:d.uuid,device_name:d.device_name},{params:{hideButtons:!0,onHide:()=>{n=!1}},containerClass:"audio_playback_box"});break}}})),p=new o.WebQueueListener((function(e){e.events.length&&e.events.forEach((e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)}))}));function A(e){if(window.Notifier&&vk.id){var t=window.ap&&(0,s.getAudioPlayer)(),i=t&&t.getCurrentAudio(),o=window.Notifier&&!vk.widget,l=!u&&i?h.listenQueueKey:p.listenQueueKey,n=a.AudioUtils.isPodcast(i);(e||o&&!n&&!l)&&(i||(0,_.partConfigEnabled)("audio_subscription_update"))&&function(e,t,i){void 0===e&&(e={});void 0===t&&(t=()=>{});void 0===i&&(i=()=>!0);ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:i})}(i=i?a.AudioUtils.audioTupleToAudioObject(i):{},(e=>{var t=function(e){var t=(0,r.unpackQueues)(e);t.audio&&h.connect(t.audio);t.subscription&&p.connect(t.subscription);return t}(e);u=!i||!t.audio,(t.audio||t.subscription)&&(d&&clearTimeout(d),d=window.setTimeout((()=>A(!0)),3e4))}),(()=>(++c<3&&A(!0),!0)))}}},949002:(e,t,i)=>{"use strict";i.d(t,{contextSplit:()=>a});i(323123);var o=i(40906);function a(e){return(0,o.isObject)(e)&&(e=e.context),(e||"").split(":")}},270605:(e,t,i)=>{"use strict";function o(){}i.d(t,{debugLog:()=>o})},713359:(e,t,i)=>{"use strict";i.d(t,{getContext:()=>s});var o=i(295224),a=i(949002);function s(e){var t,i=window.currentAudioPage&&window.currentAudioPage(e),s=i&&i.getPageCurrentPlaylist(),l=(0,o.getContextPlaylist)(e,!0);return l&&(l=(0,a.contextSplit)(l),Array.isArray(l)&&l.length>0&&(t=l[0])),("search"===t&&s&&s.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(t="search:external"),t}},285200:(e,t,i)=>{"use strict";function o(){var e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e}i.d(t,{getLayer:()=>o})},812595:(e,t,i)=>{"use strict";i.d(t,{getPlaylistUrl:()=>a});var o=i(105832);function a(e,t,i,a){void 0===a&&(a=!1);var s=`/music/${(0,o.checkIsOfficialPlaylist)(e)?"album":"playlist"}/${e}_${t}${i?`_${i}`:""}`;return a?`${location.protocol}//${location.host}${s}`:s}},397807:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>AudioLayer});var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(787481),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(475632),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(315544);class AudioLayer{static prepare(e){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/suggester.js"),window.jsc("web/auto_list.js"),window.jsc("web/indexer.js")],(()=>{e&&e()}))}constructor(){this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.ge)("top_audio_layer_place"),topPlayBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_top_audio_player_play"),topNotaBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("TopNavBtn__audio"),topNotaBtnGroup:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.ge)("top_audio_btn_group")}}toggle(e,t){this._initTooltip();var i=this._els.tooltip,o=void 0!==e?e:!i.isShown();o&&this.initPage(),o?(i.show(),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__.cancelStackPush)("top_audio",(()=>{this.toggle(!1,!0)}),!0)):(t||(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_1__.cancelStackPop)(),i.hide()),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(this._els.topNotaBtn,"TopNavBtn--active",o)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){var e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.layerPlace),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)("ts_wrap")[0]-e[0]-1,i=0;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.isVisible)(this._els.topNotaBtnGroup)?i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.topNotaBtn)[0]-e[0])+15:i=-t+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(this._els.topPlayBtn)[0]-e[0])+3;return{left:t,top:0,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="audio_layer_container">\n        <div class="top_audio_loading">\n          ${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){(0,_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_audio_page_layout",this._els.container),data),this._initSection=data.initSection||void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0})}}},913151:(e,t,i)=>{"use strict";i.d(t,{AudioPlayer:()=>Z});i(892222),i(57327),i(491038),i(66992),i(747042),i(140561),i(241539),i(788674),i(292087),i(323123),i(454747),i(333948);var o=i(45634),a=i(726271),s=i(206735),l=i(850167),r=i(786067),_=i(787481),d=i(40906),n=i(146143),u=i(479957),c=i(49535),h=i(683609),p=i(486125),A=i(376567),g=i(695724),y=i(67766),P=i(315544),f=i(189158),E=i(950280),v=i(185850),w=i(615152),I=i(804333),m=i(222994),b=i(937884),C=i(171171),O=i(471323),T=i(331811),D=i(624715),L=i(522683),U=i(767356),M=i(782508),S=i(191040),R=i(893301),x=i(341487),B=i(729956),k=i(19331),N=i(859866),W=i(273271),F=i(383611),K=i(842776),j=i(414325),H=i(722904),Y=i(333765),Q=i(166773),X=i(924583),V=i(746785);function G(){return G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},G.apply(this,arguments)}function q(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var z={},J=(0,S.throttledPromise)((()=>{}),1500,!0);class Z{constructor(){if(this.ensureUrlReject=null,this._currentAudio=!1,this._isPlaying=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlistQueue=new E.PlaylistQueue(new j.FetchService),this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,!vk.isBanned){o.AudioUtils.debugLog("Player creation"),this.eventBus=new T.EventBus;var e=new f.WebPlayerAdapter(this);this.stats=new v.AudioStats(e),this.lyrics=new Y.AudioLyricsProvider,this.ads=new m.AudioAds(this,Z.getVersion()),this.connectEvents(),(0,M.connectListenQueue)(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),setTimeout((()=>{this.restoreState(),o.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()}));var t=new K.WebMediaSessionAdapter(this);new F.AudioMediaSession(t).init()}}static getVersion(){return 15}static _sendLCNotification(){var e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){var t="_audio_show_hq_label";return void 0===e?!!ls.get(t):(e=!!e,ls.set(t,e),o.AudioUtils.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return(0,P.geByClass)(`_audio_row_${e}`,t)}static getDeviceId(){var e=ls.get(Z.LS_PREFIX+Z.LS_UUID);return e||(e=C(),ls.set(Z.LS_PREFIX+Z.LS_UUID,e)),e}static showSubscriptionPopup(){(0,n.showBox)("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return(0,g.intval)(ls.get(Z.LS_PREFIX+Z.LS_DURATION_TYPE))}static _setTabIcon(e){(0,s.setFavIcon)(Z.tabIcons[e])}static _lsGet(e){return ls.get(Z.LS_PREFIX+e)}static _lsSet(e,t){return ls.set(Z.LS_PREFIX+e,t)}static _podcastGetStates(){return(Z._lsGet(Z.LS_PODCASTS)||z).states||{}}static _podcastSetStates(e){var t=Z._lsGet(Z.LS_PODCASTS)||z;t.states=e,Z._lsSet(Z.LS_PODCASTS,t),z=t}static podcastToggleFave(e,t){if(t){t=o.AudioUtils.audioTupleToAudioObject(t);var i=o.AudioUtils.getAudioExtra(t).faveHash;i&&bookmarkPodcast(e,t.fullId,i)}}static podcastGetPlaybackRate(){return(Z._lsGet(Z.LS_PODCASTS)||z).rate||1}static getLang(e){var t=(0,l.getAudioPlayer)();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){Z._iterateCacheKeys((e=>e===Z.LS_VER))}static clearOutdatedCacheKeys(){(ls.get(Z.LS_PREFIX+Z.LS_SAVED)||0)<(0,d.vkNow)()-72e5&&Z._iterateCacheKeys(((e,t)=>!(0,g.inArray)(t,[Z.LS_PL,Z.LS_TRACK,Z.LS_PROGRESS])))}getCurrentAudioLs(){return ap.getCurrentAudio()||Z._lsGet(Z.LS_TRACK)||null}static clearAllCacheKeys(){Z._iterateCacheKeys((()=>!1)),(0,A.setCookie)("remixcurr_audio","",-1)}static _iterateCacheKeys(e){L.vkLocalStorage.getPrefixedKeys(`${Z.LS_KEY_PREFIX}_`).forEach((t=>{var i=t.split("_"),o=i[1],a=i[2];e(o,a)||L.vkLocalStorage.removeItem(a)}))}_initImpl(){this._impl&&this._impl.destroy();var e=0,t=!1,i=t=>{if(-1!==e){if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;var i=new MessageBox({title:(0,r.getLang)("global_error")}).content((0,r.getLang)("audio_error_loading")).setButtons("Ok",(function(){e=0,(0,p.curBox)().hide()}));return i.show(),(0,I.setWorkerTimeout)((function(){e=0,i.hide()}),3e3),this.notify(b.events.ENDED),void this.notify(b.events.FAILED)}o.AudioUtils.isPodcast(this.getCurrentAudio())?(this.setIsPlaying(!1),this.notify(b.events.PAUSE),this.notify(b.events.ENDED),this.stop()):this._repeatCurrent?(this._autoNext=!0,this.notify(b.events.ENDED),this.notify(b.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),(0,I.setWorkerTimeout)((()=>{this._impl&&this._impl.clearAudioNode&&(this._impl.stop(),this._implSetUrl(this.getCurrentAudio())),this._implPlay()}))):(this.setIsPlaying(!1),this.notify(b.events.ENDED),this.playNext(!0))}},a={onPause:()=>{this.setIsPlaying(!1),this.notify(b.events.PAUSE),t=!1},onPlay:()=>{this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(b.events.PLAY),t=!1},onBufferUpdate:e=>{this.notify(b.events.BUFFERED,e)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(b.events.CAN_PLAY),onProgressUpdate:(e,i)=>{var a=this.getCurrentAudio();if(!this._muteProgressEvents&&a){var s=this._impl.getDuration()||a[o.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(b.events.PROGRESS,e,s,i),!vk.id&&s-i<Z.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*Z.UNAUTH_FADE_TIME))}},onFrequency:e=>{this.notify(b.events.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new w.AudioPlayerHTML5(a),this.implTaskManager=new U.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}fadeIn(e){void 0===e&&(e=300),this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(e){void 0===e&&(e=300),this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){if(this.getCurrentAudio())switch(e.keyCode){case 179:this.isPlaying()?this.pause():this.play();break;case 178:this.seek(0),this.pause();break;case 177:this.playPrev();break;case 176:this.playNext()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(var t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach((i=>{i.getId()===e.getId()&&i.getOwnerId()===e.getOwnerId()&&(i.hasMore()?i.mergeWith(t):i.mergeInfo(t))}))}deleteCurrentPlaylist(){this.getPlaylistQueue().removeSortedList(),delete this._currentAudio,delete this._currentPlaylist,this.notify(b.events.UPDATE),this.notify(b.events.PLAYLIST_CHANGED),this.stop(),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;var t=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()),i=[];if(t){var a=(0,P.geByClass)("_audio_row_"+t.fullId);i=i.concat([].slice.call(a))}var s=document.querySelectorAll(".AudioRadiostationItem"),l=(0,Q.isRadio)(t)&&this.isPlaying();Array.from(s).forEach((e=>{e.classList.toggle("AudioRadiostationItem--playing",l&&parseInt(e.dataset.id)===t.id)}));for(var r=0,_=this._currentPlayingRows.length;r<_;r++){var d=this._currentPlayingRows[r];d&&!(0,g.inArray)(d,i)&&this.toggleCurrentAudioRow(d,!1,e)}if(t)for(var n=0,u=i.length;n<u;n++){var c=i[n];if(c){if((0,P.gpeByClass)("article_editor_canvas",c))continue;this.toggleCurrentAudioRow(c,!0,e)}}this._currentPlayingRows=i,(0,g.each)((0,P.geByClass)("_audio_pl"),((e,t)=>(0,P.removeClass)(t,"audio_pl__playing")));var h=this.getCurrentPlaylist();if(this.isPlaying()&&h){var p=(0,P.geByClass)(`_audio_pl_${h.getOwnerId()}_${h.getPlaylistId()}`);p&&(0,g.each)(p,((e,t)=>(0,P.addClass)(t,"audio_pl__playing")))}}scrollToCurrentPlaying(e,t){var i=Z.getAudioElementsByAudioId(e);window.AudioPage&&i.forEach((e=>{var i=window.currentAudioPage(e);if(i&&i._scroll){var o=i.getCurrentSectionEl()||i.getPageContainer();Z.getAudioElementsByAudioId(t,o).length||i.drawMore(),i.scrollIntoView(Z.getAudioElementsByAudioId(t,o)[0],150)}}))}toggleCurrentAudioRow(e,t,i){var a=o.AudioUtils.getAudioFromEl(e,!0);(0,P.addClass)(e,o.AudioUtils.AUDIO_CURRENT_CLS),a.withInlinePlayer&&(0,P.toggleClass)(e,"audio_row__player_transition",i),(i=!!a.withInlinePlayer&&i)?setTimeout((()=>this._updateAudioEl(t,e,a,i)),0):this._updateAudioEl(t,e,a,i)}_updateAudioEl(e,t,i,a){var s=(0,P.geByClass1)("_audio_row__play_btn",t),l=(0,P.geByClass1)("_audio_row__title",t),_=(0,P.geByClass1)("_audio_row__duration",t),n=o.AudioUtils.getDurationMod(e?i.duration:i.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&((0,P.removeClass)(t,"audio_row__playing"),s&&(0,P.attr)(s,"aria-label",(0,r.getLang)("global_audio_play")),l&&(0,P.attr)(l,"role",""));var u=function(e,t){if(void 0===t&&(t=""),_){var i=o.AudioUtils.getDurationMod(e);_.innerHTML=t+(0,h.formatTime)(e),i!==n&&((0,P.replaceClass)(_,o.AudioUtils.AUDIO_DURATION_CLS+"-"+n,o.AudioUtils.AUDIO_DURATION_CLS+"-"+i),n=i)}};if(i.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[b.events.PLAY,b.events.PLAY_REQUESTED],(e=>{o.AudioUtils.audioTupleToAudioObject(e).fullId===i.fullId&&((0,P.addClass)(t,o.AudioUtils.AUDIO_PLAYING_CLS),s&&(0,P.attr)(s,"aria-label",(0,r.getLang)("global_audio_pause")),l&&(0,P.attr)(l,"role","heading"))})),this.on(t,b.events.PROGRESS,((e,t,o)=>{if(i.withInlinePlayer||!this.ads.isPlaying()){o=(0,g.intval)(o);var a=0,s="";Z.getDurationType()?(a=Math.round(o-t*o),s="-"):a=Math.round(t*o),u(a,s)}else u(i.duration)}));var c=(0,P.data)(t,"bars");if(!c&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(c=(0,P.se)('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?(0,P.geByClass1)("podcast_list_snippet__cover",t).appendChild(c):t.appendChild(c),c.width=o.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,d.isRetina)()?2:1),c.height=o.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,d.isRetina)()?2:1),c.style.width=o.AudioUtils.AUDIO_ROW_COVER_SIZE,c.style.height=o.AudioUtils.AUDIO_ROW_COVER_SIZE,(0,d.isRetina)())c.getContext("2d").scale(2,2);var p=getComputedStyle(c).color;this.on(t,b.events.FREQ_UPDATE,((e,t)=>ee(c,t,p))),ee(c,[0,0,0,0],p),(0,P.data)(t,"bars",c)}(0,P.toggleClass)(t,o.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),(0,P.removeClass)(t,o.AudioUtils.AUDIO_PLAYING_CLS),(0,P.removeClass)(t,o.AudioUtils.AUDIO_CURRENT_CLS),u(i.duration),s&&(0,P.attr)(s,"aria-label",(0,r.getLang)("global_audio_play")),l&&(0,P.attr)(l,"role","");var A=(0,P.data)(t,"bars");A&&((0,P.re)(A),(0,P.data)(t,"bars",null))}a?setTimeout((()=>{var e=o.AudioUtils.getAudioFromEl(t,!0);(0,P.toggleClass)(t,o.AudioUtils.AUDIO_CURRENT_CLS,!!e.isCurrent)}),0):(0,P.toggleClass)(t,o.AudioUtils.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){(0,P.removeClass)(e,o.AudioUtils.AUDIO_CURRENT_CLS);var t=(0,P.data)(e,"player_inited");if(t){setTimeout((()=>(0,P.re)((0,P.geByClass1)("_audio_inline_player",e))),200);var i=(0,P.geByClass1)("_audio_duration",e);i&&(i.innerHTML=(0,h.formatTime)(o.AudioUtils.getAudioFromEl(e,!0).duration)),this.off(e),(0,g.each)(t.sliders,((e,t)=>t.destroy())),(0,P.data)(e,"player_inited",!1);var a=(0,P.geByClass1)("has_audio_player",e);a&&(0,P.removeClass)(a,"has_audio_player")}}_addRowPlayer(e){if(!((0,P.geByClass1)("_audio_inline_player",e)||(0,P.hasClass)(e,"podcast_list_snippet")||(0,P.hasClass)(e,"podcast_snippet__controls")||(0,P.hasClass)(e,"PodcastWidget__player"))){var t=(0,P.se)(vk.audioInlinePlayerTpl||(0,g.getTemplate)("audio_inline_player")),i=(0,P.geByClass1)("_audio_player__place",e);i.appendChild(t),(0,P.addClass)(i,"has_audio_player");var a=new Slider((0,P.geByClass1)("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),s=new Slider((0,P.geByClass1)("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>(0,h.formatTime)(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{var i=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());i&&o.AudioUtils.isPodcast(i)&&this.podcastSetActionRef(i,o.AudioUtils.PodcastsLogs.ACTION_SEEK,"",t),this.seek(e)}});this.ads.isPlaying()&&s.toggleAdState(!0),vk.id||s.setBlocked(!0),this.on(e,b.events.AD_DEINITED,(()=>{})),this.on(e,b.events.AD_READY,(()=>{})),this.on(e,b.events.AD_STARTED,(()=>{s.toggleAdState(!0),s.setBackValue(0)})),this.on(e,b.events.AD_COMPLETED,(()=>s.toggleAdState(!1))),this.on(e,b.events.START_LOADING,(()=>s.toggleLoading(!0))),this.on(e,b.events.CAN_PLAY,(()=>s.toggleLoading(!1))),this.on(e,b.events.BUFFERED,((e,t)=>s.setBackValue(t))),this.on(e,b.events.PROGRESS,((e,t)=>{s.toggleLoading(!1),s.setValue(t)})),this.on(e,b.events.VOLUME,((e,t)=>{a.setValue(t,!0)})),(0,P.data)(e,"player_inited",{sliders:[a,s]})}}hasStatusExport(){for(var e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e,t){void 0===t&&(t=!1),this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){Z._lsSet(Z.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=(0,d.isObject)(e)||(0,d.isArray)(e)?o.AudioUtils.audioTupleToAudioObject(e).fullId:e,(0,g.each)(this._playlists,((t,i)=>i.removeAudio(e))),this.getPlaylistQueue().removeAudio(e),this.saveStateCurrentPlaylist()}updateAudio(e,t){var i="";return(0,d.isString)(e)?i=e:(0,d.isArray)(e)&&(i=o.AudioUtils.audioTupleToAudioObject(e).fullId),t||(t=e),(0,g.each)(this._playlists,((a,s)=>{for(var l=s.getAudiosList(),r=0,_=l.length;r<_;r++)o.AudioUtils.getAudioFullId(l[r])===i&&(l[r]=(0,x.mergeAudioTupleWithoutContext)(e,t))})),this._currentAudio&&o.AudioUtils.getAudioFullId(this._currentAudio)===i&&(this._currentAudio=(0,x.mergeAudioTupleWithoutContext)(e,t),this.notify(b.events.CURRENT_CHANGED)),this.notify(b.events.UPDATE),e}_triggerTNSPixel(){var e=Z._lsGet("tns_triggered_time_v3")||0,t=(0,d.vkNow)();t-e<864e5||(Z._lsSet("tns_triggered_time_v3",t),(0,d.vkImage)().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${(0,d.irand)(1,1e9)}`)}_restoreVolumeState(){Z.clearDeprecatedCacheKeys(),Z.clearOutdatedCacheKeys();var e=Z._lsGet(Z.LS_VOLUME);this._userVolume=null==e||!1===e?O.DEFAULT_VOLUME:e}restoreState(){if(!vk.widget&&(Z.clearDeprecatedCacheKeys(),Z.clearOutdatedCacheKeys(),!window.cur.audioPreventRestoreTrack)){this._currentAudio=Z._lsGet(Z.LS_TRACK);var e=Z._lsGet(Z.LS_PL);if(e){e=JSON.parse(e);var t=this.hasPlaylist(e.type,e.ownerId,e.albumId);e.type===y.AudioPlaylist.TYPE_RADIO&&t?this._currentPlaylist=t:(this._currentPlaylist=new y.AudioPlaylist(e),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this.getPlaylistQueue().setSortedQueue(this._currentPlaylist.getAudiosList()),this._initPlayingContext(this._currentPlaylist.getContext())}this._currentPlaylist&&this._currentAudio?this.notify(b.events.UPDATE):this._currentPlaylist=this._currentAudio=null;var i=0;if(o.AudioUtils.isPodcast(this._currentAudio)){var a=Z._podcastGetStates(),s=`${this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_ID]}`;i=((a[s]||{}).position||0)/this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_DURATION]}else i=Z._lsGet(Z.LS_PROGRESS)||0;this._currentAudio&&this._impl&&this._implSetUrl(this._currentAudio,!0).then((()=>{i&&i<1?this.implTaskManager.seek(i):this.implTaskManager.setVolume(0),this.notify(b.events.CURRENT_CHANGED)})).catch((()=>{this.deleteCurrentPlaylist(),this.notify(b.events.CURRENT_CHANGED)})),this._updatePlaybackRate()}}_implPlay(){var e=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());this.implTaskManager.play().then((()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!a.browser.safari,e.actionHash&&((0,M.connectListenQueue)(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:Z.getDeviceId()},{onFail:()=>!0})),o.AudioUtils.isPodcast(e)){var t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,o.AudioUtils.PodcastsLogs.ACTION_PLAY)}}))}_implSetUrl(e,t){this.implTaskManager.clearTask(U.TaskName.URL),t||this.notify(b.events.START_LOADING);var i=(0,D.audioTupleToAudioObject)(e);return this._ensureHasURL(i).then((e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch((()=>{this.implTaskManager.clearAllTasks(),this.notify(b.events.FAILED),this.isPlaying()&&(this.pause(),this.playNext(!0,!0))}));throw new Error}))}toggleDurationType(){var e=Z.LS_PREFIX+Z.LS_DURATION_TYPE,t=(0,g.intval)(ls.get(e));ls.set(e,!t),this.notify(b.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}_initEvents(){var e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",(()=>{(this.isPlaying()||this.ads.isPlaying())&&(this.pausedByAudio=Date.now(),this.pause()),delete this.pausedByVideo})),e.addRecvClbk("video_start","audio",(()=>{(this.isPlaying()||this.ads.isPlaying())&&(this.pause(),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","audio",(()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(),delete this.pausedByVideo)})),e.addRecvClbk("logged_off","audio",(()=>{cur.loggingOff=!0,Z.clearAllCacheKeys(),this.stop()})),e.addRecvClbk("stories_video_start","audio",(()=>{this.isPlaying()&&(this.pause(),this.pausedByStories=(0,d.vkNow)())})),e.addRecvClbk("stories_video_end","audio",(()=>{!this.isPlaying()&&this.pausedByStories&&((0,d.vkNow)()-this.pausedByStories<18e4&&this.play(),delete this.pausedByStories)}))),new V.RadiostationEventsHandling}addPlaylist(e){var t=this.hasPlaylist(e.getId());t?(t.mergeWith(e.asObject()),t.getType()===y.AudioPlaylist.TYPE_RADIO&&this._currentPlaylist===t&&this.getPlaylistQueue().setSortedQueue(t.getAudiosList())):this._playlists.push(e)}_cleanUpPlaylists(){for(var e=0,t=-1,i=this._playlists.length-1;i>=0;i--){var o=this._playlists[i];if(!o.isReference()&&(e+=o.getAudiosCount())>4e3){t=i;break}}if(-1!==t){t+=1;for(var a=this._playlists.slice(0,t),s=this.getCurrentPlaylist(),l=[],r=0;r<a.length;r++){var d=a[r];if(s===d&&(d=!1),d&&!d.isReference())for(var n=t;n<this._playlists.length;n++){var u=this._playlists[n];u.isReference()&&u.getSelf()===d&&(d=!1)}d&&l.push(r)}for(var c=0;c<l.length;c++){var h=l[c];this._playlists.splice(h,1)}l.length&&(0,_.debugLog)("AudioPlayer - "+l.length+" playlists removed")}}hasPlaylist(e,t,i,o){var a;if(o)return this._playlists.find((e=>e.getBlockId()===o||e.getAlbumId()===o))||!1;a=void 0!==t&&void 0!==i?`${e}_${t}_${i}`:e;for(var s=0;s<this._playlists.length;s++){var l=this._playlists[s];if(!l.isReference()&&l.getId()===a)return l}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter((t=>t.getType()===e))||null}getPlaylist(e,t,i,o,a){if(void 0===a&&(a=""),e&&!t&&!i){var s=y.AudioPlaylist.splitId(e);e=s[0],t=s[1],i=s[2]}var l=this.hasPlaylist(e,t,i,a);return l?(l.mergeWith({accessHash:o}),l):new y.AudioPlaylist({type:e,ownerId:t,albumId:i,hasMore:e!==y.AudioPlaylist.TYPE_TEMP,accessHash:o,blockId:a})}getPlaylistQueue(){return this._playlistQueue}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||o.AudioUtils.getAudioFullId(this._currentAudio)===o.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;var i="audio_row__added_next";if(!(0,P.hasClass)(e,i)){(0,P.addClass)(e,i);var a=this.getCurrentPlaylist(),s=this.getPlaylistQueue();if(a){var l=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(l&&t.fullId===l.fullId)return;var r=s.indexOfAudio(l);if(-1===r)return;this.notify(b.events.PLAY_NEXT,l.fullId,t.fullId);var _=this.getPlaylistQueue(),d=s.indexOfAudio(t);-1!==d?_.moveAudio(d,r+1):(_.addAudio((0,R.serializeAudio)(t),r+1),this.getCurrentPlaylist().pushAudio((0,R.serializeAudio)(t),r+1))}else{var n=o.AudioUtils.getContextPlaylist(e);this.play(t,n.playlist,n.context)}var u=window.AudioPage&&window.currentAudioPage(e);if(u){var c=u.getPageCurrentPlaylist();c&&u.onUserAction(t,c)}}}on(e,t,i){(0,d.isArray)(t)||(t=[t]);for(var o,a=function(){return i(...arguments)},s=q(t);!(o=s()).done;){var l=o.value;this.subscribers.push({context:e,et:l,cb:a})}return()=>{this.subscribers=this.subscribers.filter((e=>e.cb!==a))}}off(e){this.subscribers=this.subscribers.filter((t=>t.context!==e))}connectEvents(){var e=this;this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isPlaying()&&this._muteProgressEvents&&(0,g.inArray)(e,[b.events.BUFFERED,b.events.PROGRESS])),this.eventBus.onAnyCallBack=function(t){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return e.onEvent(t,...o)},this.subscribe(b.events.VOLUME,(()=>Z._lsSet(Z.LS_VOLUME,this._userVolume))),this.subscribe(b.events.PLAY_REQUESTED,(()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),Z._setTabIcon("play"),this._sendStatusExport()})),this.subscribe(b.events.PLAY,(()=>this.updateCurrentPlaying(!0))),this.subscribe(b.events.PLAYLIST_CHANGED,(()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()})),this.subscribe(b.events.PROGRESS,((e,t,i)=>{var a=this.getCurrentAudio(),s=this.getPlaylistQueue(),l=(0,D.audioTupleToAudioObject)(a);if(this._listenedTime=i,o.AudioUtils.isPodcast(l))e&&i&&this._podcastUpdateState(l,e,i,o.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isPlaying()){var r=this._impl.getCurrentProgress();vk.widget||Z._lsSet(Z.LS_PROGRESS,r),!vk.widget&&this._allowPrefetchNext&&r>=.8&&s.getNextAudio(a).then((e=>{e&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(e))}))}})),this.subscribe(b.events.PAUSE,(()=>{this.updateCurrentPlaying(!0);var e=this.getCurrentAudio(),t=(0,D.audioTupleToAudioObject)(e);o.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.AudioUtils.PodcastsLogs.ACTION_PAUSE),Z._setTabIcon("pause")})),this.subscribe(b.events.SEEK,(()=>{var e=this.getCurrentAudio(),t=(0,D.audioTupleToAudioObject)(e);o.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.AudioUtils.PodcastsLogs.ACTION_SEEK)})),this.subscribe(b.events.ENDED,(()=>{var e=this.getCurrentAudio(),t=(0,D.audioTupleToAudioObject)(e);o.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),o.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT),window.vk&&!window.vk.widget&&!window.vk.id&&(0,k.partConfigEnabled)("audio_unauth_preview_box")&&(this.stop(),W.Unauthorized.showMoreBox(null,0,N.UnauthorizedSourceType.AUDIO))})),this.subscribe(b.events.RADIOSTATION_FOLLOW,(e=>(0,X.updateFaveStatusAfterFollow)(e,!0))),this.subscribe(b.events.RADIOSTATION_UNFOLLOW,(e=>(0,X.updateFaveStatusAfterFollow)(e,!1)))}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,i,o){(0,g.inArray)(e,[b.events.PLAY,b.events.PLAY_REQUESTED,b.events.PAUSE])&&(this.subscribers=this.subscribers.filter((e=>!(e.context instanceof Element)||bodyNode.contains(e.context)))),(0,g.each)(this.subscribers||[],((a,s)=>{s.et===e&&s.cb(this.getCurrentAudio(),t,i,o)}))}notify(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];this.eventBus.emit(e,...i)}addWithReplacePlaylists(e){var t=e.reduce(((e,t)=>(e[t.getFullId()]=t,e)),{}),i={};this._playlists.forEach(((e,o)=>{var a=e.getFullId();t[a]&&(this._playlists[o]=t[a],i[a]=!0)})),t.forEach((e=>{i[e.getFullId()]||this._playlists.push(e)}))}_sendPlayerErrorStats(e){var t=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(t){var i=t.full_id,a=(0,g.extend)({audio:i,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",a)}}playLive(e,t){var i=this.getPlaylist(y.AudioPlaylist.TYPE_LIVE,vk.id,P.data[0]),o=this.getPlaylistQueue();i.mergeWith({live:e,hasMore:!1}),e=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},(0,g.extend)(t,{onDone:(e,t,a)=>{i.mergeWith({title:t&&t.title,list:[e]}),o.addAudio(e),this.play(e,i,a)},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",(e=>{if(e.key===Z.LS_PREFIX+Z.LS_STATUS_EXPORT){var t=Z._lsGet(Z.LS_STATUS_EXPORT);this.setStatusExportInfo(t),cur.audioPage&&cur.audioPage.updateStatusExportControls()}}))}_sendStatusExport(){var e=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(e){var t=this.statusSent?this.statusSent.split(","):[!1,0],i=(0,d.vkNow)()-(0,g.intval)(t[1]);if(this.hasStatusExport()&&!o.AudioUtils.isPodcast(e)&&(e.id!=t[0]||i>3e5)){var a=this.getCurrentPlaylist(),s=a?a.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:(0,g.intval)(s&&(s.top_audio||s.top))},{onFail:()=>!0}),0),this.statusSent=e.id+","+(0,d.vkNow)()}}}saveStateCurrentPlaylist(){var e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();if(!vk.widget&&e&&t){var i=this._getPreparePlayQueueForSaving(e,t);Z._lsSet(Z.LS_PL,i),Z._lsSet(Z.LS_SAVED,(0,d.vkNow)())}}_getPreparePlayQueueForSaving(e,t){var i=e.asObject(),a=this.getCurrentAudio(),s=Math.max(0,t.indexOfAudio(a)),l=G({},i,{list:(0,g.clone)(t.getQueue().slice(Math.max(0,s-100),s+300),!0)});return(0,g.each)(l.list,(function(e,t){(0,Q.isRadio)(t)||(t[o.AudioUtils.AUDIO_ITEM_INDEX_URL]="")})),JSON.stringify(l)}_saveStateCurrentAudio(){if(!vk.widget){var e=this.getCurrentAudio();if(e){var t=(0,g.clone)(e);(0,Q.isRadio)(e)||(t[o.AudioUtils.AUDIO_ITEM_INDEX_URL]=""),Z._lsSet(Z.LS_TRACK,t),(0,A.setCookie)("remixcurr_audio",`${e[o.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[o.AudioUtils.AUDIO_ITEM_INDEX_ID]}`,1)}else Z._lsSet(Z.LS_TRACK,null),(0,A.setCookie)("remixcurr_audio",null,1)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isPlaying())return!1;var i=(t=t||10)/o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()).duration,a=this.getCurrentProgress()+(e?i:-i);a=Math.max(0,Math.min(1,a)),this.seek(a)}setVolume(e,t){void 0===t&&(t=!1);var i=Math.min(1,Math.max(0,e));this._userVolume!==i&&(this._userVolume=i,this.notify(b.events.VOLUME,i)),this.implTaskManager.setVolume(i,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seek(e){this.implTaskManager.seek(e),this.notify(b.events.SEEK)}seekToTime(e,t){var i=this.getCurrentAudio();if(!i)return 0;var a=e/i[o.AudioUtils.AUDIO_ITEM_INDEX_DURATION];if(a=Math.max(0,a),a=Math.min(a,1),this.seek(a),o.AudioUtils.isPodcast(i)){var s="",l=o.AudioUtils.audioTupleToAudioObject(i);t&&(s=o.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(l,o.AudioUtils.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(l,a,0,s)}return a}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};var t=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);var i=this.getPlaylistQueue(),a=i.indexOfAudio(e);return a>=0?i.getAudioAt(a).then((e=>o.AudioUtils.audioTupleToAudioObject(e))):(this._currentUrlEnsure[e.fullId]||t.push(e.fullId+"_"+e.actionHash+"_"+e.urlHash),(()=>{var i;return!t.length&&this.currentEnsureUrlPromise?i=this.currentEnsureUrlPromise:(i=new Promise(((e,i)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=i,J().then((()=>this.fetchAudioUrls(t))).then((t=>{this.ensureUrlReject=null,e(t)})).catch((o=>{switch(o){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(t).then((e=>this.fetchAudioUrls(e))).then(e).catch((()=>!0));break;case"no_audios":this.ensureUrlReject=null,i()}return!0}))})),this.currentEnsureUrlPromise=i),i.then((t=>(Array.isArray(t)&&t.forEach((t=>{if(e.fullId===(0,B.getAudioFullId)(t)){var i=(0,D.audioTupleToAudioObject)(t);e.url=i.url,e.ads=i.ads,e.flags=i.flags,e.extra=i.extra}})),e)))})())}fetchAudioUrls(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,i,a)=>{this.setStatusExportInfo(i),a&&this._podcastSaveData(a),(0,g.each)(e,((e,t)=>{t=o.AudioUtils.audioTupleToAudioObject(t);var i={};i[o.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,i[o.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,i[o.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,i[o.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,i),this._currentAudio&&(0,B.getAudioFullId)(this._currentAudio)===t.fullId&&(this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[o.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]})),t(e)},onFail:e=>(i(e),!0)})}))}fetchAudios(e){return new Promise(((t,i)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{var o=[],a=this.getCurrentPlaylist().getAudiosList();if(Array.isArray(e)){for(var s=e.reduce(((e,t)=>(e[(0,B.getAudioFullId)(t)]=t,e)),{}),l=0;l<a.length;l++){var r=(0,B.getAudioFullId)(a[l]);if(s[r]){a[l]=s[r];var _=(0,D.audioTupleToAudioObject)(s[r]);o.push(`${_.fullId}_${_.actionHash}_${_.urlHash}`)}}t(o)}else i()}})}))}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!(0,k.partConfigEnabled)("audio_unauth_preview"))return Widgets.oauth(),!1;if((0,P.domClosest)("_audio_row__tt",t.target))return(0,c.cancelEvent)(t);var i=(0,P.domClosest)("_audio_row",e),a=o.AudioUtils.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){var s=window.getSelection().getRangeAt(0);if(s){var r=s.commonAncestorContainer;if(r&&(0,P.domClosest)("_audio_row",r)===i&&s.startOffset!==s.endOffset)return!1}}if(t&&(0,P.hasClass)(t.target,"mem_link"))return nav.go((0,P.attr)(t.target,"href"),t,{navigateToUploader:!0}),(0,c.cancelEvent)(t);if((0,P.hasClass)(t.target,"_audio_row__title_inner")){if(o.AudioUtils.isPodcast(a))return(0,l.showPodcast)(i,a.fullId),(0,c.cancelEvent)(t);if(a.lyrics&&!a.isInAttach&&!(0,k.partConfigEnabled)("audio_use_web_new_version_lyrics"))return o.AudioUtils.toggleAudioLyrics(i,a),(0,c.cancelEvent)(t);if(a.hasTrackPage&&!a.isClaimed)return;(0,c.cancelEvent)(t)}if((0,P.hasClass)(t.target.parentNode,"audio_row__performers")){if((0,c.checkEvent)(t)||vk.widget)return!0;if(!(0,P.gpeByClass)("_ape_audio_item",t.target)){var _=(0,P.domData)(t.target,"performer");if(_)return o.AudioUtils.audioSearchPerformer(t.target,_,t),(0,c.cancelEvent)(t)}return!0}var d=cur.cancelClick||t&&((0,P.hasClass)(t.target,"audio_lyrics")||(0,P.domClosest)("_audio_duration_wrap",t.target)||(0,P.domClosest)("_audio_inline_player",t.target)||(0,P.domClosest)("audio_performer",t.target)),n=(0,P.hasClass)(t.target,"slider")||(0,P.domClosest)("slider",t.target),u=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===(0,P.geByClass1)("audio_inline_player_progress",i)||cur._sliderMouseUpNowEl===(0,P.geByClass1)("audio_inline_player_volume",i));if((n||u)&&(d=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,d)return!0;if(o.AudioUtils.isClaimedAudio(a)||a.isReplaceable){var h=o.AudioUtils.getAudioExtra(a).claim;if(h)return void((0,P.hasClass)(i,"no_actions")||a.isInEditBox||showAudioClaimWarning(a,h,o.AudioUtils.replaceWithOriginal.bind(o.AudioUtils,i,a)))}if(this.podcastSetActionRef(a,a.isPlaying?o.AudioUtils.PodcastsLogs.ACTION_PAUSE:o.AudioUtils.PodcastsLogs.ACTION_PLAY,"",i),a.isPlaying)this.pause();else{var p=o.AudioUtils.getContextPlaylist(i);if(this.getPlaylistQueue().isShuffled()&&window.AudioPage){var A=window.currentAudioPage(e),g=A&&A.getCurrentSection();(!A||!(g&&"current"===g&&"placeholder_audios_wrapper"===p.context))&&this.getPlaylistQueue().resetShuffle()}this.play(a.fullId,p.playlist,a.context||p.context),cur.audioPage&&cur.audioPage.onUserAction(a,p.playlist)}o.AudioUtils.onRowOver(i,!1,!0)}playNextPlaylist(e,t,i){var o=this.getPlaylist(y.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{var e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();e?(e.pushAudio(o.getAudiosList()),t.addPlaylist(o)):(t.addPlaylist(o),this._currentPlaylist=new y.AudioPlaylist(o),t.getAudioAt(0).then((e=>{e&&(this._currentAudio=e,this.notify(b.events.UPDATE),this.notify(b.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.play(e.fullId,o))}))),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}))}setNextPlaylist(e,t,i){var o=this.getPlaylist(y.AudioPlaylist.TYPE_PLAYLIST,e,t,i);o.loadAll((()=>{var e,t=this.getCurrentPlaylist(),i=this.getPlaylistQueue(),a=o.getAudiosList(),s=this._currentAudio?i.indexOfAudio(this._currentAudio):-1,l=this._currentAudio&&null!=(e=null==t?void 0:t.indexOfAudio(this._currentAudio))?e:-1;i.addAudio(a,s+1),t?t.pushAudio(a,l+1):(this._currentPlaylist=new y.AudioPlaylist(o),i.getAudioAt(0).then((e=>{if(e&&(this._currentAudio=e,this.notify(b.events.UPDATE),this.notify(b.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),!this.isPlaying())){var t=e[0],i=`${e[1]}_${t}`;this.play(i,this._currentPlaylist)}})))}))}playPlaylist(e,t,i,o,a){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,k.partConfigEnabled)("audio_unauth_preview"))return Widgets.oauth(),!1;this.playNextInPlaylist(e,t,i,o,{shuffled:a,preDoPlay:e=>{a&&(e.isShuffled()&&e.resetShuffle(),e.shuffle(!0,!0),cur.audioPage&&cur.audioPage.updateShuffleButton())}})}playBlock(e,t,i,o,a,s){void 0===s&&(s="default"),this.playNextInPlaylist(e,t,i,o,{type:a,trackType:s,shuffled:!1})}playNextInPlaylist(e,t,i,o,a){void 0===a&&(a={});var s=this.getCurrentPlaylist(),l=this.getPlaylist(a.type||y.AudioPlaylist.TYPE_PLAYLIST,e,t,i),r=this.getPlaylistQueue();if(l.setContext(o),s&&s.getId()===l.getId()&&this.isPlaying()&&!a.shuffled)this.pause();else{var _=!1,d=()=>{_||(r.setSortedQueue(l.getAudiosList()),_=!0,a.shuffled&&(this._currentPlaylist=l),a.preDoPlay&&a.preDoPlay(r),r.getNextAudio(null,!0).then((e=>{e&&this.play(e,l,o)})))};if(l.getAudiosCount()&&!a.shuffled&&!l.isExpired())return void d();this._impl&&this._impl.preparePlay&&!this.ads.isPlaying()&&this._impl.preparePlay(),l.load(0,d,null,a.trackType)}}_initPlayingContext(e){this._playingContext=e}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}play(e,t,i,a,s){if(!cur.loggingOff&&this._impl){var l;this._seq=a,this._autoNext=s,this._prevAudio=this._currentAudio,((0,d.isObject)(e)||(0,d.isArray)(e))&&(l=e,(e=o.AudioUtils.audioTupleToAudioObject(e))&&(e=e.fullId));var r=this.getPlaylistQueue(),n=o.AudioUtils.audioTupleToAudioObject(this._currentAudio),u=this.getCurrentPlaylist();!e&&n&&(e=n.fullId);var c=!1,h=e&&n&&e==n.fullId;if(t?u&&(c=h?t.getFullId()===u.getSelf().getFullId():t===u.getSelf()||t===u):(t=u,c=!0),c||i||(0,_.debugLog)("New playlist play init without context"),i&&(this._prevContext=this._playingContext,this._initPlayingContext(i)),!c){this._cleanUpPlaylists(),this._currentPlaylist&&(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio),this._currentPlaylist=new y.AudioPlaylist(t);var p=this.getCurrentPlaylist().getAudiosList();p.length&&r.setSortedQueue(p),this.notify(b.events.PLAYLIST_CHANGED)}if(!(r.indexOfAudio(e)>=0)){var A=t.getAudio(e);!A&&l&&(A=l),r.addAudio(A)}r.getAudio(e).then((i=>{h||(i&&t&&r.addPlaylist(t),t&&t.getType()===y.AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(i)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),n&&o.AudioUtils.isPodcast(n)&&this.isPlaying()&&this._podcastUpdateState(n,this.getCurrentProgress(),this._impl.getPlayedTime(),o.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isPlaying()||this.ads.deinit()),Z._sendLCNotification(),h?this.ads.isPlaying()?this.ads.resume():this.isPlaying()||(this.setIsPlaying(!0),this.implTaskManager.clearAllTasks(),this._implSetUrl(n).then((()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),o.AudioUtils.isPodcast(i)&&this._podcastUpdateState(o.AudioUtils.audioTupleToAudioObject(i),this.getCurrentProgress(),this._impl.getPlayedTime())})).catch((()=>{}))):e&&i&&(!s&&n&&this._impl.setUrl(O.SILENCE),this._currentAudio=i,this.setIsPlaying(!0),this.ads.isPlaying()?this.ads.resume():(this.notify(b.events.PLAY_REQUESTED,!0,(0,g.intval)(a),s),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(o.AudioUtils.audioTupleToAudioObject(i),(()=>this.playAfterAd())),this.notify(b.events.PROGRESS,0)),this.updateCurrentPlaying(!0),n&&this.scrollToCurrentPlaying(n.fullId,e))}))}}playAfterAd(){this.notify(b.events.CURRENT_CHANGED);var e=this.getCurrentAudio();e&&(this.notify(b.events.UPDATE),this._implSetUrl(e).then((()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*Z.UNAUTH_FADE_TIME),this._triggerTNSPixel()})).catch((()=>(this.pause(),!0))))}instantPlay(e,t,i){var o=!a.browser.safari&&t&&t.shiftKey;this.playPlaylist(vk.id,y.AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",o),(0,u.statlogsValueEvent)("client_header_play_button",o?"shuffle":"play"),setTimeout((()=>{(0,P.addClass)(e,"loading")}),400)}_prefetchAudio(e){(e=o.AudioUtils.audioTupleToAudioObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){return this._currentPlaylist}getPlaylists(){return(0,g.clone)(this._playlists)}pause(){this.ads.isPlaying()&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause()}stop(){this.setIsPlaying(!1),this.ads.isPlaying()?this.ads.stop():this._impl.stop(),this.notify(b.events.STOP)}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e}getCurrentAudio(){return this._currentAudio}playNext(e){this._playNext(1,e)}playPrev(){this._playNext(-1)}_playNext(e,t){if(!this.ads.isPlaying()){var i=this.getCurrentAudio(),a=this.getCurrentPlaylist(),s=this.getPlaylistQueue(),l=(e,i)=>{o.AudioUtils.isClaimedAudio(e)||this.play(e,a,!1,i,t)};if(i&&a)if(e>0){var r=s.indexOfAudio(i)+1,_=r+10;s.getAudios(r,_).then((e=>{var t=null;if(e){t=e[0];for(var r=0;r<=10&&t&&o.AudioUtils.isClaimedAudio(t);)t=e[r],r++}if(t)l(t,1);else if(a.isLive())this._muteProgressEvents=!0,a.fetchNextLiveAudio((e=>{if(e){var t=this.getPlaylistQueue(),i=t.indexOfAudio(e);i>=0?t.moveAudio(i,t.getAudiosCount()-1):t.addAudio(e)}l(e)}));else{s.getAudios(0,30).then((e=>{if(e){if(t=e.find((e=>!o.AudioUtils.isClaimedAudio(e))),!this.isRepeatAll())if(s.indexOfAudio(i)+1===s.getAudiosCount())return this.implTaskManager.seekImmediate(0),this.stop(),void(o.AudioUtils.isClaimedAudio(t)||(this._currentAudio=t,this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(b.events.CURRENT_CHANGED),this.notify(b.events.UPDATE)));l(t,1)}}))}}))}else{var d=s.indexOfAudio(this._currentAudio);if(d<1||this._impl.getCurrentTime()>5)this.seek(0);else{var n=d-1,u=n-10;s.getAudios(u,n).then((e=>{var t=null;if(e)for(t=e[n=e.length-1];n>=0&&t&&o.AudioUtils.isClaimedAudio(t);)t=e[--n];t?l(t,-1):this.seek(0)}))}}}}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,i,o,a){var s=Z._podcastGetStates(),l=Math.round(e.duration*t);s[e.fullId]={t:(0,d.vkNow)(),position:l},Z._podcastSetStates(s),o&&this._podcastSendLogs(o,e,i,l,a)}_podcastSendLogs(e,t,i,a,s){if(t&&e&&o.AudioUtils.isPodcast(t)&&(!cur._podcastsActionId||!cur._podcastsActionId[e]||this._podcastsActionLastId[e]!==cur._podcastsActionId[e])){var l=this._podcastsActionRef[t.fullId]||{},r=l[e]||{};o.AudioUtils.PodcastsLogs.log(e,(0,g.extend)({audio:t,position:a,listen:i},r,s||{})),delete l[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}}podcastSetActionRef(e,t,i,a){e=o.AudioUtils.audioTupleToAudioObject(e),t&&o.AudioUtils.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:i,refEl:a},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=(0,d.irand)(0,1e6))}toggleRadio(e,t){var i=this.getPlaylist(y.AudioPlaylist.TYPE_RADIO,t,y.AudioPlaylist.RADIO_PLAYLIST_ID),o=i.getAudiosList().find((t=>t[H.EAudioTupleIndex.ID]===e));o&&(this.isPlaying()&&(0,Q.isRadio)(this._currentAudio)&&o[H.EAudioTupleIndex.ID]===this._currentAudio[H.EAudioTupleIndex.ID]?this.pause():this.play(o,i))}_podcastCleanStates(){var e=Z._podcastGetStates(),t=!1;return(0,g.each)(e,((i,o)=>{Date.now()-o.t>2419200&&(delete e[i],t=!0)})),t&&Z._podcastSetStates(e),e}_podcastSaveData(e){var t=Z._podcastGetStates();(0,g.each)(e,((e,i)=>{var o=i.state;if(o){var a=+o[1];(!t[e]||!t[e][1]||a&&a>t[e][1])&&(t[e]={position:+o[0],t:Date.now()})}})),Z._podcastSetStates(t)}_podcastRestoreState(){var e=o.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!o.AudioUtils.isPodcast(e))return 0;var t=0;cur.podcastSeekToTime?(t=this.seekToTime(cur.podcastSeekToTime,cur.podcastSeekToTimeRef),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef):(t=((Z._podcastGetStates()[e.fullId]||{}).position||0)/e.duration)&&t<1&&this.implTaskManager.seek(t);return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!o.AudioUtils.isPodcast(this._currentAudio)&&o.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){var e=o.AudioUtils.isPodcast(this._currentAudio)||o.AudioUtils.isArticleTts(this._currentAudio),t=!this.ads.isPlaying()&&e?Z.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(e){var t=Z._lsGet(Z.LS_PODCASTS)||z,i=t.rate||1;e?i-=Z.PLAYBACK_RATE_STEP:i+=Z.PLAYBACK_RATE_STEP,!e&&i>Z.PLAYBACK_RATE_MAX?i=1:e&&i<1&&(i=Z.PLAYBACK_RATE_MAX),t.rate=i,Z._lsSet(Z.LS_PODCASTS,t),z=t,this._updatePlaybackRate()}playAudio(e){var t=new y.AudioPlaylist(y.AudioPlaylist.TYPE_TEMP);t.mergeWith({list:[e]}),this.play(e,t)}}function ee(e,t,i){var o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),o.fillStyle=i;for(var a=0;a<4;a++){var s=2+12*t[a];o.fillRect(13+4*a,12-s+14,2,s)}}Z.UNAUTH_FADE_TIME=.8,Z.LS_VER="v20",Z.LS_KEY_PREFIX="audio",Z.LS_PREFIX=Z.LS_KEY_PREFIX+"_"+Z.LS_VER+"_",Z.LS_STATUS_EXPORT=Z.LS_KEY_PREFIX+"_status_export",Z.LS_VOLUME="vol",Z.LS_PL="pl",Z.LS_TRACK="track",Z.LS_SAVED="saved",Z.LS_PROGRESS="progress",Z.LS_PODCASTS="podcasts",Z.LS_DURATION_TYPE="dur_type",Z.LS_UUID="uuid",Z.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",Z.PLAYBACK_RATE_STEP=.5,Z.PLAYBACK_RATE_MAX=a.browser.safari?2:3,Z.tabIcons={def:"/images/icons/favicons/fav_logo.ico",play:"/images/icons/favicons/fav_play.ico",pause:"/images/icons/favicons/fav_pause.ico"}},848001:(e,t,i)=>{"use strict";i.d(t,{init:()=>d});var o=i(397807),a=i(45634),s=i(461292),l=i(67766),r=i(913151),_=i(669729);function d(){window.AudioLayer=o.default,window.AudioUtils=a.AudioUtils,window.TopAudioPlayer=s.TopAudioPlayer,window.AudioPlaylist=l.AudioPlaylist,window.AudioPlayer=r.AudioPlayer,window.AudioPlayerUI=_.AudioPlayerUI}},285132:(e,t,i)=>{"use strict";i.d(t,{followOwner:()=>s});var o=i(937884),a=i(850167);function s(e,t){window.ajax.post("/al_audio.php?act=follow_owner",{owner_id:e,hash:t},{onDone:function(){(0,a.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_FOLLOW)}})}},291976:(e,t,i)=>{"use strict";i.d(t,{unfollowOwner:()=>s});var o=i(937884),a=i(850167);function s(e,t){window.ajax.post("/al_audio.php?act=unfollow_owner",{owner_id:e,hash:t},{onDone:function(){(0,a.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_UNFOLLOW)}})}},746785:(e,t,i)=>{"use strict";i.d(t,{RadiostationEventsHandling:()=>r});var o=i(182804),a=i(850167),s=i(719927),l=i(333097),r=function(){function e(){try{this.tq=(0,o.tq)()}catch(e){return}this.connectFollowingEvents(),this.connectUnFollowingEvents(),this.connectPlayToggleEvent()}return e.prototype.connectFollowingEvents=function(){this.tq.setInteractiveHandler("Music/follow_radiostation",(function(e){var t=e.payload;t.dataAttrs&&t.dataAttrs.stationId&&t.dataAttrs.hash&&(0,s.followRadiostation)(parseInt(t.dataAttrs.stationId,10),t.dataAttrs.hash).then((function(){t.target instanceof HTMLElement&&(t.target.dataset.taskClick="Music/unfollow_radiostation")}))}))},e.prototype.connectUnFollowingEvents=function(){this.tq.setInteractiveHandler("Music/unfollow_radiostation",(function(e){var t=e.payload;t.dataAttrs&&t.dataAttrs.stationId&&t.dataAttrs.hash&&(0,l.unfollowRadiostation)(parseInt(t.dataAttrs.stationId,10),t.dataAttrs.hash).then((function(){t.target instanceof HTMLElement&&(t.target.dataset.taskClick="Music/follow_radiostation")}))}))},e.prototype.connectPlayToggleEvent=function(){this.tq.setInteractiveHandler("Music/toggle_radio_play",(function(e){var t=e.payload;if(t.dataAttrs){var i=t.dataAttrs,o=i.stationId,s=i.playlistOwnerId;if(!o||!s)return;var l=(0,a.getAudioPlayer)();l&&l.toggleRadio(parseInt(o,10),parseInt(s,10))}}))},e}()},719927:(e,t,i)=>{"use strict";i.d(t,{followRadiostation:()=>_});var o=i(414325),a=i(850167),s=i(937884),l=i(486125),r=i(786067);function _(e,t){return(new o.FetchService).followRadiostation(e,t).then((function(t){if(t){var i=(0,a.getAudioPlayer)();i&&i.notify(s.events.RADIOSTATION_FOLLOW,e),(0,l.showDoneBoxFull)("",{},{title:(0,r.getLang)("audio_follow_radiostation_success_notification_title"),text:(0,r.getLang)("audio_follow_radiostation_success_notification_text")})}}))}},333097:(e,t,i)=>{"use strict";i.d(t,{unfollowRadiostation:()=>l});var o=i(414325),a=i(850167),s=i(937884);function l(e,t){return(new o.FetchService).unfollowRadiostation(e,t).then((function(t){if(t){var i=(0,a.getAudioPlayer)();i&&i.notify(s.events.RADIOSTATION_UNFOLLOW,e)}}))}},924583:(e,t,i)=>{"use strict";i.d(t,{updateFaveStatusAfterFollow:()=>d});var o=i(166773),a=i(722904),s=i(67766),l=i(78838),r=i(896438),_=i(850167);function d(e,t){var i=(0,_.getAudioPlayer)();i.getPlaylistsByType(s.AudioPlaylist.TYPE_RADIO).forEach((function(i){i.getAudiosList().forEach((function(i){i[a.EAudioTupleIndex.ID]===e&&n(i,t)}))})),Array.from(document.querySelectorAll(".audio_player_radio_station._audio_page_player")).forEach((function(i){var o=(0,l.getAudioFromEl)(i);o&&o[a.EAudioTupleIndex.ID]===e&&(n(o,t),i.dataset.audio=JSON.stringify(o))}));var r=i.getCurrentPlaylist();r&&r.getType()===s.AudioPlaylist.TYPE_RADIO&&i.saveStateCurrentPlaylist();var d=i.getCurrentAudio();(0,o.isRadio)(d)&&(n(d,t),i._saveStateCurrentAudio())}function n(e,t){var i=(0,r.getAudioExtra)(e);i&&i.fave!==t&&(i.fave=t,e[a.EAudioTupleIndex.EXTRA]=i)}},442246:(e,t,i)=>{"use strict";i.d(t,{WebAudioPlayerAdapter:()=>r});var o=i(189158),a=i(67766),s=i(65751),l=i(35764),r=function(){function e(e){this.webAudioPlayer=e,this.ads=e.ads}return e.prototype.playAudio=function(e,t,i,s){var r=new o.WebPlayerAdapter(this.webAudioPlayer).getPlaylistId(),_=s?this.webAudioPlayer.getPlaylist(s.type,s.ownerId,s.albumId):r?this.webAudioPlayer.getCurrentPlaylist():this.webAudioPlayer.getPlaylist(a.AudioPlaylist.TYPE_TEMP,window.vk.id),d=(0,l.apiAudioToAudioTuple)(e),n=null==t?void 0:t.map(l.apiAudioToAudioTuple);this.webAudioPlayer.getPlaylistQueue().setSortedQueue(n),this.webAudioPlayer.play(d,_,i)},e.prototype.playPlaylist=function(e,t){this.webAudioPlayer.playPlaylist(e.owner_id,e.id,e.access_key,t)},e.prototype.playPreviousAudio=function(){this.webAudioPlayer.playPrev()},e.prototype.playNextAudio=function(){this.webAudioPlayer.playNext()},e.prototype.pause=function(){this.webAudioPlayer.pause()},e.prototype.stop=function(){this.webAudioPlayer.stop()},e.prototype.setVolume=function(e){this.webAudioPlayer.setVolume(e)},e.prototype.setCurrentAudioProgress=function(e){this.webAudioPlayer.seek(e)},e.prototype.getCurrentAudio=function(){return(0,s.audioTupleToApiAudio)(this.webAudioPlayer.getCurrentAudio())},e.prototype.getCurrentAudioProgress=function(){return this.webAudioPlayer.getCurrentProgress()},e.prototype.getCurrentAudioVolume=function(){return this.webAudioPlayer.getVolume()},e.prototype.getCurrentPlaylist=function(){var e,t=this.webAudioPlayer.getCurrentPlaylist();if(!t)return null;var i=t.getPlaylistId(),o=t.getOwnerId();if("string"==typeof i)return null;var a=t.getCoverUrl(),s=a?{width:300,height:300,photo_300:a,sizes:[{width:300,height:300,src:a,type:"z"}]}:void 0,l={access_key:t.getAccessHash(),title:t.getTitle(),subtitle:t.getSubtitle(),count:t.getTotalCount(),plays:t.getListens(),update_time:t.getLastUpdated(),is_following:t.isFollowed(),album_type:t.getType(),description:t.getDescription(),photo:s,thumbs:s?[s]:void 0};return(null===(e=null==t?void 0:t.isFollowed)||void 0===e?void 0:e.call(t))?l.original={owner_id:o,playlist_id:i,access_key:t.getAccessHash()}:(l.owner_id=o,l.id=i),l},e.prototype.subscribe=function(e,t,i){return this.webAudioPlayer.on(i,e,t)},e.prototype.unsubscribe=function(e,t,i){if(void 0!==i)return this.webAudioPlayer.off(i)},e.prototype.isPlaying=function(){return this.webAudioPlayer.isPlaying()},e}()},511867:(e,t,i)=>{"use strict";i.d(t,{WebQueueListener:()=>a});var o=i(570655),a=function(e){function t(t){return e.call(this,t)||this}return(0,o.__extends)(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},(function(e,i){return t.queueHandler(i)})))},t}(i(772703).QueueListener)},735179:(e,t,i)=>{"use strict";i.d(t,{voiceMessagePlayerLoader:()=>o,speechLoader:()=>a});var o=function(){return window.AudioMessagePlayer&&window.AudioMessagePlayer.loaded?Promise.resolve(window.AudioMessagePlayer):Promise.all([i.e(76429),i.e(68592),i.e(9375)]).then(i.bind(i,352547)).then((function(){return window.AudioMessagePlayer}))},a=function(){return Promise.all([i.e(76429),i.e(28762)]).then(i.bind(i,991682))}},669729:(e,t,i)=>{"use strict";i.d(t,{AudioPlayerUI:()=>a});var o=i(817608),a=function(e){var t=e.audioPlayer;this.lyrics=new o.AudioPlayerLyricsUI({audioPlayer:t})}},691180:(e,t,i)=>{"use strict";i.d(t,{AudioLyricsModalController:()=>l});var o=i(570655),a=i(667294),s=i(481117),l=function(){function e(e){var t=this,i=e.audioPlayer;this.unmountFn=null,this.unmount=function(){t.unmountFn&&t.unmountFn(),t.unmountFn=null},this.handleClosed=function(){t.unmount()},this.audioPlayer=i}return e.prototype.load=function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.loadApplication()];case 1:return e.sent(),[2]}}))}))},e.prototype.open=function(e){this.mount(e)},e.prototype.destroy=function(){this.unmount()},e.prototype.mount=function(e){var t=e.audio,i=e.playlist,l=e.context;return(0,o.__awaiter)(this,void 0,void 0,(function(){var e;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return this.unmountFn?[2]:[4,this.loadApplication()];case 1:return e=o.sent(),(0,s.showComponentInBox)((0,a.createElement)(e,{audio:t,playlist:i,context:l,audioPlayer:this.audioPlayer,onClosed:this.handleClosed}),{onDestroy:this.unmount,width:490}),this.unmountFn=function(){(0,s.destroyComponentInBox)()},[2]}}))}))},e.prototype.loadApplication=function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,Promise.all([i.e(98066),i.e(38288),i.e(96816)]).then(i.bind(i,141337))];case 1:return[2,e.sent().AudioLyricsModalApplication]}}))}))},e}()},379146:(e,t,i)=>{"use strict";i.d(t,{AudioLyricsOnboardingController:()=>r});var o=i(182804),a=i(624715),s=i(937884),l=i(506404),r=function(){function e(e){var t=e.audioPlayer;this.unlistenAudio=null,this.registered=!1,this.audioPlayer=t,this.setStartupHandlers()}return e.prototype.destroy=function(){this.closeTooltip()},e.prototype.setStartupHandlers=function(){var e=this;try{(0,o.tq)().setStartupHandler("Audio/Player/LyricsButton/OnboardinHint",(function(t){if(!e.registered){var i=t.payload,o=i.target,a=i.data;if(!o)throw new Error("Target is not defined");var s=(0,l.helpHintTooltip)(o,{content:a.content,helpHintHash:a.hash,helpHintId:a.id},{width:"215px",offset:[0,8],forceSide:"bottom",align:"right",appendToParent:!0,withCloseButton:!0,autoAdjustToViewport:!0,noAutoHideOnWindowClick:!0}).tooltip;e.tooltip=s,e.listenAudio()}}))}catch(e){console.error(e)}},e.prototype.listenAudio=function(){var e=this;if(!this.unlistenAudio){var t=this.audioPlayer,i=function(t){return!!t&&(!!(0,a.audioTupleToAudioObject)(t).hasLyrics&&(e.openTooltip(),e.unlistenAudio&&(e.unlistenAudio(),e.unlistenAudio=null),!0))};i(t.getCurrentAudio())||(this.unlistenAudio=t.on(null,s.AudioPlayerEventType.CURRENT_CHANGED,i))}},e.prototype.openTooltip=function(){var e=this.tooltip;e&&e.show()},e.prototype.closeTooltip=function(){var e=this.tooltip;e&&e.hide()},e}()},817608:(e,t,i)=>{"use strict";i.d(t,{AudioPlayerLyricsUI:()=>l});var o=i(19331),a=i(691180),s=i(379146),l=function(){function e(e){var t=e.audioPlayer;this.audioPlayer=t,this.modal=new a.AudioLyricsModalController({audioPlayer:t}),this.onboarding=new s.AudioLyricsOnboardingController({audioPlayer:t})}return e.prototype.open=function(e){this.enabled&&(this.audioPlayer.lyrics.fetch(e.audio),this.modal.open(e))},Object.defineProperty(e.prototype,"enabled",{get:function(){return(0,o.partConfigEnabled)("audio_use_web_new_version_lyrics")},enumerable:!1,configurable:!0}),e}()},842776:(e,t,i)=>{"use strict";i.d(t,{WebMediaSessionAdapter:()=>o});var o=function(){function e(e){this.player=e,this.player.eventBus&&(this.subscriptions=this.player.eventBus.subscriptions),this.ads=this.player.ads}return e.prototype.play=function(){return this.player.play()},e.prototype.pause=function(){return this.player.pause()},e.prototype.isPlaying=function(){var e=this.player.getCurrentPlaylist();return!!(null==e?void 0:e.isLive)&&e.isLive()||!1},e.prototype.getAudioAt=function(e){return this.player.getPlaylistQueue?this.player.getPlaylistQueue().getAudioAt(e):Promise.resolve(null)},e.prototype.getAudios=function(e,t){return this.player.getPlaylistQueue?this.player.getPlaylistQueue().getAudios(e,t):Promise.resolve(null)},e.prototype.next=function(){return this.player.playNext()},e.prototype.prev=function(){return this.player.playPrev()},e.prototype.seek=function(e){return this.player.seek(e)},e.prototype.getCurrentPlaylist=function(){return this.player.getCurrentPlaylist()},e.prototype.getCurrentPlaylistId=function(){return""},e.prototype.subscribe=function(e,t){var i;return null===(i=this.player.eventBus)||void 0===i?void 0:i.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){var i;return null===(i=this.player.eventBus)||void 0===i?void 0:i.unsubscribe(e,t)},e.prototype.getCurrentAudio=function(){return this.player.getCurrentAudio()},e.prototype.getCurrentProgress=function(){return 0},e}()}}]);try{stManager.done("dist/audioplayer.0851881a4eef18ffc449.js")}catch(e){}