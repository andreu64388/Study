(self.webpackChunkvk=self.webpackChunkvk||[]).push([[22061],{686478:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});const i=(0,r(379333).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" fill="currentColor" /></g></symbol>',24,24,!1,void 0)},891047:(e,t,r)=>{"use strict";function i(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function n(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=i(r);return(e,r)=>n.then((i=>r(i.transaction(t,e).objectStore(t))))}let s;function a(){return s||(s=n("keyval-store","keyval")),s}function o(e,t=a()){return t("readonly",(t=>i(t.get(e))))}function c(e,t,r=a()){return r("readwrite",(r=>(r.put(t,e),i(r.transaction))))}function u(e,t=a()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function l(e=a()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}r.d(t,{clear:()=>l,createStore:()=>n,del:()=>u,get:()=>o,set:()=>c})},748759:(e,t,r)=>{"use strict";r.d(t,{InView:()=>f,useInView:()=>v});var i=r(667294),n=r(702177);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},a.apply(this,arguments)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=new Map,u=new Map,l=new Map,d=0;function _(e,t,r){void 0===r&&(r={}),r.threshold||(r.threshold=0);var i=r,s=i.root,a=i.rootMargin,o=i.threshold;if(c.has(e)&&(0,n.default)(!1),e){var _=function(e){return e?l.has(e)?l.get(e):(d+=1,l.set(e,d.toString()),l.get(e)+"_"):""}(s)+(a?o.toString()+"_"+a:o.toString()),g=u.get(_);g||(g=new IntersectionObserver(h,r),_&&u.set(_,g));var f={callback:t,element:e,inView:!1,observerId:_,observer:g,thresholds:g.thresholds||(Array.isArray(o)?o:[o])};return c.set(e,f),g.observe(e),f}}function g(e){if(e){var t=c.get(e);if(t){var r=t.observerId,i=t.observer,n=i.root;i.unobserve(e);var s=!1,a=!1;r&&c.forEach((function(t,i){i!==e&&(t.observerId===r&&(s=!0,a=!0),t.observer.root===n&&(a=!0))})),!a&&n&&l.delete(n),i&&!s&&i.disconnect(),c.delete(e)}}}function h(e){e.forEach((function(e){var t=e.isIntersecting,r=e.intersectionRatio,i=e.target,n=c.get(i);if(n&&r>=0){var s=n.thresholds.some((function(e){return n.inView?r>e:r>=e}));void 0!==t&&(s=s&&t),n.inView=s,n.callback(s,e)}}))}var f=function(e){var t,r;function c(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return s(o(t=e.call.apply(e,[this].concat(i))||this),"state",{inView:!1,entry:void 0}),s(o(t),"node",null),s(o(t),"handleNode",(function(e){t.node&&(g(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),s(o(t),"handleChange",(function(e,r){(e!==t.state.inView||e)&&t.setState({inView:e,entry:r}),t.props.onChange&&t.props.onChange(e,r)})),t}r=e,(t=c).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var u=c.prototype;return u.componentDidMount=function(){this.node||(0,n.default)(!1)},u.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(g(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(g(this.node),this.node=null)},u.componentWillUnmount=function(){this.node&&(g(this.node),this.node=null)},u.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,r=e.root,i=e.rootMargin;_(this.node,this.handleChange,{threshold:t,root:r,rootMargin:i})}},u.render=function(){var e=this.state,t=e.inView,r=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:r,ref:this.handleNode});var n=this.props,s=n.children,o=n.as,c=n.tag,u=(n.triggerOnce,n.threshold,n.root,n.rootMargin,n.onChange,function(e,t){if(null==e)return{};var r,i,n={},s=Object.keys(e);for(i=0;i<s.length;i++)r=s[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(n,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,i.createElement)(o||c||"div",a({ref:this.handleNode},u),s)},c}(i.Component);s(f,"displayName","InView"),s(f,"defaultProps",{threshold:0,triggerOnce:!1});var p={inView:!1,entry:void 0};function v(e){void 0===e&&(e={});var t=(0,i.useRef)(),r=(0,i.useState)(p),n=r[0],s=r[1],a=(0,i.useCallback)((function(r){t.current&&g(t.current),r&&_(r,(function(t,i){s({inView:t,entry:i}),t&&e.triggerOnce&&g(r)}),e),t.current=r}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,i.useEffect)((function(){t.current||n===p||e.triggerOnce||s(p)})),[a,n.inView,n.entry]}},702177:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var i="Invariant failed";const n=function(e,t){if(!e)throw new Error(i)}},654921:(e,t,r)=>{"use strict";r.d(t,{STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>c,STICKER_IMAGE:()=>u,STICKER_ANIMATION:()=>l,DEFAULT_CACHE:()=>d,SAMPLE_RECIPIENT_ID:()=>_,ORDER_ERRORS:()=>n,ORDER_ITEM_ERRORS:()=>s});var i,n,s,a=r(749091),o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},c={"102_png":{id:"102.png",width:102,height:102,theme:a.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:a.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:a.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:a.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:a.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:a.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:a.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:a.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:a.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:a.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:a.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:a.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},u={"64_png":{id:"64.png",width:64,height:64,theme:a.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:a.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:a.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:a.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:a.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:a.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:a.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:a.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:a.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:a.Theme.DARK}},l=((i={})[a.Theme.LIGHT]="animation.json",i[a.Theme.DARK]="animation.b.json",i),d={products:(0,a.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},_=-1;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(n||(n={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(s||(s={}))},749091:(e,t,r)=>{"use strict";var i;r.d(t,{Theme:()=>i,imageSizesIndex:()=>s,imageSizeCache:()=>a,createProductsMap:()=>o,UserProductStateKey:()=>n,isBasePack:()=>u,isStyleProduct:()=>l,isPackProduct:()=>d,ProductsByType:()=>_}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(i||(i={}));var n,s=Symbol(),a=Symbol(),o=function(e){return new Map(e)};!function(e){e.IsNew="is_new"}(n||(n={}));var c,u=function(e){return void 0!==e.sticker_ids},l=function(e){return void 0!==e.base_id},d=function(e){return u(e)&&!l(e)};!function(e){e.Pack="pack",e.Style="style"}(c||(c={}));var _=function(){function e(e){var t=this;void 0===e&&(e=[]),this.pack=new Set,this.style=new Set,e.forEach((function(e){return t.add(e)}))}return e.prototype.add=function(e){e&&(d(e)?this.pack.add(e):l(e)&&this.style.add(e))},e.prototype.getPack=function(){return this.pack.values().next().value},e.prototype.getStyles=function(){return Array.from(this.style.values())},e.prototype.getCount=function(){return this.pack.size+this.style.size},e}();!function(){function e(e){var t=this;this.pack=[],this.style=[],e.forEach((function(e){return t.add(e)}))}e.prototype.add=function(e){var t=e.product;t&&(d(t)?this.pack.push(e):l(t)&&this.style.push(e))}}()},922377:(e,t,r)=>{"use strict";r.d(t,{getStickerImageUrl:()=>o,getStickerAnimationUrl:()=>c,getStickerPackIconUrl:()=>u,isSampleOrderItem:()=>l});var i=r(570655),n=r(749091),s=r(654921),a=function(e,t,r,i){void 0===i&&(i=n.Theme.DEFAULT);var s=window.devicePixelRatio,a=[t*=s,r*=s,i].toString(),o=e[n.imageSizeCache];if(o&&o.has(a)){var c=o.get(a);if(c)return c}o||(o=new Map,e[n.imageSizeCache]=o);var u=function(e){var t=e[n.imageSizesIndex];return t||(t=Object.values(e).sort((function(e,t){return e.width-t.width||e.height-t.height})),e[n.imageSizesIndex]=t),t}(e).filter((function(e){return!e.theme||e.theme===i})),l=u.find((function(e){return e.width>=t&&e.height>=r}))||u[u.length-1];return o.set(a,l),l};function o(e,t,r,o){var c,u,l;if(void 0===o&&(o=n.Theme.DEFAULT),null===(l=e.render)||void 0===l?void 0:l.images){var d=e.render.images;d.sort((function(e,t){return e.width-t.width||e.height-t.height}));var _=void 0;try{for(var g=(0,i.__values)(d),h=g.next();!h.done;h=g.next()){var f=h.value;if(f.width>=t&&f.height>=r){if(f.theme===o)return f.url;_=f}}}catch(e){c={error:e}}finally{try{h&&!h.done&&(u=g.return)&&u.call(g)}finally{if(c)throw c.error}}if(_)return _.url}return function(e,t){return e.image.base_url+"/"+t.id+(e.image.version?"?"+e.image.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_IMAGE,e,t,r)}(t,r,o))}var c=function(e,t){return void 0===t&&(t=n.Theme.DEFAULT),e.animation?e.animation.base_url+"/"+s.STICKER_ANIMATION[t]+(e.animation.version?"?"+e.animation.version:""):""},u=function(e,t,r,i){return void 0===i&&(i=n.Theme.DEFAULT),function(e,t){return e.icon.base_url+"/"+t.id+(e.thumb.version?"?"+e.thumb.version:"")}(e,function(e,t,r){return void 0===r&&(r=n.Theme.DEFAULT),a(s.STICKER_PACK_ICON,e,t,r)}(t,r,i))},l=function(e){return e.recipient_id===s.SAMPLE_RECIPIENT_ID}},730304:(e,t,r)=>{"use strict";r.d(t,{moveStickersHintsToStickerPicker:()=>n});var i="StickersHints__marginTransition",n=function(e,t){var r=window.Emoji.opts[e];if(null==r?void 0:r.txt){var n=r.txt.parentNode.querySelector("._sticker_hints");if(n)if("none"!==getComputedStyle(n).getPropertyValue("display")){t&&(n.classList.add(i),requestAnimationFrame((function(){return n.classList.remove(i)}))),n.style.setProperty("margin-left","0px");var s=n.getBoundingClientRect().right;if(window.StickerPickerViewer){var a=window.StickerPickerViewer,o=a.isShown,c=a.isDown,u=a.wrapper;if(!o||!u||c)return;var l=-(s-u.getBoundingClientRect().left+10);n.style.setProperty("margin-left",l+"px")}}}}},665820:(e,t,r)=>{"use strict";r.d(t,{getCache:()=>u,updateCache:()=>l,getSticker:()=>d,getStickers:()=>_,getPackByStickerId:()=>h});var i=r(570655),n=r(293680),s=r(654921),a=r(749091),o=r(310835),c=r(26330),u=function(){if(!window.stickersCache){var e=c.default.get("stickers_cache");window.stickersCache=(0,i.__assign)((0,i.__assign)({},s.DEFAULT_CACHE),e)}return window.stickersCache},l=function(e){window.stickersCache=(0,i.__assign)((0,i.__assign)({},u()),e)},d=function(e){return u().stickers.get(e)},_=function(e){var t=u().stickers;return e.map((function(e){return t.get(e)}))},g=function(e){var t=d(e);if(!t||!t.pack_id)return null;var r=(0,o.getProductFromCache)(t.pack_id);return r&&(0,a.isBasePack)(r)?r:null},h=function(e){var t=g(e);return t?Promise.resolve(t):new Promise((function(t){n.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone:function(r){(0,o.cacheProductsData)(r),t(g(e))},onFail:function(e){return console.error(e),t(null),!0}})}))}},399321:(e,t,r)=>{"use strict";r.d(t,{Cart:()=>c});var i=r(570655),n=r(293680),s=r(236783),a=r(654921),o=r(310835),c=function(){function e(e,t){void 0===t&&(t=[]),this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}return e.create=function(t,r){return void 0===r&&(r=[]),new e(t.map((function(e){return{product_id:e,amount:1}})),r)},e.prototype.copy=function(){var t=new e(this.getItems(),this.getRecipientIds());return t.setOrder(this.getOrder()),t},e.prototype.getItems=function(){return Array.from(this.items.values())},e.prototype.setItems=function(e){this.items=new Map(e.map((function(e){return[e.product_id,e]})))},e.prototype.loadItems=function(){var e=this,t=Array.from(this.items.keys());return(0,o.getProducts)(t).then((function(){var t,r;try{for(var n=(0,i.__values)(Array.from(e.items.values())),s=n.next();!s.done;s=n.next()){var a=s.value;a.product=(0,o.getProductFromCache)(a.product_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}))},e.prototype.getProducts=function(){return(0,o.getProductsFromCache)(Array.from(this.items.keys()))},e.prototype.hasProduct=function(e){return this.items.has(e)},e.prototype.addProduct=function(e,t){if(void 0===t&&(t=!1),!this.hasProduct(e)){var r={product_id:e,amount:1};t?this.setItems((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getItems()),!1),[r],!1)):this.setItems((0,i.__spreadArray)([r],(0,i.__read)(this.getItems()),!1)),this.onChange&&this.onChange()}},e.prototype.removeProduct=function(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())},e.prototype.getRecipientIds=function(e){return void 0===e&&(e=!1),this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[a.SAMPLE_RECIPIENT_ID]:[]},e.prototype.setRecipientIds=function(e){this.recipientIds=new Set(e)},e.prototype.hasRecipientId=function(e){return this.recipientIds.has(e)},e.prototype.addRecipientId=function(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())},e.prototype.removeRecipientId=function(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())},e.prototype.setOrder=function(e){var t,r;if(this._order=e,e){this.recipientIds.clear();try{for(var n=(0,i.__values)(e.items),s=n.next();!s.done;s=n.next()){var o=s.value;o.recipient_id!==a.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(o.recipient_id)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}},e.prototype.loadOrder=function(e){var t=e.items.map((function(e){return e.product_id}));return(0,o.getProducts)(t).then((function(t){return(0,i.__assign)((0,i.__assign)({},e),{items:e.items.map((function(e,r){return(0,i.__assign)((0,i.__assign)({},e),{product:t[r]})}))})}),(function(){return e}))},e.prototype.getOrder=function(){return this._order},e.prototype.getRecipientsMap=function(){return this.recipients},e.prototype.getRecipients=function(){return Array.from(this.recipients.values())},e.prototype.getRecipientById=function(e){return this.recipients.get(e)},e.prototype.addRecipients=function(e){this.recipients=new Map((0,i.__spreadArray)((0,i.__spreadArray)([],(0,i.__read)(this.getRecipients()),!1),(0,i.__read)(e),!1).map((function(e){return[e[0],e]})))},e.prototype.getJSON=function(){return JSON.stringify({items:this.getItems().map((function(e){return(0,i.__assign)((0,i.__assign)({},e),{product:void 0})})),recipient_ids:this.getRecipientIds(!0)})},e.prototype.isLoaded=function(){return null!==this.getOrder()},e.prototype.cancelLoad=function(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)},e.prototype.load=function(e){var t=this;return void 0===e&&(e=!1),this.cancelLoad(),new Promise((function(r){t.loadTimeout=window.setTimeout((function(){t.loadCancellationToken=new s.AjaxCancellationToken,n.ajax.post("stickers.php",{act:"preview_products_order",cart:t.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:t.loadCancellationToken,onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadItems(),t.loadOrder(e.order)]).then((function(n){var s=(0,i.__read)(n,2)[1];t.setOrder(s),e.recipients&&t.addRecipients(e.recipients),r(t)}),(function(){}))},onFail:function(e){return e&&window.__dev&&console.error(e),r(t),!0}})}),300)}))},e.prototype.order=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(r){var s;n.ajax.post("stickers.php",{act:"order_products",cart:t.getJSON(),hash:e.hash||(null===(s=t.getOrder())||void 0===s?void 0:s.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:function(e){(0,o.cacheProductsData)(e),Promise.all([t.loadOrder(e.order),t.loadOrder(e.result)]).then((function(e){var n=(0,i.__read)(e,2),s=n[0],a=n[1];t.setOrder(s),r(a)}),(function(){}))},onFail:function(e){return e&&console.error(e),r(null),!0}})}))},e}()},360989:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var i=r(570655),n=r(785893),s=r(667294),a=r(748759),o=r(483295),c=r(749091),u=r(330494),l=r(166347);const d=function(e){var t=e.className,r=e.sticker,d=e.theme,_=void 0===d?c.Theme.LIGHT:d,g=e.width,h=e.height,f=(0,i.__read)((0,a.useInView)({threshold:0}),2),p=f[0],v=f[1],m=void 0!==r.animation,k=(0,i.__read)((0,s.useState)(!1),2),y=k[0],S=k[1];return(0,n.jsx)("div",(0,i.__assign)({className:(0,o.classNames)("Sticker",t),ref:p,onMouseEnter:function(){S(!0)},onMouseLeave:function(){S(!1)}},{children:m?(0,n.jsx)(l.default,{sticker:r,theme:_,width:g,height:h,isInView:v,play:y},void 0):(0,n.jsx)(u.default,{sticker:r,theme:_,width:g,height:h,isInView:v},void 0)}),void 0)}},166347:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var i=r(570655),n=r(785893),s=r(667294),a=r(483295),o=r(211248),c=r.n(o),u=r(922377);const l=function(e){var t=e.className,r=e.sticker,o=e.theme,l=e.width,d=e.height,_=e.isInView,g=void 0===_||_,h=e.play,f=void 0!==h&&h,p=(0,s.useRef)(null),v=(0,i.__read)((0,s.useState)(null),2),m=v[0],k=v[1],y=(0,u.getStickerAnimationUrl)(r,o);return(0,s.useEffect)((function(){if(m&&m.isLoaded){var e=f&&g;e&&!m.playing&&(m.item.play(),k((0,i.__assign)((0,i.__assign)({},m),{playing:!0}))),!e&&m.playing&&(m.item.pause(),k((0,i.__assign)((0,i.__assign)({},m),{playing:!1})))}}),[m,f,g]),(0,s.useEffect)((function(){if(!m||m.url!==y)if(m&&m.item.destroy(),y&&g){var e=c().loadAnimation({container:p.current,path:y,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:y,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(function(){k((0,i.__assign)((0,i.__assign)({},t),{isLoaded:!0}))})),k(t)}else k(null)}),[y,g]),(0,n.jsx)("div",{className:(0,a.classNames)("StickerAnimation",t),style:{width:l,height:d},ref:p},void 0)}},330494:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var i=r(570655),n=r(785893),s=r(667294),a=r(483295),o=r(922377);const c=function(e){var t=e.className,r=e.sticker,c=e.theme,u=e.width,l=e.height,d=e.isInView,_=void 0===d||d,g=(0,s.useRef)(null),h=(0,o.getStickerImageUrl)(r,u,l,c);return(0,s.useLayoutEffect)((function(){g.current&&g.current.src!==h&&_&&(g.current.src=h)}),[_,h]),(0,n.jsx)("div",(0,i.__assign)({className:(0,a.classNames)("StickerImage",t),style:{width:u,height:l}},{children:(0,n.jsx)("img",{className:"StickerImage__image",ref:g},void 0)}),void 0)}},60578:(e,t,r)=>{"use strict";r.d(t,{default:()=>b});var i=r(570655),n=r(785893),s=r(667294),a=r(86894),o=r(486125),c=r(146143),u=r(786067),l=r(70162),d=r(213984),_=r(733024),g=r(686478),h=r(749091),f=r(654921),p=r(665820),v=r(348230),m=r(451322),k=r(683791),y=r(155639),S=r(450134),w=r(360989),P=r(295565),x=r(54637),L=r(369783),I=r(870264),j=r(511417),N=r(659397);const b=function(e){var t=e.pack,r=e.cart,b=e.options,C=b.recipientIds,T=void 0===C?[]:C,R=b.ref,M=b.gift_ref,A=e.closeBox,G=(0,i.__read)((0,m.usePack)(t.id),1)[0];G&&(t=G);var B=(0,i.__read)((0,k.useStyles)(t.style_ids||[]),2),D=B[0],E=B[1],O=(0,i.__read)((0,S.useCart)((function(){return r})),2),H=O[0],F=O[1],V=(0,i.__read)((0,y.useWithProducts)(H.getItems()),1)[0],U=H.getProducts(),z=H.getOrder(),K=(0,p.getSticker)(t.sticker_ids[0]),W=function(e){var t,r;if(!e)return null;var n=[],s=[];try{for(var a=(0,i.__values)(e.items),o=a.next();!o.done;o=a.next()){var c=o.value,d=c.product,_=c.error;d&&!_&&((0,h.isPackProduct)(d)?n.push(c):(0,h.isStyleProduct)(d)&&s.push(c))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var g=s.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(n.length){var f=n.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return f?s.length?g?(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for_styles_for",s.length),"pack_price",(0,l.getLang)("global_n_votes",f),"styles_num",s.length,"styles_price_sum",g):(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for_styles_free",s.length),"pack_price",(0,l.getLang)("global_n_votes",f),"styles_num",s.length):(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_for"),"pack_price",(0,l.getLang)("global_n_votes",f)):s.length?g?(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free_styles_for",s.length),"styles_num",s.length,"styles_price_sum",(0,l.getLang)("global_n_votes",g)):(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free_styles_free",s.length),"styles_num",s.length):(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_pack_free"))}if(s.length)return g?(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_styles_for",s.length),"styles_num",s.length,"styles_price_sum",(0,l.getLang)("global_n_votes",g)):(0,u.langStr)((0,l.getLang)("purchases_stickers_order_summary_styles_free",s.length),"styles_num",s.length);return null}(z),q=!F&&z&&!z.error,Q=(0,i.__read)((0,s.useState)(!1),2),$=Q[0],J=Q[1],X=null;if(z)if(z.error){if(z.error===f.ORDER_ERRORS.NOT_SIGNED_IN){X=(0,n.jsx)(a.Button,(0,i.__assign)({mode:"primary",size:"m",loading:F,onClick:function(){(0,o.showDoneBox)((0,l.getLang)("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))}},{children:(0,l.getLang)("purchases_stickers_get_pack_btn")}),void 0)}else if(z.error===f.ORDER_ERRORS.NO_VALID_ITEMS){if(1===z.items.length){var Z=z.items[0],Y=Z.product,ee=Z.error;if(Y&&ee!==f.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&Y.purchase_details){var te=Y.purchase_details,re=te.label,ie=te.title,ne=te.text,se=te.button_title,ae=te.button_url;X=(0,n.jsx)(a.Button,(0,i.__assign)({mode:"primary",size:"m",loading:F,onClick:function(){(0,c.showFastBox)(ie||(0,l.getLang)("purchases_stickers_catalog_purchase_details_title"),ne,ae&&se||void 0,ae?function(){window.location.href=ae}:void 0)}},{children:re||(0,l.getLang)("purchases_stickers_product_unavailable")}),void 0)}}if(!X){var oe=!z.items.find((function(e){return e.error!==f.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT}));X=(0,n.jsx)(a.Button,(0,i.__assign)({mode:"secondary",size:"m",disabled:!0},{children:oe?(0,l.getLang)("purchases_stickers_product_purchased"):(0,l.getLang)("purchases_stickers_product_unavailable")}),void 0)}}}else{var ce=F||$;X=(0,n.jsx)(L.default,{mode:"primary",size:"m",loading:ce,disabled:ce,price:z.price,text:z.price.current?(0,l.getLang)("purchases_stickers_buy_for"):(0,l.getLang)("purchases_stickers_get_for_free"),onClick:function(){$||(J(!0),H.order({ref:R,gift_ref:M}).then((function(e){J(!1),e&&!e.error&&(0,o.showDoneBox)((0,v.getPurchaseResult)(e))}),(function(){})))}},void 0)}var ue=!F&&void 0!==U.find((function(e){return null==e?void 0:e.can_gift})),le=V.reduce((function(e,t){return t.product&&t.product.copyright&&e.add(t.product.copyright),e}),new Set),de=j.colorScheme.isDarkScheme()?h.Theme.DARK:h.Theme.LIGHT;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackPreview"},{children:[(0,n.jsxs)("header",(0,i.__assign)({className:"StickerPackPreview__header"},{children:[(0,n.jsx)("a",(0,i.__assign)({className:"StickerPackPreview__close",onClick:A},{children:(0,n.jsx)(_.default,{},void 0)}),void 0),K&&(0,n.jsx)(w.default,{className:"StickerPackPreview__icon",sticker:K,theme:de,width:128,height:128},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__info"},{children:[(0,n.jsx)(d.default,(0,i.__assign)({element:"h1",className:"StickerPackPreview__title"},{children:t.title}),void 0),(0,n.jsx)(d.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__author"},{children:t.author}),void 0),(0,n.jsx)(d.default,(0,i.__assign)({element:"div",className:"StickerPackPreview__description"},{children:t.description}),void 0)]}),void 0)]}),void 0),D.length>0&&(0,n.jsx)(P.default,{className:"StickerPackPreview__styles",styles:D,isLoading:E,isAdded:function(e){return H.hasProduct(e.id)},add:function(e){return H.addProduct(e.id)},remove:function(e){return H.removeProduct(e.id)},gift:function(e){return t=e.id,void(0,I.giftStickerProducts)([t],T);var t}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackPreview__footerContainer"},{children:[(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__items"},{children:V.map((function(e){return(0,n.jsx)(x.default,{item:e,showHeader:D.length>0,remove:e.product&&(0,h.isStyleProduct)(e.product)?function(){return H.removeProduct(e.product_id)}:void 0},e.product_id)}))}),void 0),le.size>0&&(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackPreview__copyrights"},{children:Array.from(le).map((function(e,t){return(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__copyright"},{children:(0,N.decodeHTMLEntities)(e)}),t)}))}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerPackPreview__footer"},{children:[!F&&(q||ue)&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerPackPreview__footerNote"},{children:W}),void 0),(0,n.jsxs)(a.ButtonGroup,{children:[ue&&(0,n.jsx)(a.Button,(0,i.__assign)({mode:"primary",size:"m",onClick:function(){return(e=H.copy()).setRecipientIds(T),void(0,I.giftStickersCart)(e);var e},before:(0,n.jsx)(g.default,{width:20,height:20},void 0)},{children:(0,l.getLang)("purchases_stickers_gift")}),void 0),X]},void 0)]}),void 0)]}),void 0)]}),void 0)}},187925:(e,t,r)=>{"use strict";r.d(t,{default:()=>S});var i=r(570655),n=r(785893),s=r(667294),a=r(86894),o=r(786067),c=r(70162),u=r(743927),l=r(439664),d=r(213984),_=r(749091),g=r(310835),h=r(399321),f=r(451322),p=r(683791),v=r(295565),m=r(190291),k=r(369783),y=r(870264);const S=function(e){var t=e.pack,r=e.options,S=e.closeBox,w=e.updateBox,P=(0,i.__read)((0,f.usePack)(t.id),2),x=P[0],L=P[1];x&&(t=x);var I=(0,i.__read)((0,p.useStyles)(t.style_ids||[]),2),j=I[0],N=I[1],b=L||N;(0,s.useEffect)((function(){w()}),[b]);var C=(0,i.__assign)((0,i.__assign)({},t),{base_id:t.id,title:(0,c.getLang)("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:t.sticker_ids}),T=(0,i.__spreadArray)([C],(0,i.__read)(j),!1),R=T.find((function(e){return e&&e.is_active}))||C,M=(0,i.__read)((0,s.useState)(),2),A=M[0],G=M[1],B=A&&T.find((function(e){return e&&e.id===A})),D=function(e){G(e&&e.id)},E=B||R,O=E===C?(0,c.getLang)("purchases_stickers_product_preview_title_base_pack"):(0,o.langStr)((0,c.getLang)("purchases_stickers_product_preview_title_style"),"title",E.title);(0,s.useEffect)((function(){E.is_new&&(0,g.updateUserProductState)(E.id,_.UserProductStateKey.IsNew,0).finally((function(){}))}),[E,E.is_new]);var H=(0,i.__read)((0,s.useState)(!1),2),F=H[0],V=H[1],U=(0,i.__read)((0,s.useState)(!1),2),z=U[0],K=U[1];return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerPackSettings"},{children:[(0,n.jsx)(u.ModalHeader,{className:"StickerPackSettings__header",title:t?(0,o.langStr)((0,c.getLang)("purchases_stickers_style_selection_for_pack"),"title",t.title):"",onClose:S},void 0),b?(0,n.jsx)("section",(0,i.__assign)({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,n.jsx)(l.default,{size:24},void 0)}),void 0):(0,n.jsxs)(s.Fragment,{children:[T.length>0&&(0,n.jsx)(v.default,{className:"StickerPackSettings__styles",styles:T,isLoading:N,activeStyle:R,selectedStyle:E,select:function(e){return D(e)}},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerPackSettings__footerContainer"},{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerPackSettings__stylePreview"},{children:[(0,n.jsx)(d.default,(0,i.__assign)({element:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:O}),void 0),(0,n.jsx)(m.default,{product:E},void 0)]}),void 0),(0,n.jsx)("footer",(0,i.__assign)({className:"StickerPackSettings__footer"},{children:(0,n.jsxs)(a.ButtonGroup,{children:[E.can_gift&&(0,n.jsx)(a.Button,{mode:"secondary",size:"m",onClick:function(){return e=E.id,void(0,y.giftStickerProducts)([e],r.recipientIds||[]);var e}},void 0),E.is_purchased?(0,n.jsx)(a.Button,(0,i.__assign)({mode:"primary",size:"m",disabled:E===R,loading:z,onClick:function(){return e=E,void(z||(K(!0),(0,g.activateProduct)(e).then((function(){K(!1),D(void 0)}),(function(){}))));var e}},{children:(0,c.getLang)("purchases_stickers_product_settings_save")}),void 0):(0,n.jsx)(k.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:E.price.purchase,text:E.price.purchase.current?(0,c.getLang)("purchases_stickers_buy_for"):(0,c.getLang)("purchases_stickers_get_for_free"),loading:F,onClick:function(){return e=E,void(F||(V(!0),h.Cart.create([e.id]).load().then((function(e){return e.order()})).then((function(){V(!1)}),(function(){}))));var e}},void 0)]},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},490808:(e,t,r)=>{"use strict";r.d(t,{default:()=>w});var i=r(570655),n=r(785893),s=r(667294),a=r(486125),o=r(786067),c=r(70162),u=r(743927),l=r(439664),d=r(273947),_=r(674041),g=r(479806),h=r(599940),f=r(749091),p=r(922377),v=r(450134),m=r(820159),k=r(945752),y=r(369783),S=r(659397);const w=function(e){var t=e.cart,r=e.options,w=r.ref,P=r.gift_ref,x=e.closeBox,L=e.updateBox,I=(0,i.__read)((0,v.useCart)(t),2),j=I[0],N=I[1],b=!j.isLoaded()&&N;(0,s.useEffect)((function(){L()}),[b]);var C=j.getRecipientIds(),T=j.getOrder(),R=T&&!T.error&&T.items.find((function(e){return!e.error&&!(0,p.isSampleOrderItem)(e)})),M=(0,i.__read)(function(e){var t,r,n;if(!e)return[null,null];try{for(var s=(0,i.__values)(e.items),a=s.next();!a.done;a=s.next()){var u=a.value.product;if(u&&(0,f.isPackProduct)(u)){n=u;break}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var l=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),d=l.filter((function(e){return!e.error&&!(0,p.isSampleOrderItem)(e)}));d.length&&(l=d);var _=new f.ProductsByType(l.map((function(e){return e.product}))),g=_.pack.values().next().value,h=Array.from(_.style),v="",m="";if(1===h.length)v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_1_style"),"title",h[0].title),g?m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_with_pack"),"title",g.title):n&&(m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_for_pack"),"title",n.title));else if(g){if(v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_pack"),"title",g.title),h.length)switch(h.length){case 2:m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_with_2_styles"),"title1",h[0].title,"title2",h[1].title);break;case 3:m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_with_3_styles"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;case 4:m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;default:var k=h.length-3;m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_with_3_styles_and_n_more",k),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title,"n",k)}}else if(h.length){switch(h.length){case 2:v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_2_styles"),"title1",h[0].title,"title2",h[1].title);break;case 3:v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_3_styles"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;case 4:v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title);break;default:k=h.length-3;v=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_title_3_styles_and_n_more",k),"title1",h[0].title,"title2",h[1].title,"title3",h[2].title,"n",k)}n&&(m=(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_description_for_pack"),"title",n.title))}h.length?m+=" "+(0,c.getLang)("purchases_stickers_gift_description_styles"):m+=" "+(0,c.getLang)("purchases_stickers_gift_description");return[v,m]}(T),2),A=M[0],G=M[1],B=(0,i.__read)((0,s.useState)(null),2)[1];(0,s.useLayoutEffect)((function(){var e,t,r=j.getRecipients();if(B(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:r,items:r,noResult:(0,c.getLang)("gifts_nobody_found"),introText:(0,c.getLang)("gifts_start_typing_recipient"),maxItems:20,onChange:function(e,t){1===e?j.addRecipientId(+t):j.removeRecipientId(+t)}})),C.length)try{for(var n=(0,i.__values)(C),s=n.next();!s.done;s=n.next()){var a=s.value,o=j.getRecipientById(a);o&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return function(){window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[b]);var D=(0,i.__read)((0,s.useState)(""),2),E=D[0],O=D[1],H=(0,i.__read)((0,s.useState)(!1),2),F=H[0],V=H[1],U=(0,i.__read)((0,s.useState)(!1),2),z=U[0],K=U[1],W=function(){z||(K(!0),j.order({message:E,is_private:F,ref:w,gift_ref:P}).then((function(e){K(!1),e&&!e.error&&((0,a.showDoneBox)(function(e,t){var r,n,s=new f.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),a=function(e){var t=e.getPack(),r=e.getStyles();if(t)return r.length?(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_pack_and_styles",r.length),"title",t.title,"styles_num",r.length):(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_pack"),"title",t.title);if(r.length)switch(r.length){case 1:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_1_style"),"title",r[0].title);case 2:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_2_styles"),"title1",r[0].title,"title2",r[1].title);case 3:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_3_styles"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);case 4:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title);default:var i=r.length-3;return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_products_3_styles_and_n_more",i),"title1",r[0].title,"title2",r[1].title,"title3",r[2].title,"n",i)}return null}(s);if(!a)return null;var u=new Set;try{for(var l=(0,i.__values)(e.items),d=l.next();!d.done;d=l.next()){var _=d.value,g=_.error,h=_.recipient_id;if(!g){var p=t(h);p&&u.add(p)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var v=function(e,t){var r=Array.from(e.values());switch(r.length){case 0:return null;case 1:var i=1===t?(0,c.getLang)("purchases_stickers_gift_result_1_recipient_single","raw"):(0,c.getLang)("purchases_stickers_gift_result_1_recipient_multiple","raw");return(0,o.langStr)((0,c.langSex)(r[0][8],i),"name",r[0][8]);case 2:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_2_recipients",t),"name1",r[0][8],"name2",r[1][8]);case 3:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_3_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8]);case 4:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_4_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8]);case 5:return(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_result_5_recipients",t),"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"name5",r[4][8]);default:var n=r.length-4;i=1===t?(0,c.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_single"):(0,c.getLang)("purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,o.langStr)(i,"name1",r[0][8],"name2",r[1][8],"name3",r[2][8],"name4",r[3][8],"n",n)}return null}(u,s.getCount());if(!v)return null;return(0,o.langStr)(v,"products",a)}(e,(function(e){return j.getRecipientById(e)}))),x())}),(function(){})))};return(0,s.useEffect)((function(){window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",z)}),[z]),(0,n.jsxs)("article",(0,i.__assign)({className:"StickerProductsGift"},{children:[(0,n.jsx)(u.ModalHeader,{className:"StickerProductsGift__header",title:(0,c.getLang)("purchases_stickers_gift_box_title"),onClose:x},void 0),b?(0,n.jsx)("section",(0,i.__assign)({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,n.jsx)(l.default,{size:24},void 0)}),void 0):(0,n.jsxs)(s.Fragment,{children:[(0,n.jsxs)("section",(0,i.__assign)({className:"StickerProductsGift__content"},{children:[(0,n.jsx)(m.default,{order:T,forceValid:!R},void 0),(0,n.jsx)("h1",(0,i.__assign)({className:"StickerProductsGift__productsTitle"},{children:(0,S.decodeHTMLEntities)(A||"")}),void 0),(0,n.jsx)("p",(0,i.__assign)({className:"StickerProductsGift__productsDescription"},{children:(0,S.decodeHTMLEntities)(G||"")}),void 0),T&&(0,n.jsxs)(s.Fragment,{children:[(0,n.jsxs)("dl",(0,i.__assign)({className:"StickerProductsGift__price"},{children:[(0,n.jsx)("dt",(0,i.__assign)({className:"StickerProductsGift__priceLabel"},{children:(0,c.getLang)("purchases_gift_price_label")}),void 0)," ",(0,n.jsx)("dd",(0,i.__assign)({className:"StickerProductsGift__priceValue"},{children:(0,c.getLang)("global_n_votes",T.price.current)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__balance"},{children:(0,o.langStr)((0,c.getLang)("gifts_you_have_X_votes"),"votes",(0,c.getLang)("global_n_votes",T.balance))}),void 0)]},void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__recipients"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:(0,c.getLang)("gifts_receiver")}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,n.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,n.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:(0,c.getLang)("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__message"},{children:[(0,n.jsx)("label",(0,i.__assign)({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:(0,c.getLang)("purchases_gift_your_message")}),void 0),(0,n.jsx)(d.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:E,onChange:function(e){return O(e.currentTarget.value)},onResize:function(){return L()},style:{height:80},disabled:z},void 0)]}),void 0),(0,n.jsx)(_.default,(0,i.__assign)({className:"StickerProductsGift__isPrivate",checked:F,disabled:z,onChange:function(){return V(!F)}},{children:(0,c.getLang)("gifts_receiver_only")}),void 0)]}),void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerProductsGift__footer"},{children:[(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerNote"},{children:!N&&T&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGift__details"},{children:[(0,c.getLang)("purchases_stickers_gift_details_label"),(0,n.jsx)(h.default,(0,i.__assign)({className:"StickerProductsGift__detailsTooltip",text:(0,n.jsx)(k.default,{order:T,recipients:j.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,n.jsx)(g.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGift__footerButtons"},{children:(0,n.jsx)(y.default,{className:"StickerProductsGift__gift",mode:R?"primary":"secondary",size:"m",loading:N||z,disabled:!R,price:null==T?void 0:T.price,text:R?(0,o.langStr)((0,c.getLang)("purchases_stickers_gift_send_for"),"price",(0,c.getLang)("global_n_votes",null==T?void 0:T.price.current)):(0,c.getLang)("purchases_stickers_gift_send"),onClick:function(){return W()}},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},945752:(e,t,r)=>{"use strict";r.d(t,{default:()=>g});var i=r(570655),n=r(785893),s=r(667294),a=r(786067),o=r(70162),c=r(213984),u=r(749091),l=r(922377),d=r(659397);function _(e){var t=e.getPack(),r=e.getStyles(),i="";return r.length&&(i=r.map((function(e){return(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_recipient_style_title"),"title",e.title)})).join(", ")),t?i?(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",i):(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_recipient_pack"),"title",t.title):i?(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_recipient_styles"),"style_titles",i):null}const g=function(e){var t,r,g=e.order,h=e.recipients,f=function(e){var t,r;if(!e)return null;var n=e.items.filter((function(e){var t=e.product;return null==t?void 0:t.can_gift})),s=n.filter((function(e){return!e.error&&!(0,l.isSampleOrderItem)(e)}));s.length&&(n=s);var c=[],d=[];try{for(var _=(0,i.__values)(n),g=_.next();!g.done;g=_.next()){var h=g.value,f=h.product;f&&((0,u.isPackProduct)(f)?c.push(h):(0,u.isStyleProduct)(f)&&d.push(h))}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}var p=d.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);if(c.length){var v=c.reduce((function(e,t){var r;return e+((null===(r=t.price)||void 0===r?void 0:r.current)||0)}),0);return d.length?(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_summary_pack_with_styles",d.length),"pack_price_sum",(0,o.getLang)("global_n_votes",v),"styles_num",d.length,"styles_price_sum",(0,o.getLang)("global_n_votes",p)):(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",(0,o.getLang)("global_n_votes",v))}if(d.length)return(0,a.langStr)((0,o.getLang)("purchases_stickers_gift_details_summary_styles",d.length),"styles_num",d.length,"styles_price_sum",(0,o.getLang)("global_n_votes",p));return null}(g),p=new Map;try{for(var v=(0,i.__values)(g.items),m=v.next();!m.done;m=v.next()){var k=m.value,y=k.error,S=k.product,w=k.recipient_id;if(!y){var P=h.get(w);if(P){var x=p.get(P);x||(x=new u.ProductsByType,p.set(P,x)),x.add(S)}}}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}var L=Array.from(p.entries()),I=(0,s.useRef)(null);return(0,s.useEffect)((function(){var e=I.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,n.jsxs)("div",(0,i.__assign)({className:"StickerProductsGiftDetails",ref:I},{children:[f&&(0,n.jsx)(c.default,(0,i.__assign)({element:"p",className:"StickerProductsGiftDetails__summary"},{children:f}),void 0),L.length>0&&(0,n.jsx)("ul",(0,i.__assign)({className:"StickerProductsGiftDetails__recipients"},{children:L.map((function(e){var t=(0,i.__read)(e,2),r=t[0],s=t[1];return(0,n.jsxs)("li",(0,i.__assign)({className:"StickerProductsGiftDetails__recipient"},{children:[(0,n.jsx)(c.default,(0,i.__assign)({element:"div",className:"StickerProductsGiftDetails__recipientName"},{children:r[1]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerProductsGiftDetails__recipientProducts"},{children:(0,d.decodeHTMLEntities)(_(s)||"")}),void 0)]}),r[0])}))}),void 0)]}),void 0)}},820159:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var i=r(570655),n=r(785893),s=r(483295),a=r(749091),o=r(922377),c={s:56,m:96,l:168};const u=function(e){var t,r,u,l,d,_=e.order,g=e.forceValid,h=void 0!==g&&g,f=new Map,p=new Map;if(_)try{for(var v=(0,i.__values)(_.items),m=v.next();!m.done;m=v.next()){var k=m.value,y=k.product;y&&((0,a.isPackProduct)(y)?f.has(y)?null===(u=f.get(y))||void 0===u||u.push(k):f.set(y,[k]):(0,a.isStyleProduct)(y)&&(p.has(y)?null===(l=p.get(y))||void 0===l||l.push(k):p.set(y,[k])))}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}var S=f.keys().next().value,w=(S?1:0)+p.size,P=w>1?w>2?"s":"m":"l",x=c[P],L=Array.from(p.entries());h||L.sort((function(e,t){var r=(0,i.__read)(e,2)[1];return(0,i.__read)(t,2)[1].filter((function(e){return!e.error})).length-r.filter((function(e){return!e.error})).length}));var I=L.slice(0,3),j=L.slice(3),N=!0;if(!h){var b=j.filter((function(e){return(0,i.__read)(e,2)[1].find((function(e){return!e.error}))}));b.length?j=b:N=!1}return(0,n.jsxs)("ul",(0,i.__assign)({className:"StickerProductsGiftIcons"},{children:[S&&(0,n.jsx)("li",{className:(0,s.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+P,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!h&&!(null===(d=f.get(S))||void 0===d?void 0:d.find((function(e){return!e.error})))}),style:{backgroundImage:"url("+(0,o.getStickerPackIconUrl)(S,x,x)+")"}},S.id),I.map((function(e){var t=(0,i.__read)(e,2),r=t[0],a=t[1];return(0,n.jsx)("li",{className:(0,s.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+P,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!h&&!a.find((function(e){return!e.error}))}),style:{backgroundImage:"url("+(0,o.getStickerPackIconUrl)(r,x,x)+")"}},r.id)})),j.length?(0,n.jsxs)("li",(0,i.__assign)({className:(0,s.classNames)("StickerProductsGiftIcons__icon","StickerProductsGiftIcons__icon--"+P,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!N})},{children:["+",j.length]}),"more"):null]}),void 0)}},618610:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var i=r(570655),n=r(785893),s=r(786067),a=r(70162),o=r(86894),c=r(743927),u=r(190291);const l=function(e){var t=e.style,r=e.options.add,l=e.closeBox;return(0,n.jsxs)("article",(0,i.__assign)({className:"StickerStylePreview"},{children:[(0,n.jsx)(c.ModalHeader,{className:"StickerStylePreview__header",title:(0,s.langStr)((0,a.getLang)("purchases_stickers_stickers_of_style"),"title",t.title),onClose:l},void 0),(0,n.jsx)(u.default,{className:"StickerStylePreview__content",product:t},void 0),(0,n.jsxs)("footer",(0,i.__assign)({className:"StickerStylePreview__footer"},{children:[(0,n.jsx)(o.Button,(0,i.__assign)({mode:"tertiary",size:"m",onClick:l},{children:(0,a.getLang)("global_cancel")}),void 0),r&&(0,n.jsx)(o.Button,(0,i.__assign)({mode:"primary",size:"m",onClick:function(){return r(t)}},{children:(0,a.getLang)("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)}},295565:(e,t,r)=>{"use strict";r.d(t,{default:()=>_});var i=r(570655),n=r(785893),s=r(483295),a=r(70162),o=r(647560),c=r(599940),u=r(479806),l=r(290625),d=r(171134);const _=function(e){var t=e.className,r=e.styles,_=e.isLoading,g=e.isAdded,h=e.add,f=e.remove,p=e.gift,v=e.activeStyle,m=e.selectedStyle,k=e.select,y=(0,l.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(_)return(0,n.jsx)("section",(0,i.__assign)({className:(0,s.classNames)("StickerStylesMenu","StickerStylesMenu--loading",t)},{children:(0,n.jsx)(o.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);var S=[{title:(0,a.getLang)("purchases_stickers_purchased_styles"),styles:r.filter((function(e){return e.is_purchased&&!e.is_disabled}))},{title:(0,a.getLang)("purchases_stickers_other_styles"),styles:r.filter((function(e){return!e.is_purchased&&!e.is_disabled&&!e.is_hidden})),tooltip:(0,a.getLang)("purchases_stickers_styles_hint")}].filter((function(e){return e.styles.length}));return S.length?(0,n.jsxs)("section",(0,i.__assign)({className:(0,s.classNames)("StickerStylesMenu",t),ref:y.ref,onWheel:function(e){return y.onWheel(e)}},{children:[(0,n.jsx)("a",{className:(0,s.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!y.hasPrev}),onClick:function(){return y.prev()}},void 0),(0,n.jsx)("a",{className:(0,s.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!y.hasNext}),onClick:function(){return y.next()}},void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__wrapper"},{children:S.map((function(e,t){return(0,n.jsxs)("section",(0,i.__assign)({className:"StickerStylesMenu__group"},{children:[(0,n.jsxs)("h2",(0,i.__assign)({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,n.jsx)(c.default,(0,i.__assign)({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,n.jsx)(u.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((function(e){return(0,n.jsx)(d.default,{className:"StickerStylesMenu__item",style:e,isLoading:_,isAdded:g&&g(e),add:h&&function(){return h(e)},remove:f&&function(){return f(e)},gift:p&&function(){return p(e)},isActive:void 0===v?void 0:e===v,isSelected:void 0===m?void 0:e===m,select:k&&function(){return k(e)}},e.id)}))}),void 0)]}),t)}))}),void 0)]}),void 0):null}},171134:(e,t,r)=>{"use strict";r.d(t,{default:()=>_});var i=r(570655),n=r(785893),s=r(483295),a=r(70162),o=r(288420),c=r(213984),u=r(665820),l=r(686478),d=r(360989);const _=function(e){var t,r=e.className,_=e.style,g=e.isAdded,h=void 0!==g&&g,f=e.add,p=e.remove,v=e.gift,m=e.isActive,k=e.isSelected,y=e.select;t=_.is_new?_.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):_.title;var S=(0,u.getSticker)(_.style_sticker_ids[0]),w=function(e){return function(t){t.stopPropagation(),e()}};return(0,n.jsxs)("div",(0,i.__assign)({className:(0,s.classNames)("StickerStylesMenuItem",r,{"StickerStylesMenuItem--selected":Boolean(k),"StickerStylesMenuItem--added":Boolean(h),"StickerStylesMenuItem--new":_.is_new}),onClick:function(){y?y():h?p&&p():f&&f()}},{children:[S&&(0,n.jsx)(d.default,{className:"StickerStylesMenuItem__icon",sticker:S,width:100,height:100},void 0),(0,n.jsx)(c.default,(0,i.__assign)({element:"div",className:"StickerStylesMenuItem__title"},{children:t}),void 0),_.is_purchased?void 0===m?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:(0,a.getLang)("purchases_stickers_you_have_it")}),void 0):m&&(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__notice"},{children:(0,a.getLang)("purchases_stickers_active_style")}),void 0):_.price.purchase.regular?(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:(0,a.getLang)("global_n_votes",_.price.purchase.current)}),void 0):(0,n.jsx)("div",(0,i.__assign)({className:"StickerStylesMenuItem__price"},{children:(0,a.getLang)("purchases_for_free_btn")}),void 0),(f||p||v&&_.can_gift)&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickerStylesMenuItem__actions"},{children:[h?p&&(0,n.jsx)(o.default,(0,i.__assign)({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:w(p)},{children:(0,a.getLang)("purchases_stickers_preview_remove_item")}),void 0):f&&(0,n.jsx)(o.default,(0,i.__assign)({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:w(f)},{children:(0,a.getLang)("purchases_stickers_preview_add_item")}),void 0),v&&_.can_gift&&(0,n.jsx)(o.default,(0,i.__assign)({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:w(v)},{children:(0,n.jsx)(l.default,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)}},54637:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var i=r(570655),n=r(785893),s=r(786067),a=r(70162),o=r(213984),c=r(749091),u=r(190291);const l=function(e){var t=e.item,r=e.showHeader,l=void 0!==r&&r,d=e.remove;if(!t.product)return null;var _="";return(0,c.isPackProduct)(t.product)?_=(0,s.langStr)((0,a.getLang)("purchases_stickers_product_preview_title_pack"),"title",t.product.title):(0,c.isStyleProduct)(t.product)&&(_=(0,s.langStr)((0,a.getLang)("purchases_stickers_product_preview_title_style"),"title",t.product.title)),(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem"},{children:[l&&(0,n.jsxs)("div",(0,i.__assign)({className:"StickersCartItem__header"},{children:[(0,n.jsx)(o.default,(0,i.__assign)({element:"span",className:"StickersCartItem__title"},{children:_}),void 0),d&&(0,n.jsx)("span",(0,i.__assign)({className:"StickersCartItem__actions"},{children:(0,n.jsx)("button",(0,i.__assign)({className:"StickersCartItem__remove",onClick:function(){return d()}},{children:(0,a.getLang)("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,n.jsx)(u.default,{className:"StickersCartItem__preview",product:t.product},void 0)]}),void 0)}},369783:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var i=r(570655),n=r(785893),s=r(667294),a=r(86894),o=r(786067),c=r(483295),u=r(70162),l=function(e){var t=e.className,r=e.price,l=e.text,d=e.placeholder,_=(0,i.__rest)(e,["className","price","text","placeholder"]),g=(0,s.useMemo)((function(){if(r){var e;r.current!==r.regular&&r.regular&&(e=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__regular"},{children:r.current?r.regular:(0,o.langStr)((0,u.getLang)("purchases_stickers_n_for_m"),"%n","","%m",(0,u.getLang)("global_n_votes",r.regular))}),"regular"));var t=(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__current"},{children:r.current?(0,u.getLang)("global_n_votes",r.current):(0,u.getLang)("purchases_for_free_btn").toLowerCase()}),"current");return l?l.split(/(\{regular_price\}|\{price\})/).map((function(r,s){return"{regular_price}"===r?e:"{price}"===r?t:r?(0,n.jsx)("span",(0,i.__assign)({className:"StickersPriceButton__label"},{children:r}),"label"+s):void 0})):[e,t]}return[d]}),[l,d,null==r?void 0:r.regular,null==r?void 0:r.current]);return(0,n.jsx)(a.Button,(0,i.__assign)({className:(0,c.classNames)("StickersPriceButton",t)},_,{children:g}),void 0)};l.defaultProps=(0,i.__assign)({},a.Button.defaultProps);const d=l},190291:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var i=r(570655),n=r(785893),s=r(483295),a=r(511417),o=r(749091),c=r(665820),u=r(360989);const l=function(e){var t=e.className,r=e.product;if(!(0,o.isPackProduct)(r)&&!(0,o.isStyleProduct)(r))return null;var l=(0,c.getStickers)((0,o.isStyleProduct)(r)?r.style_sticker_ids:r.sticker_ids),d=a.colorScheme.isDarkScheme()?o.Theme.DARK:o.Theme.LIGHT;return(0,n.jsx)("div",(0,i.__assign)({className:(0,s.classNames)("StickersProductPreview",t)},{children:(0,n.jsx)("ul",(0,i.__assign)({className:"StickersProductPreview__stickers"},{children:l.map((function(e){return e&&(0,n.jsx)(u.default,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:d},e.id)}))}),void 0)}),void 0)}},450134:(e,t,r)=>{"use strict";r.d(t,{useCart:()=>s});var i=r(570655),n=r(667294),s=function(e){var t=(0,i.__read)((0,n.useState)(e),2),r=t[0],s=t[1],a=(0,i.__read)((0,n.useState)(null),2),o=a[0],c=a[1],u=(0,n.useCallback)((function(){var e=r.load();c(e),e.then((function(t){s(t),c((function(t){return t===e?null:t}))}),(function(){}))}),[r]);return(0,n.useEffect)((function(){return r.onChange=u,r.isLoaded()||u(),function(){r.onChange=null,r.cancelLoad()}}),[r]),[r,null!==o]}},451322:(e,t,r)=>{"use strict";r.d(t,{usePack:()=>a});var i=r(570655),n=r(749091),s=r(516067),a=function(e){var t=(0,i.__read)((0,s.useProduct)(e),2),r=t[0],a=t[1];return r&&(0,n.isPackProduct)(r)?[r,a]:[void 0===r?void 0:null,a]}},516067:(e,t,r)=>{"use strict";r.d(t,{useProduct:()=>a});var i=r(570655),n=r(667294),s=r(310835),a=function(e){var t=(0,i.__read)((0,n.useState)({}),2)[1],r=(0,s.getProductFromCache)(e);return void 0===r?((0,s.getProduct)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]}},227110:(e,t,r)=>{"use strict";r.d(t,{useProducts:()=>a});var i=r(570655),n=r(667294),s=r(310835),a=function(e){var t=(0,i.__read)((0,n.useState)({}),2)[1],r=(0,s.getProductsFromCache)(e);return r.some((function(e){return void 0===e}))?((0,s.getProducts)(e,!1).then((function(){return t({})}),(function(){})),[r,!0]):[r,!1]}},290625:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var i=r(570655),n=r(667294),s={getOffset:function(){return{x:0,y:0}},scrollTo:function(){},scrollBy:function(){},onWheel:function(){},updateItems:function(){},hasPrev:!1,hasNext:!1,prev:function(){},next:function(){}};function a(e,t){switch(t.type){case"updateState":return(0,i.__assign)((0,i.__assign)({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,i.__assign)((0,i.__assign)({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}var o=function(e){for(var t=Array.from(e.entries()),r=0;r<t.length;r++){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r-1]?t[r-1][0]:null}return null},c=function(e){for(var t=Array.from(e.entries()),r=t.length-1;r>=0;r--){var n=(0,i.__read)(t[r],2),s=n[0],a=n[1];if(a&&a.intersectionRatio)return a.intersectionRatio<1?s:t[r+1]?t[r+1][0]:null}return null};const u=function(e){var t=(0,n.useRef)(null),r=(0,i.__read)((0,n.useReducer)(a,s),2),u=r[0],l=r[1],d=(0,n.useCallback)((function(e){l({type:"updateState",state:e})}),[l]),_=(0,n.useCallback)((function(r){if(t.current&&u.onMouseWheel&&t.current.removeEventListener("mousewheel",u.onMouseWheel),r){var n=r.querySelector(e.wrapperSelector);if(n){var s,a={x:0,y:0},_=new Map,g=function(t){var i=0;n.offsetWidth>r.offsetWidth&&(i=Math.max(0,Math.min(n.offsetWidth-r.offsetWidth,t.x)));var s=0;n.offsetHeight>r.offsetHeight&&(s=Math.max(0,Math.min(n.offsetHeight-r.offsetHeight,t.y))),n.style.transform="translate3d(-"+i+"px, -"+s+"px, 0)",n.style.transitionDuration=t.noTransition?"0s":"",a={x:i,y:s},e.onScroll&&e.onScroll(i,s)},h=function(e){g((0,i.__assign)((0,i.__assign)({},e),{x:a.x+e.x,y:a.y+e.y}))},f=function(e){e.deltaX&&e.preventDefault()};r.addEventListener("mousewheel",f),d((0,i.__assign)((0,i.__assign)({},u),{onMouseWheel:f,updateItems:function(){var t,n;s&&s.disconnect(),s=new IntersectionObserver((function(e){var t,r;try{for(var n=(0,i.__values)(e),s=n.next();!s.done;s=n.next()){var a=s.value;_.has(a.target)&&_.set(a.target,a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}l({type:"updateNav",hasPrev:null!==o(_),hasNext:null!==c(_)})}),{root:r,threshold:[0,1]}),_.clear();try{for(var a=(0,i.__values)(r.querySelectorAll(e.itemSelector)),u=a.next();!u.done;u=a.next()){var d=u.value;_.set(d,null),s.observe(d)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},getOffset:function(){return a},scrollTo:g,scrollBy:h,onWheel:function(e){h({x:e.deltaX,y:e.deltaY,noTransition:!0})},prev:function(){var e=o(_);if(e){var t=getComputedStyle(n),r=parseInt(t.paddingLeft)||0,i=parseInt(t.paddingTop)||0,s=n.getBoundingClientRect(),a=e.getBoundingClientRect();g({x:a.left-s.left-r,y:a.top-s.top-i})}},next:function(){var e=c(_);if(e){var t=getComputedStyle(n),i=parseInt(t.paddingBottom)||0,s=parseInt(t.paddingRight)||0,a=r.getBoundingClientRect(),o=n.getBoundingClientRect(),u=e.getBoundingClientRect();g({x:u.left-o.left-a.width+u.width+s,y:u.top-o.top-a.height+u.height+i})}}}))}}t.current=r}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,n.useLayoutEffect)((function(){u.updateItems()})),(0,i.__assign)({ref:_},u)}},683791:(e,t,r)=>{"use strict";r.d(t,{useStyles:()=>a});var i=r(570655),n=r(749091),s=r(227110),a=function(e){var t,r,a=(0,i.__read)((0,s.useProducts)(e),2),o=a[0],c=a[1],u=[];try{for(var l=(0,i.__values)(o),d=l.next();!d.done;d=l.next()){var _=d.value;_&&(0,n.isStyleProduct)(_)&&u.push(_)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return[u,c]}},155639:(e,t,r)=>{"use strict";r.d(t,{useWithProducts:()=>a});var i=r(570655),n=r(667294),s=r(227110);function a(e){var t=(0,i.__read)((0,s.useProducts)(e.map((function(e){return e.product_id}))),2),r=t[0],a=t[1];return[(0,n.useMemo)((function(){return e.map((function(e,t){return(0,i.__assign)((0,i.__assign)({},e),{product:r[t]})}))}),[e]),a]}},751595:(e,t,r)=>{"use strict";r.d(t,{previewSticker:()=>m,previewStickerProduct:()=>k});var i=r(570655),n=r(785893),s=r(973935),a=r(32773),o=r(146143),c=r(786067),u=r(749091),l=r(310835),d=r(665820),_=r(399321),g=r(486125),h=r(60578),f=r(187925),p=r(618610),v=new Map;function m(e,t){var r=(0,g.showBoxLoader)();(0,d.getPackByStickerId)(e).then((function(e){!(0,g.isBoxLoadingCancelled)(r)&&e&&((0,g.hideBoxLoader)(),k(e.id,t))}),(function(){}))}function k(e,t){var r,d=(0,i.__assign)({},t);function m(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductPreviewBox")}function k(){null==r||r.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function y(){null==r||r.updateBoxCoords()}function S(e,t){var r=null,i=null;if((0,u.isPackProduct)(e))r=e.is_purchased&&(null==d?void 0:d.settings)?(0,n.jsx)(f.default,{pack:e,options:d,closeBox:k,updateBox:y},void 0):(0,n.jsx)(h.default,{pack:e,cart:t,options:d,closeBox:k,updateBox:y},void 0),i=e.name;else if((0,u.isStyleProduct)(e)){var o=(0,l.getProductFromCache)(e.base_id);if(o)return t.addProduct(o.id,!0),void S(o,t);r=(0,n.jsx)(p.default,{style:e,options:d,closeBox:k,updateBox:y},void 0),i=e.name}var c=m();if(c&&r&&(s.render((0,n.jsx)(a.AppRootProvider,{children:r},void 0),c),i)){var _=window.nav.objLoc[0].split("/");"stickers"===_[0]&&_[1]!==i&&window.nav.setLoc({0:"stickers/"+i})}}var w=(0,g.showBoxLoader)(!1),P=_.Cart.create([e]);return Promise.all([P.load(),window.stManager.add(["stickers.css"])]).then((function(t){var n=(0,i.__read)(t,1)[0];if(!(0,g.isBoxLoadingCancelled)(w)){(0,g.hideBoxLoader)();var a=(0,l.getProductFromCache)(e);a&&!a.is_disabled?((r=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow:function(){S(a,n),requestAnimationFrame((function(){y(),function(){if(v.has(e)){var t=(0,g.getBoxLayerWrap)();t&&(t.scrollTop=v.get(e)||0),v.delete(e)}}()}))},onBeforeHide:function(){var t;(t=(0,g.getBoxLayerWrap)())&&v.set(e,t.scrollTop)},onHideAttempt:function(){var e;return(e=m())&&s.unmountComponentAtNode(e),!0}})).content('<div class="StickersProductPreviewBox"></div>'),r.show()):(0,o.showFastBox)((0,c.getLang)("global_box_error_title"),(0,c.getLang)("purchases_stickers_product_not_found"))}}),(function(){})),{hide:k}}},310835:(e,t,r)=>{"use strict";r.d(t,{cacheProductsData:()=>a,getProductFromCache:()=>o,getProductsFromCache:()=>c,getProducts:()=>l,getProduct:()=>d,activateProduct:()=>_,updateUserProductState:()=>g});var i=r(570655),n=r(293680),s=r(665820),a=function(e,t){var r,n,a,o,c,u;void 0===t&&(t=[]);var l=(0,s.getCache)();if(e.stickers){var d=l.stickers;try{for(var _=(0,i.__values)(e.stickers),g=_.next();!g.done;g=_.next()){var h=g.value;d.has(h.id)?d.set(h.id,(0,i.__assign)((0,i.__assign)({},d.get(h.id)),h)):d.set(h.id,h)}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}}if(e.products)try{for(var f=(0,i.__values)(e.products),p=f.next();!p.done;p=f.next()){var v=p.value;l.products.set(v.id,v),l.productPromises.delete(v.id)}}catch(e){a={error:e}}finally{try{p&&!p.done&&(o=f.return)&&o.call(f)}finally{if(a)throw a.error}}try{for(var m=(0,i.__values)(t),k=m.next();!k.done;k=m.next()){var y=k.value;l.products.has(y)||l.products.set(y,null),l.productPromises.delete(y)}}catch(e){c={error:e}}finally{try{k&&!k.done&&(u=m.return)&&u.call(m)}finally{if(c)throw c.error}}e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,s.updateCache)(l)},o=function(e){return(0,s.getCache)().products.get(e)},c=function(e){var t=(0,s.getCache)().products;return e.map((function(e){return t.get(e)}))};var u=function(e){var t,r;if(!e.length)return Promise.resolve([]);var o,u=(0,s.getCache)(),l=u.productPromises,d=u.productIdsQueue,_=new Set;try{for(var g=(0,i.__values)(e),h=g.next();!h.done;h=g.next()){var f=h.value;if(l.has(f)){(p=l.get(f))&&_.add(p)}else{d.add(f);var p=(o=void 0,(o=(0,s.getCache)().productsPromise)||(o=new Promise((function(e){return setTimeout((function(){var t=(0,s.getCache)().productIdsQueue,r=Array.from(t);t.clear(),(0,s.updateCache)({productIdsQueue:t,productsPromise:void 0}),n.ajax.post("stickers.php",{act:"get_products",product_ids:r},{onDone:function(t){a(t,r),e([])},onFail:function(t){return console.error(t),a({},r),e([]),!0}})}),300)})),(0,s.updateCache)({productsPromise:o})),o);l.set(f,p),_.add(p)}}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}return(0,s.updateCache)({productIdsQueue:d,productPromises:l}),Promise.all(_).then((function(){return c(e)}))},l=function(e,t){void 0===t&&(t=!0);var r=t?e.filter((function(e){return void 0===o(e)})):e;return r.length?u(r).then((function(){return c(e)})):Promise.resolve(c(e))},d=function(e,t){if(void 0===t&&(t=!0),t){var r=o(e);if(void 0!==r)return Promise.resolve(r)}return u([e]).then((function(){return o(e)}))},_=function(e){return new Promise((function(t){n.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone:function(e){a(e),t()},onFail:function(e){return console.error(e),t(),!0}})}))},g=function(e,t,r,i){return void 0===i&&(i=!0),new Promise((function(s){n.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:r},{onDone:function(e){i&&a(e),s()},onFail:function(e){return console.error(e),s(),!0}})}))}},870264:(e,t,r)=>{"use strict";r.d(t,{giftStickersCart:()=>_,giftStickerProducts:()=>g});var i=r(570655),n=r(785893),s=r(973935),a=r(32773),o=r(146143),c=r(399321),u=r(348230),l=r(665820),d=r(490808);function _(e,t){var r;if((0,l.getCache)().productsGiftLock)return null;(0,l.updateCache)({productsGiftLock:!0});var c=(0,i.__assign)({},t);function _(){return null==r?void 0:r.bodyNode.querySelector(".StickersProductsGift")}function g(){null==r||r.hide()}function h(){null==r||r.updateBoxCoords()}return(0,u.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((function(e){var t=(0,i.__read)(e,1)[0];(0,u.hideLoader)(),r=new o.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow:function(){!function(e){var t=_();t&&s.render((0,n.jsx)(a.AppRootProvider,{children:(0,n.jsx)(d.default,{cart:e,options:c,closeBox:g,updateBox:h},void 0)},void 0),t)}(t),requestAnimationFrame((function(){h()}))},onHideAttempt:function(){var e;return(e=_())&&s.unmountComponentAtNode(e),!0},onHide:function(){(0,l.updateCache)({productsGiftLock:!1})}}),r.content('<div class="StickersProductsGift"></div>'),r.show()}),(function(){})),{hide:g}}function g(e,t,r){return void 0===t&&(t=[]),_(c.Cart.create(e,t),r)}},348230:(e,t,r)=>{"use strict";r.d(t,{getBoxLayerWrap:()=>l,showLoader:()=>d,hideLoader:()=>_,getPurchaseResult:()=>g,updateStickersFromQueue:()=>h});var i=r(786067),n=r(70162),s=r(511417),a=r(315544),o=r(486125),c=r(749091);function u(){return document.querySelector("#box_loader")}function l(){return document.querySelector("#box_layer_wrap")}function d(){var e=u();(0,o.boxRefreshCoords)(e),(0,a.show)(e),(0,a.show)(l())}function _(){(0,a.hide)(u())}function g(e){var t=new c.ProductsByType(e.items.filter((function(e){return!e.error})).map((function(e){return e.product}))),r=t.getPack(),s=t.getStyles();if(r)return s.length?(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_pack_and_styles",s.length),"pack_title",r.title,"n",s.length):(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_pack"),"title",r.title);if(s.length)switch(s.length){case 1:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_1_style"),"title",s[0].title);case 2:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_2_styles"),"title1",s[0].title,"title2",s[1].title);case 3:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);case 4:return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);default:var a=s.length-3;return(0,i.langStr)((0,n.getLang)("purchases_stickers_purchase_result_3_styles_and_n_more",a),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title,"n",a)}return null}function h(e){var t,r;t=e,r=s.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light",t.querySelectorAll(".sticker_img["+r+"]").forEach((function(e){var t=e.getAttribute(r);t&&(e.src=t)}))}},575867:(e,t,r)=>{"use strict";r.d(t,{vmojiSubscribeToQueue:()=>s,vmojiPurchaseProduct:()=>a,vmojiGetAvatar:()=>o,vmojiGetStickerPacksRecommendationBlocks:()=>c,vmojiGetStickerPacksRecommendationBlock:()=>u,vmojiGetStickerPacks:()=>l,vmojiGetCharacterById:()=>d,vmojiSetAvatarState:()=>_,storeActivateProduct:()=>g,storeDeactivateProduct:()=>h,VmojiLangSection:()=>i,vmojiGetLangs:()=>f});var i,n=r(189798),s=function(){return(0,n.api)("vmoji.subscribeToQueue",{})},a=function(e,t){return void 0===t&&(t=!1),(0,n.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0})},o=function(e){var t={};return e&&Object.assign(t,{avatar_id:e}),(0,n.api)("vmoji.getAvatar",t)},c=function(e){return(0,n.api)("vmoji.getStickerPacksRecommendationBlocks",e)},u=function(e,t){var r={block_id:e};return t&&Object.assign(r,{count:t}),(0,n.api)("vmoji.getStickerPacksRecommendationBlock",r)},l=function(e){return(0,n.api)("vmoji.getStickerPacks",e)},d=function(e,t){return(0,n.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0})},_=function(e,t){return(0,n.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0})},g=function(e){return(0,n.api)("store.activateProduct",{type:"stickers",product_id:e})},h=function(e){return(0,n.api)("store.deactivateProduct",{type:"stickers",product_id:e})};!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(i||(i={}));var f=function(e){return new Promise((function(t,r){window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:function(){t()},onFail:function(){return r(),!1}})}))}}}]);try{stManager.done("dist/eee28a6f0b8a039c3e39114fcc5571a5.ec663dc7c750efa9eeb8.js")}catch(e){}